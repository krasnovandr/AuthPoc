2018-07-27 14:24:10.267 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-27 14:24:10.312 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-27 14:24:10.318 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-27 14:24:10.322 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-27 14:24:10.325 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-27 14:24:10.642 +03:00 [DBG] Starting token cleanup
2018-07-27 16:25:13.088 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-27 16:25:13.149 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-27 16:25:13.155 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-27 16:25:13.160 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-27 16:25:13.165 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-27 16:25:13.531 +03:00 [DBG] Starting token cleanup
2018-07-27 16:25:15.087 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:25:15.131 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:25:38.823 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:25:38.827 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:25:38.835 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-27 16:25:38.864 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-27 16:25:38.867 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-27 16:25:38.872 +03:00 [DBG] Start discovery request
2018-07-27 16:25:39.955 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-27 16:26:35.222 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-27 16:26:35.227 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-27 16:26:35.230 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-27 16:26:35.236 +03:00 [DBG] Start discovery request
2018-07-27 16:26:35.273 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-27 16:26:35.496 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-27 16:26:35.501 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-27 16:26:35.503 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-27 16:26:35.511 +03:00 [DBG] Start key discovery request
2018-07-27 16:26:35.642 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:35.662 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:35.670 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-27 16:26:35.681 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-27 16:26:35.684 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-27 16:26:35.693 +03:00 [DBG] Start authorize request
2018-07-27 16:26:35.706 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:35.716 +03:00 [DBG] No user present in authorize request
2018-07-27 16:26:35.724 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:26:36.156 +03:00 [DBG] mvc found in database: true
2018-07-27 16:26:36.166 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:26:36.169 +03:00 [DBG] No PKCE used.
2018-07-27 16:26:36.218 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:26:36.350 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:26:36.371 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:26:36.387 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:26:36.400 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:26:36.417 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
  "Nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-27 16:26:36.434 +03:00 [INF] Showing login: User is not authenticated
2018-07-27 16:26:36.457 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:36.464 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:36.553 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:26:36.557 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:26:36.583 +03:00 [DBG] mvc found in database: true
2018-07-27 16:26:36.586 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:26:36.588 +03:00 [DBG] No PKCE used.
2018-07-27 16:26:36.595 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:26:36.613 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:26:36.620 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:26:36.636 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:26:36.641 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:26:36.671 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:26.639 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-27 16:27:26.648 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:27:26.652 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:27:30.217 +03:00 [DBG] Augmenting SignInContext
2018-07-27 16:27:30.221 +03:00 [DBG] Adding idp claim with value: local
2018-07-27 16:27:30.224 +03:00 [DBG] Adding amr claim with value: pwd
2018-07-27 16:27:30.229 +03:00 [DBG] Adding auth_time claim with value: 1532698050
2018-07-27 16:27:30.233 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:27:30.247 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-27 16:27:30.312 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "alice",
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "DisplayName": "alice",
  "Endpoint": "UI",
  "ActivityId": "0HLFJOHHB3L5E:00000005",
  "TimeStamp": "2018-07-27T13:27:30Z",
  "ProcessId": 37968,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-27 16:27:30.337 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:30.343 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:30.347 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-27 16:27:30.352 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-27 16:27:30.355 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-27 16:27:30.371 +03:00 [DBG] Start authorize callback request
2018-07-27 16:27:30.384 +03:00 [DBG] User in authorize request: 906123a3-4bab-49ae-a2c3-c0617fb03398
2018-07-27 16:27:30.387 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:27:30.447 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:30.449 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:27:30.452 +03:00 [DBG] No PKCE used.
2018-07-27 16:27:30.464 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:30.543 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:30.557 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:30.651 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:30.657 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:27:30.660 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
  "Nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
  "SessionId": "ae318ad7ec95807cc0e9a5f3408b08ad",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-27 16:27:30.704 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-27 16:27:30.707 +03:00 [INF] Showing consent: User has not yet consented
2018-07-27 16:27:30.734 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:30.763 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:30.800 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:27:30.865 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:30.870 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:27:30.873 +03:00 [DBG] No PKCE used.
2018-07-27 16:27:30.887 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:31.000 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:31.065 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:31.167 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:31.172 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:27:31.245 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:31.258 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:31.345 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:41.038 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-27 16:27:41.053 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:41.056 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:41.114 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:27:41.171 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:41.174 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:27:41.177 +03:00 [DBG] No PKCE used.
2018-07-27 16:27:41.191 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:41.265 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:41.274 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:41.291 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:41.293 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:27:41.326 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:41.332 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:27:41.336 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-27 16:27:41.341 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-27 16:27:41.343 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-27 16:27:41.353 +03:00 [DBG] Start authorize callback request
2018-07-27 16:27:41.393 +03:00 [DBG] User in authorize request: 906123a3-4bab-49ae-a2c3-c0617fb03398
2018-07-27 16:27:41.401 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:27:41.432 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:41.434 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:27:41.436 +03:00 [DBG] No PKCE used.
2018-07-27 16:27:41.446 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:41.464 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:41.473 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:41.496 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:41.503 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:27:41.508 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
  "Nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
  "SessionId": "ae318ad7ec95807cc0e9a5f3408b08ad",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-27 16:27:41.531 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-27 16:27:41.540 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-27 16:27:41.544 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-27 16:27:41.552 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 906123a3-4bab-49ae-a2c3-c0617fb03398
2018-07-27 16:27:41.595 +03:00 [DBG] BVr/wCR88mcAGKjUQ2Y7vAVVgMPNxP8zr6xg2B1d4Us= found in database
2018-07-27 16:27:41.655 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-27 16:27:41.684 +03:00 [DBG] FGrFJTf5fZ3XdIe0zlWN0zl+ndpGXHwySyRJsMhQwK8= not found in database
2018-07-27 16:27:41.706 +03:00 [DBG] Creating Implicit Flow response.
2018-07-27 16:27:41.723 +03:00 [DBG] Getting claims for identity token for subject: 906123a3-4bab-49ae-a2c3-c0617fb03398 and client: mvc
2018-07-27 16:27:41.732 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-27 16:27:41.829 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****KbYg"
    },
    {
      "TokenType": "code",
      "TokenValue": "****ad41"
    }
  ],
  "ActivityId": "0HLFJOHHB3L5E:0000000A",
  "TimeStamp": "2018-07-27T13:27:41Z",
  "ProcessId": 37968,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-27 16:27:41.839 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJg9__Q7J8_dd-PnAI1gvom4WqGGx-pzEXbEb3RD7-TICs3iWf_4oJO4RhGdO6JCSsl3j84xvko2zs53LUt8s7_McpJJSui5UF0FOUHlmYGtbI8aVudDuJdJMJ5oGIdQp0I0eeKL_cs3_69xM6OAn_OX4icuvjX8HkujQXPY3cHTgIx5b8p7vFyI2FirwvVMtyjZuvTTKE3VNpi5pF1pv32JlXb0C_wamlLPjE0H4QaXE21M945Q5RAEq7dCADIva1v1G-Isegg9eiN_JMJxf6Z2OTD58bOar7NfjoM4qJAt9U8XShOUUn_nGcoLC3AKYQ",
  "Scope": "openid profile api1 offline_access"
}
2018-07-27 16:27:41.868 +03:00 [DBG] Augmenting SignInContext
2018-07-27 16:27:41.870 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-27 16:27:42.112 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-27 16:27:42.123 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-27 16:27:42.127 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-27 16:27:42.141 +03:00 [DBG] Start token request.
2018-07-27 16:27:42.165 +03:00 [DBG] Start client validation
2018-07-27 16:27:42.172 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-27 16:27:42.182 +03:00 [DBG] Start parsing for secret in post body
2018-07-27 16:27:42.184 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-27 16:27:42.188 +03:00 [DBG] Secret id found: mvc
2018-07-27 16:27:42.218 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:42.230 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-27 16:27:42.232 +03:00 [DBG] Client validation success
2018-07-27 16:27:42.239 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFJOHHB3L5N:00000001",
  "TimeStamp": "2018-07-27T13:27:42Z",
  "ProcessId": 37968,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-27 16:27:42.249 +03:00 [DBG] Start token request validation
2018-07-27 16:27:42.260 +03:00 [DBG] Start validation of authorization code token request
2018-07-27 16:27:42.288 +03:00 [DBG] FGrFJTf5fZ3XdIe0zlWN0zl+ndpGXHwySyRJsMhQwK8= found in database: true
2018-07-27 16:27:42.324 +03:00 [DBG] removing FGrFJTf5fZ3XdIe0zlWN0zl+ndpGXHwySyRJsMhQwK8= persisted grant from database
2018-07-27 16:27:42.342 +03:00 [DBG] Validation of authorization code token request success
2018-07-27 16:27:42.352 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "e18df89042da74f604acef0b259a229dd27daf18115c66d0a4ca36e25cb3ad41",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "e18df89042da74f604acef0b259a229dd27daf18115c66d0a4ca36e25cb3ad41",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-27 16:27:42.395 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:42.408 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:42.490 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:42.505 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-27 16:27:42.507 +03:00 [DBG] Getting claims for access token for subject: 906123a3-4bab-49ae-a2c3-c0617fb03398
2018-07-27 16:27:42.535 +03:00 [DBG] Creating refresh token
2018-07-27 16:27:42.537 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-27 16:27:42.560 +03:00 [DBG] rYf9Jmf6/fXek1b0XJTqhqsZAiSOehaW5lqb8dvTVDQ= not found in database
2018-07-27 16:27:42.593 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:42.605 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:42.622 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:27:42.625 +03:00 [DBG] Getting claims for identity token for subject: 906123a3-4bab-49ae-a2c3-c0617fb03398 and client: mvc
2018-07-27 16:27:42.628 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-27 16:27:42.637 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****bpmA"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****dd49"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****MwdA"
    }
  ],
  "ActivityId": "0HLFJOHHB3L5N:00000001",
  "TimeStamp": "2018-07-27T13:27:42Z",
  "ProcessId": 37968,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-27 16:27:42.643 +03:00 [DBG] Token request success.
2018-07-27 16:27:42.669 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-27 16:27:42.674 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-27 16:27:42.676 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-27 16:27:42.687 +03:00 [DBG] Start userinfo request
2018-07-27 16:27:42.693 +03:00 [DBG] Bearer token found in header
2018-07-27 16:27:42.779 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:42.820 +03:00 [DBG] mvc found in database: true
2018-07-27 16:27:42.838 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-27 16:27:42.851 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532698062,
    "exp": 1532701662,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "906123a3-4bab-49ae-a2c3-c0617fb03398",
    "auth_time": 1532698050,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-07-27 16:27:42.864 +03:00 [DBG] Creating userinfo response
2018-07-27 16:27:42.871 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-27 16:27:42.877 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-27 16:27:42.890 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:42.894 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-27 16:27:42.897 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-27 16:27:42.905 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:27:42.917 +03:00 [INF] Profile service returned to the following claim types: sub name given_name family_name website preferred_username
2018-07-27 16:27:42.920 +03:00 [DBG] End userinfo request
2018-07-27 16:34:20.138 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-27 16:34:20.204 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-27 16:34:20.207 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-27 16:34:20.210 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-27 16:34:20.218 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-27 16:34:20.618 +03:00 [DBG] Starting token cleanup
2018-07-27 16:34:22.138 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:22.162 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:32.942 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-27 16:34:32.950 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-27 16:34:32.952 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-27 16:34:32.957 +03:00 [DBG] Start discovery request
2018-07-27 16:34:34.024 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-27 16:34:34.351 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-27 16:34:34.353 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-27 16:34:34.355 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-27 16:34:34.361 +03:00 [DBG] Start key discovery request
2018-07-27 16:34:34.479 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:34.496 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:34.504 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-07-27 16:34:34.510 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-07-27 16:34:34.514 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-07-27 16:34:34.530 +03:00 [DBG] Processing signout request for 906123a3-4bab-49ae-a2c3-c0617fb03398
2018-07-27 16:34:34.541 +03:00 [DBG] Start end session request validation
2018-07-27 16:34:34.550 +03:00 [DBG] Start identity token validation
2018-07-27 16:34:34.960 +03:00 [DBG] mvc found in database: true
2018-07-27 16:34:34.964 +03:00 [DBG] Client found: mvc / MVC Client
2018-07-27 16:34:35.129 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-27 16:34:35.142 +03:00 [DBG] Token validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1532698062,
    "exp": 1532698362,
    "iss": "http://localhost:5000",
    "aud": "mvc",
    "nonce": "636682947955907681.NjUzYWRjN2YtNmJkZi00MzczLWE5ODAtZTM2MzI4MWU5NzExM2RlNzVhN2UtNjgyZS00NDNjLWFjNTQtZGQ1MDU5N2FiYTE3",
    "iat": 1532698062,
    "at_hash": "M5D2BHuytEzV6lbMqMMPUg",
    "sid": "ae318ad7ec95807cc0e9a5f3408b08ad",
    "sub": "906123a3-4bab-49ae-a2c3-c0617fb03398",
    "auth_time": 1532698050,
    "idp": "local",
    "amr": "pwd"
  }
}
2018-07-27 16:34:35.165 +03:00 [INF] End session request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "PostLogOutUri": "http://localhost:5002/signout-callback-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIAqeov1oZlF6yUInwzZ971IADbprsOBRuw3TsqOQAuyMk09t0DnQVJyqZmnl9bg6eSQ6qhhaq59-pHSPuVa8BkCfFC60e2E9ylHi3_6Ultw5XLwjNkmHXxQ9E4dKCtz_3y_A9_qnvLKZstGg8eSwMQ",
  "Raw": {
    "post_logout_redirect_uri": "http://localhost:5002/signout-callback-oidc",
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY2NzZhNjNmM2QxZmRmYTNmMzgyZGNmZDNkYjNkZjc3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MzI2OTgwNjIsImV4cCI6MTUzMjY5ODM2MiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoibXZjIiwibm9uY2UiOiI2MzY2ODI5NDc5NTU5MDc2ODEuTmpVellXUmpOMll0Tm1Ka1ppMDBNemN6TFdFNU9EQXRaVE0yTXpJNE1XVTVOekV4TTJSbE56VmhOMlV0TmpneVpTMDBORE5qTFdGak5UUXRaR1ExTURVNU4yRmlZVEUzIiwiaWF0IjoxNTMyNjk4MDYyLCJhdF9oYXNoIjoiTTVEMkJIdXl0RXpWNmxiTXFNTVBVZyIsInNpZCI6ImFlMzE4YWQ3ZWM5NTgwN2NjMGU5YTVmMzQwOGIwOGFkIiwic3ViIjoiOTA2MTIzYTMtNGJhYi00OWFlLWEyYzMtYzA2MTdmYjAzMzk4IiwiYXV0aF90aW1lIjoxNTMyNjk4MDUwLCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.RMOhTC7EnBRvlCM9aYz1lMf09dB015bwwYnas1ezdHdMCgpIPryizda1gXUwF1iBUW9AKRKNHkdz6QhTNgQK7HA0V0cM93UzOez2VgcHH-Iq-Zm-KYMcaPkRItJIF1LUjS23roDI7I276fcmwEA4w-O0hxMLtiyuTPk60UxrQNpo63ltBD6MiH1o5K-acq-LLShuT3JzVpOb6A1Ozxm70BTsiHE3kz_2MtOcXPtT5f-3baGklgj8qL0pc2GsWK9ET9_Smi8q_Bfipi4JpotCMEXKhzIvCWv7hxTO4Im9VH6XEQsSLhpT4zR7yK7CyFnMiETLnKAp8AQODrbNZ7bpmA",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIAqeov1oZlF6yUInwzZ971IADbprsOBRuw3TsqOQAuyMk09t0DnQVJyqZmnl9bg6eSQ6qhhaq59-pHSPuVa8BkCfFC60e2E9ylHi3_6Ultw5XLwjNkmHXxQ9E4dKCtz_3y_A9_qnvLKZstGg8eSwMQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-27 16:34:35.174 +03:00 [DBG] Success validating end session request from mvc
2018-07-27 16:34:35.210 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:35.219 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-27 16:34:35.351 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-07-27 16:34:35.357 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-07-27 16:34:35.359 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-07-27 16:34:35.405 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "906123a3-4bab-49ae-a2c3-c0617fb03398",
  "DisplayName": "Alice Smith",
  "ActivityId": "0HLFJOMKBG95I:00000003",
  "TimeStamp": "2018-07-27T13:34:35Z",
  "ProcessId": 19612,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-27 16:34:35.620 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-07-27 16:34:35.629 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-07-27 16:34:35.636 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-07-27 16:34:35.648 +03:00 [DBG] Processing signout callback request
2018-07-27 16:34:35.701 +03:00 [DBG] mvc found in database: true
2018-07-27 16:34:35.703 +03:00 [DBG] No client front-channel logout URLs
2018-07-27 16:34:35.706 +03:00 [DBG] No client back-channel logout URLs
2018-07-27 16:34:35.708 +03:00 [INF] Successful signout callback.
2018-07-27 16:34:35.709 +03:00 [DBG] No client front-channel iframe urls
2018-07-27 16:34:35.713 +03:00 [DBG] No client back-channel iframe urls
2018-07-27 16:34:46.262 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-27 16:34:46.275 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-27 16:34:46.280 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-27 16:34:46.291 +03:00 [DBG] Start authorize request
2018-07-27 16:34:46.302 +03:00 [DBG] No user present in authorize request
2018-07-27 16:34:46.312 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:34:46.366 +03:00 [DBG] mvc found in database: true
2018-07-27 16:34:46.374 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:34:46.378 +03:00 [DBG] No PKCE used.
2018-07-27 16:34:46.423 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:34:46.558 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:34:46.746 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:34:46.776 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:34:46.810 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:34:46.840 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKGvSosDmQ5r_EkqaVppMiQEnfKlvyGI2XkrkMxyZfGL8yhux1ONpdMkygHwZsRJVDr3hgMx-lV4J44CiKRE57H6y8EbHRluDtNA8gLwPOq8jEo7IQ8-CQOmrbB-P1AARrLGWe3bwJEPjv232XcOAyVp5wgWadLaTL2ErTM5cpiB5S1dR8yB1Fx8N-Yx9EA1HU4q47ctin3R_spEa6VmT361G_QKAE2Ja0qn0NYY9wzozop8ZQVqgHBlzKVAVX5a7oSM11_LxGKnLZfudSCEAgS1CM7b3leTRuGXEiUrt3O5L_L4dU39_7Et8MJkzWqWow",
  "Nonce": "636682952862321614.YmZiNmM5NGMtMjM3MC00YTk1LWFjYzEtZDZhNzdjNWUxYmQ4MzM0Yjc4YTUtNTNmNC00M2FkLTgzOGYtZjYzYWM1YzhjYzdl",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636682952862321614.YmZiNmM5NGMtMjM3MC00YTk1LWFjYzEtZDZhNzdjNWUxYmQ4MzM0Yjc4YTUtNTNmNC00M2FkLTgzOGYtZjYzYWM1YzhjYzdl",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKGvSosDmQ5r_EkqaVppMiQEnfKlvyGI2XkrkMxyZfGL8yhux1ONpdMkygHwZsRJVDr3hgMx-lV4J44CiKRE57H6y8EbHRluDtNA8gLwPOq8jEo7IQ8-CQOmrbB-P1AARrLGWe3bwJEPjv232XcOAyVp5wgWadLaTL2ErTM5cpiB5S1dR8yB1Fx8N-Yx9EA1HU4q47ctin3R_spEa6VmT361G_QKAE2Ja0qn0NYY9wzozop8ZQVqgHBlzKVAVX5a7oSM11_LxGKnLZfudSCEAgS1CM7b3leTRuGXEiUrt3O5L_L4dU39_7Et8MJkzWqWow",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-27 16:34:46.860 +03:00 [INF] Showing login: User is not authenticated
2018-07-27 16:34:46.923 +03:00 [DBG] Start authorize request protocol validation
2018-07-27 16:34:46.949 +03:00 [DBG] mvc found in database: true
2018-07-27 16:34:46.954 +03:00 [DBG] Checking for PKCE parameters
2018-07-27 16:34:46.956 +03:00 [DBG] No PKCE used.
2018-07-27 16:34:46.965 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:34:46.980 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:34:46.989 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-27 16:34:47.004 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-27 16:34:47.008 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-27 16:34:47.035 +03:00 [DBG] mvc found in database: true
2018-07-27 16:34:52.155 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-07-27 16:49:16.484 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-27 16:49:16.572 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-27 16:49:16.609 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-27 16:49:16.658 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-27 16:49:16.711 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-27 16:49:17.366 +03:00 [DBG] Starting token cleanup
2018-07-27 16:49:19.284 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-27 16:49:19.344 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:09:32.758 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-30 19:09:32.850 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-30 19:09:32.869 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-30 19:09:32.881 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-30 19:09:32.886 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-30 19:09:33.427 +03:00 [DBG] Starting token cleanup
2018-07-30 19:09:35.322 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:09:35.364 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:36.510 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-30 19:10:36.537 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-30 19:10:36.539 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-30 19:10:36.544 +03:00 [DBG] Start discovery request
2018-07-30 19:10:37.646 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-30 19:10:37.952 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-30 19:10:37.956 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-30 19:10:37.959 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-30 19:10:37.968 +03:00 [DBG] Start key discovery request
2018-07-30 19:10:38.120 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:38.125 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:38.128 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-30 19:10:38.140 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-30 19:10:38.142 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-30 19:10:38.150 +03:00 [DBG] Start authorize request
2018-07-30 19:10:38.158 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:38.167 +03:00 [DBG] No user present in authorize request
2018-07-30 19:10:38.174 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:10:38.617 +03:00 [DBG] mvc found in database: true
2018-07-30 19:10:38.627 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:10:38.632 +03:00 [DBG] No PKCE used.
2018-07-30 19:10:38.690 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:10:38.820 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:10:38.852 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:10:38.952 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:10:38.966 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:10:38.987 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKv_ZfDosOrNja4QCCafcgsTBbFrcO2UiQQabrP54kXHIXdKXBxHQMYCctwK_Dm2AAuj2n9DSuq0sgSpa23kYlENsIlrMrOFWtnkWdYupMym59eSeJo5Y55jY0GNxFryUCIShDsDBm9Pc8rHl5t5PQAwIcFT0UEDDqRwsAdt9u-aROYTnioFIB7C4uya_mMVu026HRPUyiIniu-BYC9uNsKNW3Ap8DpnO_dbHAIQ3_Jgcyohs97ITONTlncnuB3D4lhoG3ixNcZ1bgPPaccVV5XrQehq0MTQFYdVCMfkn0P4zJjU4G6CTwBydNYF0aGppk",
  "Nonce": "636685638380921543.YzVjZjQwNmQtY2M4ZC00Y2M5LTk4M2ItYjZjMjJjZDY4MzA1MjZiNzhjYjYtYWU1NC00MTg4LWI4YTktYTM1OTIzZmRkYTRi",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636685638380921543.YzVjZjQwNmQtY2M4ZC00Y2M5LTk4M2ItYjZjMjJjZDY4MzA1MjZiNzhjYjYtYWU1NC00MTg4LWI4YTktYTM1OTIzZmRkYTRi",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKv_ZfDosOrNja4QCCafcgsTBbFrcO2UiQQabrP54kXHIXdKXBxHQMYCctwK_Dm2AAuj2n9DSuq0sgSpa23kYlENsIlrMrOFWtnkWdYupMym59eSeJo5Y55jY0GNxFryUCIShDsDBm9Pc8rHl5t5PQAwIcFT0UEDDqRwsAdt9u-aROYTnioFIB7C4uya_mMVu026HRPUyiIniu-BYC9uNsKNW3Ap8DpnO_dbHAIQ3_Jgcyohs97ITONTlncnuB3D4lhoG3ixNcZ1bgPPaccVV5XrQehq0MTQFYdVCMfkn0P4zJjU4G6CTwBydNYF0aGppk",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-30 19:10:39.020 +03:00 [INF] Showing login: User is not authenticated
2018-07-30 19:10:39.043 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:39.050 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:39.132 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:39.137 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:10:39.190 +03:00 [DBG] mvc found in database: true
2018-07-30 19:10:39.193 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:10:39.195 +03:00 [DBG] No PKCE used.
2018-07-30 19:10:39.208 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:10:39.327 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:10:39.365 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:10:39.454 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:10:39.458 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:10:39.507 +03:00 [DBG] mvc found in database: true
2018-07-30 19:10:47.508 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-30 19:10:47.514 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:10:47.521 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:11:01.183 +03:00 [DBG] Augmenting SignInContext
2018-07-30 19:11:01.188 +03:00 [DBG] Adding idp claim with value: local
2018-07-30 19:11:01.190 +03:00 [DBG] Adding amr claim with value: pwd
2018-07-30 19:11:01.192 +03:00 [DBG] Adding auth_time claim with value: 1532967061
2018-07-30 19:11:01.197 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-30 19:11:01.211 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-30 19:11:12.819 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "andrei_krasnou@epam.com",
  "SubjectId": "96e1b5f4-1f86-486d-b63d-a6e83f49ae90",
  "DisplayName": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "ActivityId": "0HLFM6RBG8RN3:00000004",
  "TimeStamp": "2018-07-30T16:11:12Z",
  "ProcessId": 9652,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:11:32.445 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:11:32.453 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:11:32.457 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-30 19:11:32.461 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-30 19:11:32.466 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-30 19:11:32.476 +03:00 [DBG] Start authorize callback request
2018-07-30 19:11:32.487 +03:00 [DBG] User in authorize request: 96e1b5f4-1f86-486d-b63d-a6e83f49ae90
2018-07-30 19:11:32.490 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:11:32.541 +03:00 [DBG] mvc found in database: true
2018-07-30 19:11:32.544 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:11:32.546 +03:00 [DBG] No PKCE used.
2018-07-30 19:11:32.559 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:11:32.646 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:11:32.659 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:11:32.684 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:11:32.689 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:11:32.691 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "96e1b5f4-1f86-486d-b63d-a6e83f49ae90",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKv_ZfDosOrNja4QCCafcgsTBbFrcO2UiQQabrP54kXHIXdKXBxHQMYCctwK_Dm2AAuj2n9DSuq0sgSpa23kYlENsIlrMrOFWtnkWdYupMym59eSeJo5Y55jY0GNxFryUCIShDsDBm9Pc8rHl5t5PQAwIcFT0UEDDqRwsAdt9u-aROYTnioFIB7C4uya_mMVu026HRPUyiIniu-BYC9uNsKNW3Ap8DpnO_dbHAIQ3_Jgcyohs97ITONTlncnuB3D4lhoG3ixNcZ1bgPPaccVV5XrQehq0MTQFYdVCMfkn0P4zJjU4G6CTwBydNYF0aGppk",
  "Nonce": "636685638380921543.YzVjZjQwNmQtY2M4ZC00Y2M5LTk4M2ItYjZjMjJjZDY4MzA1MjZiNzhjYjYtYWU1NC00MTg4LWI4YTktYTM1OTIzZmRkYTRi",
  "SessionId": "8a0273d454da220a0a514efbec24feb0",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636685638380921543.YzVjZjQwNmQtY2M4ZC00Y2M5LTk4M2ItYjZjMjJjZDY4MzA1MjZiNzhjYjYtYWU1NC00MTg4LWI4YTktYTM1OTIzZmRkYTRi",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKv_ZfDosOrNja4QCCafcgsTBbFrcO2UiQQabrP54kXHIXdKXBxHQMYCctwK_Dm2AAuj2n9DSuq0sgSpa23kYlENsIlrMrOFWtnkWdYupMym59eSeJo5Y55jY0GNxFryUCIShDsDBm9Pc8rHl5t5PQAwIcFT0UEDDqRwsAdt9u-aROYTnioFIB7C4uya_mMVu026HRPUyiIniu-BYC9uNsKNW3Ap8DpnO_dbHAIQ3_Jgcyohs97ITONTlncnuB3D4lhoG3ixNcZ1bgPPaccVV5XrQehq0MTQFYdVCMfkn0P4zJjU4G6CTwBydNYF0aGppk",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-30 19:11:32.730 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-30 19:11:32.732 +03:00 [INF] Showing consent: User has not yet consented
2018-07-30 19:11:32.753 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:11:32.759 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:11:32.791 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:11:32.822 +03:00 [DBG] mvc found in database: true
2018-07-30 19:11:32.825 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:11:32.827 +03:00 [DBG] No PKCE used.
2018-07-30 19:11:32.837 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:11:32.856 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:11:32.869 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:11:32.886 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:11:32.891 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:11:32.919 +03:00 [DBG] mvc found in database: true
2018-07-30 19:11:32.931 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:11:33.004 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:13:07.472 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-30 19:13:07.553 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-30 19:13:07.573 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-30 19:13:07.586 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-30 19:13:07.592 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-30 19:13:08.017 +03:00 [DBG] Starting token cleanup
2018-07-30 19:13:09.622 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:13:09.680 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:02.489 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-30 19:14:02.565 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-30 19:14:02.569 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-30 19:14:02.573 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-30 19:14:02.578 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-30 19:14:02.977 +03:00 [DBG] Starting token cleanup
2018-07-30 19:14:03.510 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:03.537 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:36.627 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-30 19:14:36.639 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-30 19:14:36.641 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-30 19:14:36.646 +03:00 [DBG] Start discovery request
2018-07-30 19:14:37.759 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-30 19:14:38.115 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-30 19:14:38.119 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-30 19:14:38.134 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-30 19:14:38.145 +03:00 [DBG] Start key discovery request
2018-07-30 19:14:38.256 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:38.263 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:38.268 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-30 19:14:38.280 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-30 19:14:38.284 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-30 19:14:38.297 +03:00 [DBG] Start authorize request
2018-07-30 19:14:38.312 +03:00 [DBG] User in authorize request: 96e1b5f4-1f86-486d-b63d-a6e83f49ae90
2018-07-30 19:14:38.326 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:14:38.716 +03:00 [DBG] mvc found in database: true
2018-07-30 19:14:38.726 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:14:38.730 +03:00 [DBG] No PKCE used.
2018-07-30 19:14:38.774 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:14:38.883 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:14:38.908 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:14:38.927 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:14:38.940 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:14:38.959 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "96e1b5f4-1f86-486d-b63d-a6e83f49ae90",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
  "Nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
  "SessionId": "8a0273d454da220a0a514efbec24feb0",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-30 19:14:39.061 +03:00 [INF] Showing login: User is not active
2018-07-30 19:14:39.082 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:39.087 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:39.164 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:14:39.244 +03:00 [DBG] mvc found in database: true
2018-07-30 19:14:39.247 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:14:39.250 +03:00 [DBG] No PKCE used.
2018-07-30 19:14:39.263 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:14:39.282 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:14:39.292 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:14:39.310 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:14:39.313 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:14:39.346 +03:00 [DBG] mvc found in database: true
2018-07-30 19:14:55.262 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-30 19:14:55.267 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:14:55.270 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:15:07.793 +03:00 [WRN] User 249d64e3-44cf-4dff-b4b2-3e7ae960a432 cannot sign in without a confirmed email.
2018-07-30 19:15:15.918 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLFM6TRL6DLE:00000004",
  "TimeStamp": "2018-07-30T16:15:15Z",
  "ProcessId": 28608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:15:21.206 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:15:21.260 +03:00 [DBG] mvc found in database: true
2018-07-30 19:15:21.264 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:15:21.267 +03:00 [DBG] No PKCE used.
2018-07-30 19:15:21.279 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:15:21.362 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:15:21.372 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:15:21.388 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:15:21.393 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:15:21.428 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:11.160 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-30 19:16:11.171 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:11.175 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:15.137 +03:00 [DBG] Augmenting SignInContext
2018-07-30 19:16:15.141 +03:00 [DBG] Adding idp claim with value: local
2018-07-30 19:16:15.144 +03:00 [DBG] Adding amr claim with value: pwd
2018-07-30 19:16:15.147 +03:00 [DBG] Adding auth_time claim with value: 1532967375
2018-07-30 19:16:15.166 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-30 19:16:15.179 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "andrei_krasnou@epam.com",
  "SubjectId": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
  "DisplayName": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "ActivityId": "0HLFM6TRL6DLE:00000005",
  "TimeStamp": "2018-07-30T16:16:15Z",
  "ProcessId": 28608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:16:15.210 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:15.219 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:15.224 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-30 19:16:15.235 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-30 19:16:15.238 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-30 19:16:15.252 +03:00 [DBG] Start authorize callback request
2018-07-30 19:16:15.260 +03:00 [DBG] User in authorize request: 249d64e3-44cf-4dff-b4b2-3e7ae960a432
2018-07-30 19:16:15.262 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:16:15.315 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:15.317 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:16:15.319 +03:00 [DBG] No PKCE used.
2018-07-30 19:16:15.330 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:15.404 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:15.411 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:15.425 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:15.432 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:16:15.435 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
  "Nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
  "SessionId": "d20a7d0607a420e19f7fd8974cf1251b",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-30 19:16:15.462 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-30 19:16:15.465 +03:00 [INF] Showing consent: User has not yet consented
2018-07-30 19:16:15.485 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:15.490 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:15.516 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:16:15.542 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:15.544 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:16:15.546 +03:00 [DBG] No PKCE used.
2018-07-30 19:16:15.554 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:15.569 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:15.576 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:15.591 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:15.594 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:16:15.619 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:15.629 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:15.706 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:24.874 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-30 19:16:24.880 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:24.886 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:24.919 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:16:24.947 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:24.949 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:16:24.953 +03:00 [DBG] No PKCE used.
2018-07-30 19:16:24.960 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:24.977 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:24.988 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:25.006 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:25.009 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:16:25.042 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:25.048 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-07-30 19:16:25.053 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-30 19:16:25.057 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-30 19:16:25.060 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-30 19:16:25.062 +03:00 [DBG] Start authorize callback request
2018-07-30 19:16:25.102 +03:00 [DBG] User in authorize request: 249d64e3-44cf-4dff-b4b2-3e7ae960a432
2018-07-30 19:16:25.106 +03:00 [DBG] Start authorize request protocol validation
2018-07-30 19:16:25.142 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:25.144 +03:00 [DBG] Checking for PKCE parameters
2018-07-30 19:16:25.147 +03:00 [DBG] No PKCE used.
2018-07-30 19:16:25.156 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:25.172 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:25.181 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:25.197 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:25.201 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-30 19:16:25.204 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
  "Nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
  "SessionId": "d20a7d0607a420e19f7fd8974cf1251b",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636685640782344872.MGZiNjJjMjctMTIxMy00MDVkLWE2NzYtMzUwMzM5NWMyYzE4MjcxNzI4NTgtMDZjMC00OWZhLWE4NWYtMzM0NGJkYTZhMDZk",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-30 19:16:25.223 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-30 19:16:25.233 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-30 19:16:25.241 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-30 19:16:25.258 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 249d64e3-44cf-4dff-b4b2-3e7ae960a432
2018-07-30 19:16:25.309 +03:00 [DBG] GUtLGrB4C8UJvHlDuRX8otgKY2Wk7gBZ2U/wFnR9dKA= not found in database
2018-07-30 19:16:25.399 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-30 19:16:25.439 +03:00 [DBG] cEVZFyP3SDsjibpyHQJaRlEcoChF1upXn9fIX2hc6tk= not found in database
2018-07-30 19:16:25.454 +03:00 [DBG] Creating Implicit Flow response.
2018-07-30 19:16:25.471 +03:00 [DBG] Getting claims for identity token for subject: 249d64e3-44cf-4dff-b4b2-3e7ae960a432 and client: mvc
2018-07-30 19:16:25.476 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-30 19:16:25.560 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****r1XA"
    },
    {
      "TokenType": "code",
      "TokenValue": "****39e3"
    }
  ],
  "ActivityId": "0HLFM6TRL6DLE:00000009",
  "TimeStamp": "2018-07-30T16:16:25Z",
  "ProcessId": 28608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:16:25.570 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL5ln3RKPuk-MQ4WSWJ9WVpo0on2uX7nyZO2yRk_UwTvWY9kvvO1_ep1kiQ5RPMpyXZT5haXj8HwAbxLKAaH56x1RD-NmxJXoK7W9xQbDWtXVlPJrFoyV3ZAcBAAKiYKFOFCCYvyOAgdLFmrwsFE6S9RKbK3zdyiZ-B4N-Kd-EPU3OYNVVHbHSGnMBYuPdrL4J1e6ve_xTTBQEQxIHBacSICEkfKBDjZMrZmkObRLNJOkmZpsmSkKqZ8Ym7_3Uf5N_R0OpiYFvwyKCkPQPLtPyvlRXtJaSt0sYZmwKKfZK4_q0Cr1FqScUB2RtbIyuA8Lc",
  "Scope": "openid profile api1 offline_access"
}
2018-07-30 19:16:25.595 +03:00 [DBG] Augmenting SignInContext
2018-07-30 19:16:25.598 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-30 19:16:25.796 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-30 19:16:25.805 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-30 19:16:25.807 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-30 19:16:25.818 +03:00 [DBG] Start token request.
2018-07-30 19:16:25.826 +03:00 [DBG] Start client validation
2018-07-30 19:16:25.834 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-30 19:16:25.840 +03:00 [DBG] Start parsing for secret in post body
2018-07-30 19:16:25.842 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-30 19:16:25.844 +03:00 [DBG] Secret id found: mvc
2018-07-30 19:16:25.877 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:25.894 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-30 19:16:25.897 +03:00 [DBG] Client validation success
2018-07-30 19:16:25.906 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFM6TRL6DLN:00000001",
  "TimeStamp": "2018-07-30T16:16:25Z",
  "ProcessId": 28608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:16:25.918 +03:00 [DBG] Start token request validation
2018-07-30 19:16:25.933 +03:00 [DBG] Start validation of authorization code token request
2018-07-30 19:16:25.960 +03:00 [DBG] cEVZFyP3SDsjibpyHQJaRlEcoChF1upXn9fIX2hc6tk= found in database: true
2018-07-30 19:16:25.996 +03:00 [DBG] removing cEVZFyP3SDsjibpyHQJaRlEcoChF1upXn9fIX2hc6tk= persisted grant from database
2018-07-30 19:16:26.032 +03:00 [DBG] Validation of authorization code token request success
2018-07-30 19:16:26.050 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "a64cd0107ee582c6a8795fa1c2ac5a2044e9e59bd8ec5a1db563b11d5fa839e3",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "a64cd0107ee582c6a8795fa1c2ac5a2044e9e59bd8ec5a1db563b11d5fa839e3",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-30 19:16:26.096 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:26.106 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:26.127 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:26.144 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-30 19:16:26.148 +03:00 [DBG] Getting claims for access token for subject: 249d64e3-44cf-4dff-b4b2-3e7ae960a432
2018-07-30 19:16:26.174 +03:00 [DBG] Creating refresh token
2018-07-30 19:16:26.176 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-30 19:16:26.198 +03:00 [DBG] V97i9lpvLfFw7NyUaY9lE5KMGcPHbsYdaWbhx9c3AFU= not found in database
2018-07-30 19:16:26.232 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:26.240 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:26.256 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-30 19:16:26.260 +03:00 [DBG] Getting claims for identity token for subject: 249d64e3-44cf-4dff-b4b2-3e7ae960a432 and client: mvc
2018-07-30 19:16:26.262 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-30 19:16:26.269 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Sc5g"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****3663"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****MQCQ"
    }
  ],
  "ActivityId": "0HLFM6TRL6DLN:00000001",
  "TimeStamp": "2018-07-30T16:16:26Z",
  "ProcessId": 28608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-30 19:16:26.274 +03:00 [DBG] Token request success.
2018-07-30 19:16:26.298 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-30 19:16:26.305 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-30 19:16:26.307 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-30 19:16:26.321 +03:00 [DBG] Start userinfo request
2018-07-30 19:16:26.330 +03:00 [DBG] Bearer token found in header
2018-07-30 19:16:26.426 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:26.458 +03:00 [DBG] mvc found in database: true
2018-07-30 19:16:26.468 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-30 19:16:26.476 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532967386,
    "exp": 1532970986,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "249d64e3-44cf-4dff-b4b2-3e7ae960a432",
    "auth_time": 1532967375,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-07-30 19:16:26.489 +03:00 [DBG] Creating userinfo response
2018-07-30 19:16:26.495 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-30 19:16:26.503 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-30 19:16:26.514 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:26.518 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-30 19:16:26.520 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-30 19:16:26.528 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-30 19:16:26.541 +03:00 [INF] Profile service returned to the following claim types: sub preferred_username name
2018-07-30 19:16:26.544 +03:00 [DBG] End userinfo request
2018-07-31 11:04:02.238 +03:00 [FTL] Application startup exception
System.InvalidOperationException: Scheme already exists: Identity.Application
   at Microsoft.AspNetCore.Authentication.AuthenticationOptions.AddScheme(String name, Action`1 configureBuilder)
   at Microsoft.Extensions.Options.OptionsFactory`1.Create(String name)
   at System.Lazy`1.ViaFactory(LazyThreadSafetyMode mode)
   at System.Lazy`1.ExecutionAndPublication(LazyHelper executionAndPublication, Boolean useDefaultConstructor)
   at System.Lazy`1.CreateValue()
   at Microsoft.AspNetCore.Authentication.AuthenticationSchemeProvider..ctor(IOptions`1 options, IDictionary`2 schemes)
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScoped(ScopedCallSite scopedCallSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Microsoft.AspNetCore.Builder.IdentityServerApplicationBuilderExtensions.<ValidateAsync>d__2.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.IdentityServerApplicationBuilderExtensions.Validate(IApplicationBuilder app) in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Configuration\IdentityServerApplicationBuilderExtensions.cs:line 73
   at Microsoft.AspNetCore.Builder.IdentityServerApplicationBuilderExtensions.UseIdentityServer(IApplicationBuilder app) in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Configuration\IdentityServerApplicationBuilderExtensions.cs:line 29
   at IdentityServer.Startup.Configure(IApplicationBuilder app, IHostingEnvironment env) in D:\AuthPoc\IdentityServer\Startup.cs:line 132
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.Configure(IApplicationBuilder app)
   at Microsoft.AspNetCore.ApplicationInsights.HostingStartup.ApplicationInsightsLoggerStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder builder)
   at Microsoft.ApplicationInsights.AspNetCore.ApplicationInsightsStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder app)
   at Microsoft.AspNetCore.Hosting.Internal.AutoRequestServicesStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder builder)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2018-07-31 11:07:45.461 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 11:07:45.573 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 11:07:45.610 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 11:07:45.634 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 11:07:45.642 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 11:07:46.042 +03:00 [DBG] Starting token cleanup
2018-07-31 11:08:58.996 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 11:08:59.060 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 11:08:59.066 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 11:08:59.069 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 11:08:59.073 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 11:08:59.427 +03:00 [DBG] Starting token cleanup
2018-07-31 11:09:04.109 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-07-31 11:09:04.119 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-07-31 11:09:04.122 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-07-31 11:09:04.129 +03:00 [INF] Identity.Application was not authenticated. Failure message: No principal.
2018-07-31 11:09:04.147 +03:00 [INF] Identity.Application was not authenticated. Failure message: No principal.
2018-07-31 11:09:13.495 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 11:09:13.505 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 11:09:13.508 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 11:09:13.514 +03:00 [DBG] Start discovery request
2018-07-31 11:09:14.415 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 11:09:19.798 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 11:09:19.803 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 11:09:19.806 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 11:09:19.809 +03:00 [DBG] Start discovery request
2018-07-31 11:09:19.838 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 11:09:20.072 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 11:09:20.076 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 11:09:20.078 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 11:09:20.085 +03:00 [DBG] Start key discovery request
2018-07-31 11:09:20.189 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-07-31 11:09:20.199 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-07-31 11:09:20.205 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-07-31 11:09:20.224 +03:00 [DBG] Processing signout request for anonymous
2018-07-31 11:09:20.232 +03:00 [DBG] Start end session request validation
2018-07-31 11:09:20.242 +03:00 [DBG] Start identity token validation
2018-07-31 11:09:20.708 +03:00 [DBG] mvc found in database: true
2018-07-31 11:09:20.712 +03:00 [DBG] Client found: mvc / MVC Client
2018-07-31 11:09:20.783 +03:00 [ERR] User marked as not active: 249d64e3-44cf-4dff-b4b2-3e7ae960a432
2018-07-31 11:09:20.796 +03:00 [INF] End session request validation failure: Error validating id token hint
{
  "SubjectId": "unknown",
  "Raw": {
    "post_logout_redirect_uri": "http://localhost:5002/signout-callback-oidc",
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY2NzZhNjNmM2QxZmRmYTNmMzgyZGNmZDNkYjNkZjc3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MzI5NjczODYsImV4cCI6MTUzMjk2NzY4NiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoibXZjIiwibm9uY2UiOiI2MzY2ODU2NDA3ODIzNDQ4NzIuTUdaaU5qSmpNamN0TVRJeE15MDBNRFZrTFdFMk56WXRNelV3TXpNNU5XTXlZekU0TWpjeE56STROVGd0TURaak1DMDBPV1poTFdFNE5XWXRNek0wTkdKa1lUWmhNRFprIiwiaWF0IjoxNTMyOTY3Mzg2LCJhdF9oYXNoIjoia3hDWUNPRS1hYkdZdjFITXdUMXhvdyIsInNpZCI6ImQyMGE3ZDA2MDdhNDIwZTE5ZjdmZDg5NzRjZjEyNTFiIiwic3ViIjoiMjQ5ZDY0ZTMtNDRjZi00ZGZmLWI0YjItM2U3YWU5NjBhNDMyIiwiYXV0aF90aW1lIjoxNTMyOTY3Mzc1LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.a-gmP8Yl9dNMfQWSFekzZW1oeadgu4YlLY6VeYWL2IR7yQksbnrL3dI-RZzMEtAN51drwILfUXv_GJ72T1prpCwygxm3kai73QG7ehr_M-VxuJnXn7tZyvU3IiKWAMHAEfjgO44iq0mg5H4_367z0Q6Es1DBU1kahzD11NG3pi8jyENF9po7Cjpfqdsga4hscQ3qG845QFtTFCEaWbMf9ghizWnTL3H0M2kEioj5KbPiQ8gNm-IYuXI1A21DagU9J_8gMAFkERHr5ConlVEEASDwjgFQuEsm1aBS82t_bDHnP89jEQYE8HPzXP3j9YXC9YPg82GIYLXf8Mx00sSc5g",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIq_ltwtui_Bn5DsxPlZrRS2au8eK5qskgf-G1MSxfyNL5p_GfCAgJhlMZYG7yBEeDxbb49Gs99dGJu6DgsHtFLEEx4-nu57FBDBYyf-qVoxNbwpGmjHyea6-NrKmEJ0cv9jESdmmRRRDgBGapAhg1B",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 11:09:20.802 +03:00 [ERR] Error processing end session request Invalid request
2018-07-31 11:13:01.704 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 11:13:01.713 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 11:13:01.716 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 11:13:01.727 +03:00 [DBG] Start authorize request
2018-07-31 11:13:01.734 +03:00 [DBG] No user present in authorize request
2018-07-31 11:13:01.743 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:01.796 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:01.804 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:01.808 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:01.865 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:01.992 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:02.014 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:02.030 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:02.042 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:02.056 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
  "Nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 11:13:02.074 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 11:13:02.139 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:02.165 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:02.168 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:02.171 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:02.179 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:02.194 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:02.201 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:02.215 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:02.217 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:02.245 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:09.911 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 11:13:14.130 +03:00 [WRN] Invalid password for user ddb5688a-19ff-4d46-8199-645663391740.
2018-07-31 11:13:14.135 +03:00 [WRN] User ddb5688a-19ff-4d46-8199-645663391740 failed to provide the correct password.
2018-07-31 11:13:14.613 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLFMNJFGA09H:00000008",
  "TimeStamp": "2018-07-31T08:13:14Z",
  "ProcessId": 36088,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 11:13:14.619 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:14.652 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:14.654 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:14.657 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:14.670 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:14.687 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:14.699 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:14.717 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:14.721 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:14.757 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:44.664 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 11:13:48.144 +03:00 [DBG] Augmenting SignInContext
2018-07-31 11:13:48.153 +03:00 [DBG] Adding idp claim with value: local
2018-07-31 11:13:48.155 +03:00 [DBG] Adding amr claim with value: pwd
2018-07-31 11:13:48.158 +03:00 [DBG] Adding auth_time claim with value: 1533024828
2018-07-31 11:13:48.190 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 11:13:50.429 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "andrei_krasnou@epam.com",
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "DisplayName": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "ActivityId": "0HLFMNJFGA09H:00000009",
  "TimeStamp": "2018-07-31T08:13:50Z",
  "ProcessId": 36088,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 11:13:50.469 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 11:13:50.480 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 11:13:50.488 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 11:13:50.504 +03:00 [DBG] Start authorize callback request
2018-07-31 11:13:50.512 +03:00 [DBG] User in authorize request: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 11:13:50.514 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:50.561 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:50.563 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:50.567 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:50.578 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:50.664 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:50.675 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:50.691 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:50.695 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:50.697 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
  "Nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
  "SessionId": "0a3c8a487198d8493883734cbab573d1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 11:13:50.734 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 11:13:50.736 +03:00 [INF] Showing consent: User has not yet consented
2018-07-31 11:13:50.774 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:50.800 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:50.803 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:50.806 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:50.815 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:50.831 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:50.840 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:50.857 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:50.859 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:50.885 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:50.895 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:50.965 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:52.980 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 11:13:53.026 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:53.056 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:53.058 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:53.061 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:53.068 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:53.084 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:53.092 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:53.107 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:53.112 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:53.143 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 11:13:53.148 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 11:13:53.153 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 11:13:53.158 +03:00 [DBG] Start authorize callback request
2018-07-31 11:13:53.193 +03:00 [DBG] User in authorize request: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 11:13:53.198 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 11:13:53.237 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:53.239 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 11:13:53.241 +03:00 [DBG] No PKCE used.
2018-07-31 11:13:53.249 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:53.265 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:53.275 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:53.292 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:53.295 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 11:13:53.299 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
  "Nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
  "SessionId": "0a3c8a487198d8493883734cbab573d1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686215816836419.OWVlMzNhNjEtYWFkMS00OWY4LWI5NDctOTRiZDczMGZmMDY4ZmIwZTQ1OTgtYjFmMC00ZjIxLTk3MzQtZWViYmE3MTllNDYy",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 11:13:53.319 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 11:13:53.328 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-31 11:13:53.332 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-31 11:13:53.339 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 11:13:53.387 +03:00 [DBG] WtG9i/4bGVHKYfwYW85p4Xd6lWfEOG9rFJ978iI5pvs= not found in database
2018-07-31 11:13:53.476 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-31 11:13:53.506 +03:00 [DBG] ws1VYviqQrXryKDjw/d/qZLXS3IpooUJqjOF8ewfnKk= not found in database
2018-07-31 11:13:53.519 +03:00 [DBG] Creating Implicit Flow response.
2018-07-31 11:13:53.531 +03:00 [DBG] Getting claims for identity token for subject: ddb5688a-19ff-4d46-8199-645663391740 and client: mvc
2018-07-31 11:13:53.537 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 11:13:53.587 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Y66w"
    },
    {
      "TokenType": "code",
      "TokenValue": "****d410"
    }
  ],
  "ActivityId": "0HLFMNJFGA09H:0000000D",
  "TimeStamp": "2018-07-31T08:13:53Z",
  "ProcessId": 36088,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 11:13:53.597 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzICtF1dtmUwyJqoyckyAsVPGXCdGgtGI58_cD4qPOVLRq3BNj5Y9MQ_WOqZBhMzrcBcpiJJYnjOOl7FslzApMfOSQ-xO9yIl1CijvmmGMLT34tHuLe9hB6FgqrbOuECXmtwZUf-uYtIcuic-3TalXZejpfRnfFN8jjDiafqp4EPydUarxmWXX4KyVgg4Fy1yzQ9m573pFAO9G9G5j-gQZeTWZmvx-PSV-e1rpcj34FbL5GzSVU8KYntnVq7PLsUcYBJMRI8798FDPLJRxuqJOLxVR2_sA2SxVZMHxOvMqHEobyK-1SMpoI-3E0rltV5sRk",
  "Scope": "openid profile api1 offline_access"
}
2018-07-31 11:13:53.622 +03:00 [DBG] Augmenting SignInContext
2018-07-31 11:13:53.625 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 11:13:53.783 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-31 11:13:53.792 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-31 11:13:53.795 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-31 11:13:53.807 +03:00 [DBG] Start token request.
2018-07-31 11:13:53.816 +03:00 [DBG] Start client validation
2018-07-31 11:13:53.825 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-31 11:13:53.832 +03:00 [DBG] Start parsing for secret in post body
2018-07-31 11:13:53.836 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-31 11:13:53.839 +03:00 [DBG] Secret id found: mvc
2018-07-31 11:13:53.874 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:53.887 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-31 11:13:53.890 +03:00 [DBG] Client validation success
2018-07-31 11:13:53.897 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFMNJFGA09O:00000001",
  "TimeStamp": "2018-07-31T08:13:53Z",
  "ProcessId": 36088,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 11:13:53.906 +03:00 [DBG] Start token request validation
2018-07-31 11:13:53.919 +03:00 [DBG] Start validation of authorization code token request
2018-07-31 11:13:53.948 +03:00 [DBG] ws1VYviqQrXryKDjw/d/qZLXS3IpooUJqjOF8ewfnKk= found in database: true
2018-07-31 11:13:53.988 +03:00 [DBG] removing ws1VYviqQrXryKDjw/d/qZLXS3IpooUJqjOF8ewfnKk= persisted grant from database
2018-07-31 11:13:54.016 +03:00 [DBG] Validation of authorization code token request success
2018-07-31 11:13:54.027 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "c28fd54b5c5437506b2bbc5631eb2137984d22e97bcd6ecf1515b0abf1e8d410",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "c28fd54b5c5437506b2bbc5631eb2137984d22e97bcd6ecf1515b0abf1e8d410",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-31 11:13:54.067 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:54.079 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:54.095 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:54.111 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-31 11:13:54.115 +03:00 [DBG] Getting claims for access token for subject: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 11:13:54.153 +03:00 [DBG] Creating refresh token
2018-07-31 11:13:54.156 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-31 11:13:54.183 +03:00 [DBG] O1IGBASIqMRAaV3L9lrrxwLLB8N9NgMeFZMw1hWmKII= not found in database
2018-07-31 11:13:54.217 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:54.225 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:54.241 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 11:13:54.245 +03:00 [DBG] Getting claims for identity token for subject: ddb5688a-19ff-4d46-8199-645663391740 and client: mvc
2018-07-31 11:13:54.247 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 11:13:54.254 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****HgVQ"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****9cbc"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****Fqxw"
    }
  ],
  "ActivityId": "0HLFMNJFGA09O:00000001",
  "TimeStamp": "2018-07-31T08:13:54Z",
  "ProcessId": 36088,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 11:13:54.260 +03:00 [DBG] Token request success.
2018-07-31 11:13:54.280 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-31 11:13:54.286 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-31 11:13:54.289 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-31 11:13:54.300 +03:00 [DBG] Start userinfo request
2018-07-31 11:13:54.307 +03:00 [DBG] Bearer token found in header
2018-07-31 11:13:54.350 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:54.377 +03:00 [DBG] mvc found in database: true
2018-07-31 11:13:54.389 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-31 11:13:54.397 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533024834,
    "exp": 1533028434,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "ddb5688a-19ff-4d46-8199-645663391740",
    "auth_time": 1533024828,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-07-31 11:13:54.415 +03:00 [DBG] Creating userinfo response
2018-07-31 11:13:54.422 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 11:13:54.427 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 11:13:54.439 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:54.443 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-31 11:13:54.445 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 11:13:54.454 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 11:13:54.469 +03:00 [INF] Profile service returned to the following claim types: sub preferred_username name
2018-07-31 11:13:54.474 +03:00 [DBG] End userinfo request
2018-07-31 12:41:28.118 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 12:41:28.185 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 12:41:28.189 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 12:41:28.192 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 12:41:28.195 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 12:41:28.450 +03:00 [DBG] Starting token cleanup
2018-07-31 12:43:34.083 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 12:43:34.113 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 12:43:34.115 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 12:43:34.123 +03:00 [DBG] Start discovery request
2018-07-31 12:43:34.974 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 12:43:35.300 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 12:43:35.303 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 12:43:35.305 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 12:43:35.310 +03:00 [DBG] Start key discovery request
2018-07-31 12:43:35.446 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-07-31 12:43:35.453 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-07-31 12:43:35.459 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-07-31 12:43:35.484 +03:00 [DBG] Processing signout request for ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 12:43:35.495 +03:00 [DBG] Start end session request validation
2018-07-31 12:43:35.505 +03:00 [DBG] Start identity token validation
2018-07-31 12:43:35.944 +03:00 [DBG] mvc found in database: true
2018-07-31 12:43:35.948 +03:00 [DBG] Client found: mvc / MVC Client
2018-07-31 12:43:36.020 +03:00 [ERR] User marked as not active: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 12:43:36.032 +03:00 [INF] End session request validation failure: Error validating id token hint
{
  "SubjectId": "unknown",
  "Raw": {
    "post_logout_redirect_uri": "http://localhost:5002/signout-callback-oidc",
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY2NzZhNjNmM2QxZmRmYTNmMzgyZGNmZDNkYjNkZjc3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MzMwMjQ4MzQsImV4cCI6MTUzMzAyNTEzNCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoibXZjIiwibm9uY2UiOiI2MzY2ODYyMTU4MTY4MzY0MTkuT1dWbE16TmhOakV0WVdGa01TMDBPV1k0TFdJNU5EY3RPVFJpWkRjek1HWm1NRFk0Wm1Jd1pUUTFPVGd0WWpGbU1DMDBaakl4TFRrM016UXRaV1ZpWW1FM01UbGxORFl5IiwiaWF0IjoxNTMzMDI0ODM0LCJhdF9oYXNoIjoibU43aHM2SFg0STJ6VGpmOEJZZUhvZyIsInNpZCI6IjBhM2M4YTQ4NzE5OGQ4NDkzODgzNzM0Y2JhYjU3M2QxIiwic3ViIjoiZGRiNTY4OGEtMTlmZi00ZDQ2LTgxOTktNjQ1NjYzMzkxNzQwIiwiYXV0aF90aW1lIjoxNTMzMDI0ODI4LCJpZHAiOiJsb2NhbCIsImFtciI6WyJwd2QiXX0.DwZNMcZeXWyIT_hWv4LzLA5h3QBU6vcbJrKjzeck5Bk3p46yx6lq-swIyfcF58PJo8NhA6PoSM0bPhVGfpP0qgR7yptEJCjyeZcgeAVCNeVD9Xo-CaSf4L7yoWBBjNuRBKa_4OstWS99zFZd3SYGZo2shY3Dz3JAj8BL683BMEnedXGxJB5dr_6BlvTHyrItd96IHskgPjtemBSw0bOGgeacJXVvzBgRFXYgpendEzzud77RFcL4XiL75gX97HEXm2RbJfArXDSGcrOaUh2j4c40jslfaaH8fOgRIiPaOoPYK5upBAzgmmX06iKSYG_Hmc5qvzvBdNkW7EUK-KHgVQ",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzINMfwZbEYMKmaejyGE6hDWldiNFgYYVmbm64WM1_mB04PNyMgdPKp9g82-Pr_MsMAgI8uJghGDXt-aOIf6unjMdW4IUqSTp2D1nmQDZgqigToa6S947386TOA7G6F5e2TCjlNQ3_CJCHzuTPsXFPN9",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 12:43:36.037 +03:00 [ERR] Error processing end session request Invalid request
2018-07-31 12:43:39.438 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 12:43:39.447 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 12:43:39.449 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 12:43:39.456 +03:00 [DBG] Start authorize request
2018-07-31 12:43:39.465 +03:00 [DBG] User in authorize request: ddb5688a-19ff-4d46-8199-645663391740
2018-07-31 12:43:39.472 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 12:43:39.527 +03:00 [DBG] mvc found in database: true
2018-07-31 12:43:39.534 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 12:43:39.537 +03:00 [DBG] No PKCE used.
2018-07-31 12:43:39.595 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:39.718 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:39.744 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:39.763 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:39.777 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 12:43:39.790 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJES7Wd9AKXs3mxa2yOdi-YfjOuXKTR8rnFZG1PpJhv3r-eU0C5akTvOJmncvxIEKsysRiNOq9SW05a6jKLthyCfi7jJJqSOkt492-6IrYHKaFDbfRnlRUQd_qv0z0Uchw1OL1zmOpodxbGSsmDyn-NpDs28FjepNqRjdrwCUMm3cIT_UaFZOiQfkNTDtgRZvujvs8xpuhAFRFEbN8Dt7LzmDLbW05yaNzznqQF1rD2twDo_BMM_4piXC7wN-_MrUsjKgzB-E_e72NBnZeOl-TKT5GrnC11gnSSnUMH7-5LDwCDLFS08d_399-yi2xqQ2I",
  "Nonce": "636686270194201073.YTNmZGU1OTktNDllMC00NGE0LWEzOWQtZjdjMzdhNjdiOTJkOWU1MzliNzEtMTUyZC00ZmE2LTk0YTgtMmU3NjUzYzYyNDgy",
  "SessionId": "0a3c8a487198d8493883734cbab573d1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686270194201073.YTNmZGU1OTktNDllMC00NGE0LWEzOWQtZjdjMzdhNjdiOTJkOWU1MzliNzEtMTUyZC00ZmE2LTk0YTgtMmU3NjUzYzYyNDgy",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJES7Wd9AKXs3mxa2yOdi-YfjOuXKTR8rnFZG1PpJhv3r-eU0C5akTvOJmncvxIEKsysRiNOq9SW05a6jKLthyCfi7jJJqSOkt492-6IrYHKaFDbfRnlRUQd_qv0z0Uchw1OL1zmOpodxbGSsmDyn-NpDs28FjepNqRjdrwCUMm3cIT_UaFZOiQfkNTDtgRZvujvs8xpuhAFRFEbN8Dt7LzmDLbW05yaNzznqQF1rD2twDo_BMM_4piXC7wN-_MrUsjKgzB-E_e72NBnZeOl-TKT5GrnC11gnSSnUMH7-5LDwCDLFS08d_399-yi2xqQ2I",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 12:43:39.811 +03:00 [INF] Showing login: User is not active
2018-07-31 12:43:39.878 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 12:43:39.911 +03:00 [DBG] mvc found in database: true
2018-07-31 12:43:39.913 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 12:43:39.915 +03:00 [DBG] No PKCE used.
2018-07-31 12:43:39.925 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:39.941 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:39.950 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:39.968 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:39.972 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 12:43:40.005 +03:00 [DBG] mvc found in database: true
2018-07-31 12:43:52.643 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 12:43:52.812 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLFMP7562CH1:00000006",
  "TimeStamp": "2018-07-31T09:43:52Z",
  "ProcessId": 29572,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 12:43:52.817 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 12:43:52.849 +03:00 [DBG] mvc found in database: true
2018-07-31 12:43:52.851 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 12:43:52.854 +03:00 [DBG] No PKCE used.
2018-07-31 12:43:52.862 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:52.877 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:52.884 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:43:52.899 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:43:52.902 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 12:43:52.928 +03:00 [DBG] mvc found in database: true
2018-07-31 12:44:00.096 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 12:44:00.107 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 12:44:00.141 +03:00 [DBG] mvc found in database: true
2018-07-31 12:44:00.143 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 12:44:00.145 +03:00 [DBG] No PKCE used.
2018-07-31 12:44:00.157 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:44:00.179 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:44:00.189 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:44:00.205 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:44:00.209 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 12:44:00.237 +03:00 [DBG] mvc found in database: true
2018-07-31 12:48:07.305 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 12:48:41.642 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLFMP7562CH1:00000008",
  "TimeStamp": "2018-07-31T09:48:41Z",
  "ProcessId": 29572,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 12:48:45.161 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 12:48:45.219 +03:00 [DBG] mvc found in database: true
2018-07-31 12:48:45.220 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 12:48:45.222 +03:00 [DBG] No PKCE used.
2018-07-31 12:48:45.235 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:48:45.307 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:48:45.316 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 12:48:45.338 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 12:48:45.341 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 12:48:45.371 +03:00 [DBG] mvc found in database: true
2018-07-31 12:51:11.462 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 12:51:11.600 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 12:51:11.628 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 12:51:11.633 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 12:51:11.641 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 12:51:12.302 +03:00 [DBG] Starting token cleanup
2018-07-31 13:01:05.039 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:01:05.105 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:01:05.127 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:01:05.141 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:01:05.154 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:01:05.607 +03:00 [DBG] Starting token cleanup
2018-07-31 13:01:17.424 +03:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 13:01:17.559 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-07-31 13:01:17.563 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-07-31 13:01:17.565 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-07-31 13:01:17.621 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "ddb5688a-19ff-4d46-8199-645663391740",
  "DisplayName": "andrei_krasnou@epam.com",
  "ActivityId": "0HLFMPI420CR3:00000003",
  "TimeStamp": "2018-07-31T10:01:17Z",
  "ProcessId": 8680,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 13:01:17.818 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-07-31 13:01:17.833 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-07-31 13:01:17.838 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-07-31 13:01:17.854 +03:00 [DBG] Processing signout callback request
2018-07-31 13:01:20.646 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:20.653 +03:00 [DBG] No client front-channel logout URLs
2018-07-31 13:01:20.656 +03:00 [DBG] No client back-channel logout URLs
2018-07-31 13:01:20.659 +03:00 [INF] Successful signout callback.
2018-07-31 13:01:20.661 +03:00 [DBG] No client front-channel iframe urls
2018-07-31 13:01:20.665 +03:00 [DBG] No client back-channel iframe urls
2018-07-31 13:01:22.233 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:01:22.240 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:01:22.243 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:01:22.251 +03:00 [DBG] Start discovery request
2018-07-31 13:01:22.563 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:01:22.835 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:01:22.840 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:01:22.842 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:01:22.851 +03:00 [DBG] Start key discovery request
2018-07-31 13:01:22.931 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:01:22.942 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:01:22.946 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:01:22.957 +03:00 [DBG] Start authorize request
2018-07-31 13:01:22.965 +03:00 [DBG] No user present in authorize request
2018-07-31 13:01:22.974 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:23.013 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:23.022 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:23.025 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:23.086 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:23.209 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:23.234 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:23.255 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:23.272 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:23.289 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWECvLH4CLcIhbAW4jAv1NAVFmvEjwrQl7KlqLQEdzEFP6OQc0ggHl4lIHmMljfy40HaAS4FEE7IRuxTCz0GUVzKhVzYR7W1fcqX0m4-dU92jRZWim4YIJWq8vLUDsX3m43ghpipZj6DlBRqewPSSnbhUglUN_oiYCuV4PWmw3_bvA8JUnfb_d4E99eMNL9UMfALiCY1yBIH-9C9kQzRZrpjfGaDvYkfCZq0irhQfZGdGurwNgR5rFWjPA_FSiPG5omAYm3qEtr3lgLUXKEZd48VFQtMSJycLIlrmn1jxpyhO7LyTcnbJ2H8UF5UH2S0k",
  "Nonce": "636686280829023232.YmFlOWExZDYtOGI3MC00ZGI0LWI5MzctNTFkZjk4MzMyMDE4ZTI3MTZiMzEtNWVmMi00OTIxLTg3OGYtOWVkYjhjMDQ4NTM1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686280829023232.YmFlOWExZDYtOGI3MC00ZGI0LWI5MzctNTFkZjk4MzMyMDE4ZTI3MTZiMzEtNWVmMi00OTIxLTg3OGYtOWVkYjhjMDQ4NTM1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWECvLH4CLcIhbAW4jAv1NAVFmvEjwrQl7KlqLQEdzEFP6OQc0ggHl4lIHmMljfy40HaAS4FEE7IRuxTCz0GUVzKhVzYR7W1fcqX0m4-dU92jRZWim4YIJWq8vLUDsX3m43ghpipZj6DlBRqewPSSnbhUglUN_oiYCuV4PWmw3_bvA8JUnfb_d4E99eMNL9UMfALiCY1yBIH-9C9kQzRZrpjfGaDvYkfCZq0irhQfZGdGurwNgR5rFWjPA_FSiPG5omAYm3qEtr3lgLUXKEZd48VFQtMSJycLIlrmn1jxpyhO7LyTcnbJ2H8UF5UH2S0k",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:01:23.308 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:01:23.367 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:23.394 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:23.397 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:23.401 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:23.408 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:23.423 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:23.433 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:23.448 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:23.452 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:23.481 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:27.322 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:01:45.761 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:01:45.770 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:01:45.782 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:01:45.802 +03:00 [DBG] Start authorize request
2018-07-31 13:01:45.811 +03:00 [DBG] No user present in authorize request
2018-07-31 13:01:45.814 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:45.871 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:45.875 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:45.878 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:45.890 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.029 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.042 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.059 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.062 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:46.065 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLHZi-vpNSW19XcezRj9bMCxxcHUcM-0C9jOnaRJmeudPzxcJkKYOCwXkQabZoWDZwDR1qvByLtIhsx8zDv5IGiYWPB3yapC-l5iUKN9Cy7xjp8296AeMUzH72np6A74-InsX0IKK_EHPLhHhZG_OuLEDbOcj5syn4tFrltwhKLcKbiC0TrDXlAz64SP-QH1a9s1Y6g63ou60Ji3Z7JoumqNMmchQ7AdXYKG5kmv-ztsNrjDPIRLSYYSiIOUYj3AgBA5nvlTFpJk68ax8ylg7tjE-TmLOIX53a6HlzeR2GquX22dOtQGjhAuX70cCt-FUo",
  "Nonce": "636686281057370590.NDgzMTcxM2UtOTAwZC00NWEyLTg0MWItMGRlMmIzZDkxMzk2YmNiYTg5ZWItODkyYS00OWY5LWI4ZmQtZThkYmFmNzQxYmI4",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686281057370590.NDgzMTcxM2UtOTAwZC00NWEyLTg0MWItMGRlMmIzZDkxMzk2YmNiYTg5ZWItODkyYS00OWY5LWI4ZmQtZThkYmFmNzQxYmI4",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLHZi-vpNSW19XcezRj9bMCxxcHUcM-0C9jOnaRJmeudPzxcJkKYOCwXkQabZoWDZwDR1qvByLtIhsx8zDv5IGiYWPB3yapC-l5iUKN9Cy7xjp8296AeMUzH72np6A74-InsX0IKK_EHPLhHhZG_OuLEDbOcj5syn4tFrltwhKLcKbiC0TrDXlAz64SP-QH1a9s1Y6g63ou60Ji3Z7JoumqNMmchQ7AdXYKG5kmv-ztsNrjDPIRLSYYSiIOUYj3AgBA5nvlTFpJk68ax8ylg7tjE-TmLOIX53a6HlzeR2GquX22dOtQGjhAuX70cCt-FUo",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:01:46.076 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:01:46.101 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:46.138 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:46.141 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:46.143 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:46.151 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.167 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.176 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.191 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.195 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:46.227 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:46.245 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:46.285 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:46.288 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:46.291 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:46.300 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.317 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.326 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:46.344 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:46.348 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:46.376 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:49.614 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:01:49.651 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:49.654 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:01:49.659 +03:00 [DBG] No PKCE used.
2018-07-31 13:01:49.667 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:49.685 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:49.698 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:01:49.714 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:01:49.718 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:01:49.745 +03:00 [DBG] mvc found in database: true
2018-07-31 13:01:50.842 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:09:41.228 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:09:41.294 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:09:41.299 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:09:41.302 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:09:41.304 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:09:41.770 +03:00 [DBG] Starting token cleanup
2018-07-31 13:10:49.366 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:10:49.402 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:10:49.404 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:10:49.409 +03:00 [DBG] Start discovery request
2018-07-31 13:10:51.932 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:10:52.239 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:10:52.247 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:10:52.249 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:10:52.257 +03:00 [DBG] Start key discovery request
2018-07-31 13:10:52.356 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:10:52.371 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:10:52.374 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:10:52.385 +03:00 [DBG] Start authorize request
2018-07-31 13:10:52.404 +03:00 [DBG] No user present in authorize request
2018-07-31 13:10:52.413 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:10:52.936 +03:00 [DBG] mvc found in database: true
2018-07-31 13:10:52.947 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:10:52.951 +03:00 [DBG] No PKCE used.
2018-07-31 13:10:53.010 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:10:53.150 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:10:53.177 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:10:53.194 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:10:53.210 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:10:53.232 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLgreqyDQOa-T704JHaU3zPb3DlZ75PHgXG9oAEXMivwosMbx5lS6yvml6KI6bM_39Myw8-JznIv_ucxfe7qTzGAsTZg4nLAwKN-AWlK5Ui98rDIEpXqvljwxGPEzSzY_O9KlyVg7bMRZqk6rvBPtEXAsGI9cCMMQeFZtqyViJ98vPyLeCXeVd4cEOxInWE3Lhuzer74nfE0wPcwM4ouQvw3vzSihXbDEwxew3wsGCNX9fy6RJntT-HXRdr58sh75_8SnVJWLIvUJzz9CwUk2f4iIOTCDjpM7VrT8S2zPJ4AbpDxZN1ExwVfWX_0gPDOtY",
  "Nonce": "636686286523321593.NjgzYzIzZTUtYTc4Ny00MmFjLThmOWYtYmFkODYyMGU2NDQxYWMyNGFhNDktZjdkZC00NmIwLTg2MjgtNTMzMjEzMDFlYzVm",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686286523321593.NjgzYzIzZTUtYTc4Ny00MmFjLThmOWYtYmFkODYyMGU2NDQxYWMyNGFhNDktZjdkZC00NmIwLTg2MjgtNTMzMjEzMDFlYzVm",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLgreqyDQOa-T704JHaU3zPb3DlZ75PHgXG9oAEXMivwosMbx5lS6yvml6KI6bM_39Myw8-JznIv_ucxfe7qTzGAsTZg4nLAwKN-AWlK5Ui98rDIEpXqvljwxGPEzSzY_O9KlyVg7bMRZqk6rvBPtEXAsGI9cCMMQeFZtqyViJ98vPyLeCXeVd4cEOxInWE3Lhuzer74nfE0wPcwM4ouQvw3vzSihXbDEwxew3wsGCNX9fy6RJntT-HXRdr58sh75_8SnVJWLIvUJzz9CwUk2f4iIOTCDjpM7VrT8S2zPJ4AbpDxZN1ExwVfWX_0gPDOtY",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:10:53.252 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:10:53.369 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:10:53.400 +03:00 [DBG] mvc found in database: true
2018-07-31 13:10:53.402 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:10:53.404 +03:00 [DBG] No PKCE used.
2018-07-31 13:10:53.411 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:10:53.429 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:10:53.438 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:10:53.455 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:10:53.459 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:10:53.494 +03:00 [DBG] mvc found in database: true
2018-07-31 13:10:57.733 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:11:01.259 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:11:01.329 +03:00 [DBG] mvc found in database: true
2018-07-31 13:11:01.334 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:11:01.337 +03:00 [DBG] No PKCE used.
2018-07-31 13:11:01.350 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:11:01.425 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:11:01.438 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:11:01.456 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:11:01.461 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:11:01.488 +03:00 [DBG] mvc found in database: true
2018-07-31 13:11:05.105 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:11:05.155 +03:00 [DBG] mvc found in database: true
2018-07-31 13:11:05.162 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:11:05.164 +03:00 [DBG] No PKCE used.
2018-07-31 13:11:05.180 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:11:05.204 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:11:05.214 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:11:05.230 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:11:05.235 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:11:05.264 +03:00 [DBG] mvc found in database: true
2018-07-31 13:11:06.812 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:14:07.095 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:14:07.160 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:14:07.165 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:14:07.172 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:14:07.179 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:14:07.545 +03:00 [DBG] Starting token cleanup
2018-07-31 13:14:19.853 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:14:19.891 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:14:19.893 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:14:19.899 +03:00 [DBG] Start discovery request
2018-07-31 13:14:22.421 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:14:22.725 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:14:22.728 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:14:22.730 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:14:22.736 +03:00 [DBG] Start key discovery request
2018-07-31 13:14:22.847 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:14:22.870 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:14:22.876 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:14:22.883 +03:00 [DBG] Start authorize request
2018-07-31 13:14:22.908 +03:00 [DBG] No user present in authorize request
2018-07-31 13:14:22.915 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:14:23.424 +03:00 [DBG] mvc found in database: true
2018-07-31 13:14:23.433 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:14:23.440 +03:00 [DBG] No PKCE used.
2018-07-31 13:14:23.504 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:14:23.625 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:14:23.651 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:14:23.668 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:14:23.682 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:14:23.700 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIZ-gQcAE0qVqa2CPnFSzycwxUf5NAAgEUwvieuAYSyCqMeAq9HDFTZHD7TMbWsfWdT7Mwf4dvWPyfFKCFgbDgBcus56Ng2-ISTDlB5k8APdYNaMgylC84jeSZEBYeU5WkbUxCpdXQDwCxrnCBsb11qirXSujcM9GBy9iiezLhirC2BF9oIcHGdk_Pth0ug6sZ7QLUbMNMBHDXdBqbY8hR4k6zc8AtFrvI9dyRjoby0zN4Xdg-8aPlOIISZAeeNLExeIxYFDCaEPkjUoguFLa09T5hI48zij7mR9-fpw88ZvSzKoqTQIVmwZEYWZK44LJU",
  "Nonce": "636686288628155601.ODU3MGRhZmUtZjk0MC00MTk2LTk5ZTgtMDkxZDFiZmZkN2M4YjNiMWU2ZTgtMWQyZC00NmE4LWI3YzktZjY1ZjljNTY1NDM3",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686288628155601.ODU3MGRhZmUtZjk0MC00MTk2LTk5ZTgtMDkxZDFiZmZkN2M4YjNiMWU2ZTgtMWQyZC00NmE4LWI3YzktZjY1ZjljNTY1NDM3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIZ-gQcAE0qVqa2CPnFSzycwxUf5NAAgEUwvieuAYSyCqMeAq9HDFTZHD7TMbWsfWdT7Mwf4dvWPyfFKCFgbDgBcus56Ng2-ISTDlB5k8APdYNaMgylC84jeSZEBYeU5WkbUxCpdXQDwCxrnCBsb11qirXSujcM9GBy9iiezLhirC2BF9oIcHGdk_Pth0ug6sZ7QLUbMNMBHDXdBqbY8hR4k6zc8AtFrvI9dyRjoby0zN4Xdg-8aPlOIISZAeeNLExeIxYFDCaEPkjUoguFLa09T5hI48zij7mR9-fpw88ZvSzKoqTQIVmwZEYWZK44LJU",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:14:23.718 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:14:23.813 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:14:23.845 +03:00 [DBG] mvc found in database: true
2018-07-31 13:14:23.847 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:14:23.850 +03:00 [DBG] No PKCE used.
2018-07-31 13:14:23.869 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:14:23.888 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:14:23.899 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:14:23.913 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:14:23.917 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:14:23.946 +03:00 [DBG] mvc found in database: true
2018-07-31 13:14:28.473 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:15:35.431 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:15:35.499 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:15:35.507 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:15:35.513 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:15:35.517 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:15:35.900 +03:00 [DBG] Starting token cleanup
2018-07-31 13:15:41.524 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:15:41.576 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:15:41.581 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:15:41.587 +03:00 [DBG] Start discovery request
2018-07-31 13:15:44.276 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:15:44.578 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:15:44.581 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:15:44.584 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:15:44.590 +03:00 [DBG] Start key discovery request
2018-07-31 13:15:44.697 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:15:44.706 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:15:44.709 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:15:44.717 +03:00 [DBG] Start authorize request
2018-07-31 13:15:44.737 +03:00 [DBG] No user present in authorize request
2018-07-31 13:15:44.745 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:15:45.257 +03:00 [DBG] mvc found in database: true
2018-07-31 13:15:45.267 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:15:45.271 +03:00 [DBG] No PKCE used.
2018-07-31 13:15:45.337 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:15:45.480 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:15:45.521 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:15:45.541 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:15:45.561 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:15:45.589 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJRRS-98oAPripDQmKHKN7GMTYDBNbQJQT2UtoAOPJu11qcgsvPSPPfiNMooNcmcTs_cFCQ_vgPVcsik-T8VjWNqHjg3CpnyC2rkBRYac0BhZ2ma6u1XAo1eGvw7uqnblE-S37mCdE36cfHKBWfQ0sD_rlaVcVJJJdBJhtJw3GFkb3z0temV833NZJN_wy-DX64xn85XwbD6nuTmYdWIudZwVJkF3WdGb99Azg2NQWIvtGcAoBg-tOw26vSIAdTXRoDFGpubO03GKkG9abt2bU8CatXsRiWaEfEZAWJ04SSPvgjt9LGnSfW9-Hgmm4v78Y",
  "Nonce": "636686289446764952.MmY2ZDIwODUtOTg1NC00YTFlLWExNTYtOTFiNDAzNDY0ZTk1MWNkOTQ1NDMtYWM1Yi00ZDAxLTk4ZTktMzZlZGZhZGY4OWNl",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686289446764952.MmY2ZDIwODUtOTg1NC00YTFlLWExNTYtOTFiNDAzNDY0ZTk1MWNkOTQ1NDMtYWM1Yi00ZDAxLTk4ZTktMzZlZGZhZGY4OWNl",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJRRS-98oAPripDQmKHKN7GMTYDBNbQJQT2UtoAOPJu11qcgsvPSPPfiNMooNcmcTs_cFCQ_vgPVcsik-T8VjWNqHjg3CpnyC2rkBRYac0BhZ2ma6u1XAo1eGvw7uqnblE-S37mCdE36cfHKBWfQ0sD_rlaVcVJJJdBJhtJw3GFkb3z0temV833NZJN_wy-DX64xn85XwbD6nuTmYdWIudZwVJkF3WdGb99Azg2NQWIvtGcAoBg-tOw26vSIAdTXRoDFGpubO03GKkG9abt2bU8CatXsRiWaEfEZAWJ04SSPvgjt9LGnSfW9-Hgmm4v78Y",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:15:45.608 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:15:45.720 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:15:45.753 +03:00 [DBG] mvc found in database: true
2018-07-31 13:15:45.755 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:15:45.758 +03:00 [DBG] No PKCE used.
2018-07-31 13:15:45.766 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:15:45.788 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:15:45.800 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:15:45.816 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:15:45.819 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:15:45.851 +03:00 [DBG] mvc found in database: true
2018-07-31 13:15:48.530 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:18:07.928 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:18:08.010 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:18:08.028 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:18:08.033 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:18:08.036 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:18:08.549 +03:00 [DBG] Starting token cleanup
2018-07-31 13:18:10.535 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:18:10.686 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:18:10.693 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:18:10.718 +03:00 [DBG] Start discovery request
2018-07-31 13:18:14.902 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:18:15.300 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:18:15.312 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:18:15.314 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:18:15.320 +03:00 [DBG] Start key discovery request
2018-07-31 13:18:15.458 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:18:15.484 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:18:15.487 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:18:15.502 +03:00 [DBG] Start authorize request
2018-07-31 13:18:15.534 +03:00 [DBG] No user present in authorize request
2018-07-31 13:18:15.546 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:18:16.260 +03:00 [DBG] mvc found in database: true
2018-07-31 13:18:16.270 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:18:16.275 +03:00 [DBG] No PKCE used.
2018-07-31 13:18:16.342 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:18:16.478 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:18:16.507 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:18:16.529 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:18:16.548 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:18:16.569 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKpGxRMYWFKA8XK9DWPhLPfpx4E5t_8jZl8zBdq5fZ4KdrNIZIrHmMrO88Ss7tJ1bbym4C1JNvOnupOrb749M6rRuJvcMYXfiy-ZE3eov0Kc7rUQc88Mal5Hlo2pOI_skiy4adB24yH1qrRCid2BBtmd235dRAl-QNfemtti5xXIzZaOpz6MYYC8X45FpiUlS_E1tGcsEMcenKbwWvxErHjb3AR2ON5KZqMP9ZcDdR-UPm5AGg7x4sS-84g33ZIEFw5cNzUee4i7ipTIFBJHwX04FKtemDKtB_RCbPqp9ec2KDMH1YsYaD_iK_nEt5cK4Y",
  "Nonce": "636686290954246474.M2I4NzAzY2QtZDViNy00ZjczLTkyNmUtMDFmZjc5NDY2ODFmYzE4YTk4MWEtMmM1YS00ZTNiLWJjNDUtZWQxMGQ1YjZjMTQ0",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686290954246474.M2I4NzAzY2QtZDViNy00ZjczLTkyNmUtMDFmZjc5NDY2ODFmYzE4YTk4MWEtMmM1YS00ZTNiLWJjNDUtZWQxMGQ1YjZjMTQ0",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKpGxRMYWFKA8XK9DWPhLPfpx4E5t_8jZl8zBdq5fZ4KdrNIZIrHmMrO88Ss7tJ1bbym4C1JNvOnupOrb749M6rRuJvcMYXfiy-ZE3eov0Kc7rUQc88Mal5Hlo2pOI_skiy4adB24yH1qrRCid2BBtmd235dRAl-QNfemtti5xXIzZaOpz6MYYC8X45FpiUlS_E1tGcsEMcenKbwWvxErHjb3AR2ON5KZqMP9ZcDdR-UPm5AGg7x4sS-84g33ZIEFw5cNzUee4i7ipTIFBJHwX04FKtemDKtB_RCbPqp9ec2KDMH1YsYaD_iK_nEt5cK4Y",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:18:16.587 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:18:16.695 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:18:16.727 +03:00 [DBG] mvc found in database: true
2018-07-31 13:18:16.729 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:18:16.732 +03:00 [DBG] No PKCE used.
2018-07-31 13:18:16.739 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:18:16.758 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:18:16.770 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:18:16.788 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:18:16.792 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:18:16.826 +03:00 [DBG] mvc found in database: true
2018-07-31 13:18:19.286 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:20:10.831 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:20:10.951 +03:00 [DBG] mvc found in database: true
2018-07-31 13:20:10.954 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:20:10.962 +03:00 [DBG] No PKCE used.
2018-07-31 13:20:10.984 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:20:11.097 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:20:11.105 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:20:11.130 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:20:11.135 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:20:11.168 +03:00 [DBG] mvc found in database: true
2018-07-31 13:20:14.815 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:29:48.799 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 13:29:48.903 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 13:29:48.926 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 13:29:48.948 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 13:29:48.962 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 13:29:49.315 +03:00 [DBG] Starting token cleanup
2018-07-31 13:29:55.619 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 13:29:55.665 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 13:29:55.668 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 13:29:55.673 +03:00 [DBG] Start discovery request
2018-07-31 13:29:58.865 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 13:29:59.187 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 13:29:59.191 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 13:29:59.193 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 13:29:59.199 +03:00 [DBG] Start key discovery request
2018-07-31 13:29:59.361 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 13:29:59.378 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 13:29:59.388 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 13:29:59.404 +03:00 [DBG] Start authorize request
2018-07-31 13:29:59.430 +03:00 [DBG] No user present in authorize request
2018-07-31 13:29:59.438 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:30:00.014 +03:00 [DBG] mvc found in database: true
2018-07-31 13:30:00.023 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:30:00.029 +03:00 [DBG] No PKCE used.
2018-07-31 13:30:00.108 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:00.237 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:00.267 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:00.289 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:00.305 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:30:00.334 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKdwZMHJgPrxCqqUDfP6QnEMSXA4UJ9zpj2cQMeRJqwxN5hX1faH6Yw-WRlfVd0Rn_xnyhsWt-xl3aHdYfPPFP4Lc_02hEnf2rVvisnZgCHpop_yGOmmbP54AnC-b2bYVBicdAf4yvzonie5Tc0KYJgvZasrtAZmYTLNnqX5my-AVLsZdw71nua9pwzbOQwcqgwl_b4oFbcECldLOQAss3FGE31oHHnCvtkQmPliF9V-DC3ilEb6U1R3oWDevdekpmuyaqBfidz3onwsr-US-iFSx1q52VoE2N65aVp7vMvU60-IuoY-j4uTwWTGAVf2pE",
  "Nonce": "636686297992873466.OGNmZWUxNzMtMGJmYy00NzBjLThiYjUtODkzODJmMzc2Y2VkNWU5NDkzMzAtOWMzYi00NjljLWJmOTAtYWUyMDEwYzZhNDg0",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686297992873466.OGNmZWUxNzMtMGJmYy00NzBjLThiYjUtODkzODJmMzc2Y2VkNWU5NDkzMzAtOWMzYi00NjljLWJmOTAtYWUyMDEwYzZhNDg0",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKdwZMHJgPrxCqqUDfP6QnEMSXA4UJ9zpj2cQMeRJqwxN5hX1faH6Yw-WRlfVd0Rn_xnyhsWt-xl3aHdYfPPFP4Lc_02hEnf2rVvisnZgCHpop_yGOmmbP54AnC-b2bYVBicdAf4yvzonie5Tc0KYJgvZasrtAZmYTLNnqX5my-AVLsZdw71nua9pwzbOQwcqgwl_b4oFbcECldLOQAss3FGE31oHHnCvtkQmPliF9V-DC3ilEb6U1R3oWDevdekpmuyaqBfidz3onwsr-US-iFSx1q52VoE2N65aVp7vMvU60-IuoY-j4uTwWTGAVf2pE",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 13:30:00.362 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 13:30:00.484 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:30:00.523 +03:00 [DBG] mvc found in database: true
2018-07-31 13:30:00.527 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:30:00.530 +03:00 [DBG] No PKCE used.
2018-07-31 13:30:00.542 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:00.562 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:00.572 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:00.594 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:00.598 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:30:00.636 +03:00 [DBG] mvc found in database: true
2018-07-31 13:30:08.683 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 13:30:08.752 +03:00 [DBG] mvc found in database: true
2018-07-31 13:30:08.755 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 13:30:08.757 +03:00 [DBG] No PKCE used.
2018-07-31 13:30:08.772 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:08.884 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:08.904 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 13:30:08.990 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 13:30:08.997 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 13:30:09.098 +03:00 [DBG] mvc found in database: true
2018-07-31 13:30:10.965 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 13:30:30.249 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 13:30:30.480 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 13:30:30.647 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: External authentication error
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 167
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:20:15.726 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 14:20:15.777 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 14:20:15.784 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 14:20:15.787 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 14:20:15.790 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 14:20:16.078 +03:00 [DBG] Starting token cleanup
2018-07-31 14:20:26.868 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:20:26.910 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:20:26.913 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:20:26.919 +03:00 [DBG] Start discovery request
2018-07-31 14:20:29.448 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:20:32.512 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:20:32.516 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:20:32.518 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:20:32.520 +03:00 [DBG] Start discovery request
2018-07-31 14:20:32.559 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:20:32.822 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 14:20:32.828 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 14:20:32.830 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 14:20:32.842 +03:00 [DBG] Start key discovery request
2018-07-31 14:20:32.945 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:20:32.956 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:20:32.959 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:20:32.968 +03:00 [DBG] Start authorize request
2018-07-31 14:20:32.991 +03:00 [DBG] No user present in authorize request
2018-07-31 14:20:32.999 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:20:33.504 +03:00 [DBG] mvc found in database: true
2018-07-31 14:20:33.515 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:20:33.520 +03:00 [DBG] No PKCE used.
2018-07-31 14:20:33.579 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:20:33.715 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:20:33.740 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:20:33.757 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:20:33.773 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:20:33.792 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLY8tcn8lSzcmEuQnHOMkr1NMB51vF4gG_F77aY9EwCHz6U5cMyV4LS_prVZPAucTpxLyTuxeHjOkK2CXgYTjNMdpW4AtxqzIY5QsWLN3sQn0RyoOdXgGt-ByOC0ima7tXcmV7teaxOLoB17_os40c0GJIVzrXhrXhib1B-eCoA6nOpV7PG1p40Vpst6VACAp05T_qeKn8gfVn7gftpJPSIYfVl-Cmk3AYjkcjTnC4PKXhriSCUE6TD-bCwtvx7QBFNdC-LsvimBrBhKhUTt56L7ppSW8yiHejRKyCfjTqOidOw0l4AjVPC56z9Nwk298s",
  "Nonce": "636686328329227138.YWYyYjBhM2EtMDc5YS00NjkwLWI5N2EtNWU4ZjhmZmI3NDUzMTNjNWVhZTQtZDhlYi00ZmM2LWI1MzctMDc3MTlmZjUzYjIx",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686328329227138.YWYyYjBhM2EtMDc5YS00NjkwLWI5N2EtNWU4ZjhmZmI3NDUzMTNjNWVhZTQtZDhlYi00ZmM2LWI1MzctMDc3MTlmZjUzYjIx",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLY8tcn8lSzcmEuQnHOMkr1NMB51vF4gG_F77aY9EwCHz6U5cMyV4LS_prVZPAucTpxLyTuxeHjOkK2CXgYTjNMdpW4AtxqzIY5QsWLN3sQn0RyoOdXgGt-ByOC0ima7tXcmV7teaxOLoB17_os40c0GJIVzrXhrXhib1B-eCoA6nOpV7PG1p40Vpst6VACAp05T_qeKn8gfVn7gftpJPSIYfVl-Cmk3AYjkcjTnC4PKXhriSCUE6TD-bCwtvx7QBFNdC-LsvimBrBhKhUTt56L7ppSW8yiHejRKyCfjTqOidOw0l4AjVPC56z9Nwk298s",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:20:33.812 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:20:47.008 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:20:47.041 +03:00 [DBG] mvc found in database: true
2018-07-31 14:20:47.043 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:20:47.046 +03:00 [DBG] No PKCE used.
2018-07-31 14:20:47.053 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:20:47.070 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:20:47.080 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:20:47.096 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:20:47.100 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:20:47.135 +03:00 [DBG] mvc found in database: true
2018-07-31 14:21:17.969 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:21:34.312 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:21:34.531 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:22:55.728 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: External authentication error
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 167
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:25:57.387 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:25:57.396 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:25:57.399 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:25:57.402 +03:00 [DBG] Start authorize request
2018-07-31 14:25:57.406 +03:00 [DBG] No user present in authorize request
2018-07-31 14:25:57.409 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:25:57.467 +03:00 [DBG] mvc found in database: true
2018-07-31 14:25:57.470 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:25:57.473 +03:00 [DBG] No PKCE used.
2018-07-31 14:25:57.484 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:25:57.557 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:25:57.567 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:25:57.583 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:25:57.586 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:25:57.590 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLP_DR6lHbpB3o3PcFtP3z8lEC0pIavtq4zeyEdd4Qvfsu91NTaaZXHUMJqz0s_IsUKdcj4hqwrESY-tEv3UNVSrV5UW6D8uclyIVlTaGiXmv5ZrnEGYTOnL-GJ0dsKnAO_tHkpLJzAixLF-Ea6XxEBo8KBEpv6fQ73NyDDlPNS2_67VDKIeDREe7jPNL9KPax8Tbas7p4UEACgk4a5ngdn16q1mpQZEZtYz80X7g0uv6nmy6PG3Tx_gECU0GgnjxBAzb-yhDnMYDjRZrctbYK2yVT9FUTjBy8LeryrUJqu773etwziJUUQmAj2IGugxzg",
  "Nonce": "636686331573691879.ZGNlNmY1YWYtYjc1Ni00NmNmLWE3MTEtODE4OWQwM2I5NGQ0MmMxZDZhNzctZDc1Yi00MzIyLWIzNzgtODM5MDE4NzI2YzE5",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686331573691879.ZGNlNmY1YWYtYjc1Ni00NmNmLWE3MTEtODE4OWQwM2I5NGQ0MmMxZDZhNzctZDc1Yi00MzIyLWIzNzgtODM5MDE4NzI2YzE5",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLP_DR6lHbpB3o3PcFtP3z8lEC0pIavtq4zeyEdd4Qvfsu91NTaaZXHUMJqz0s_IsUKdcj4hqwrESY-tEv3UNVSrV5UW6D8uclyIVlTaGiXmv5ZrnEGYTOnL-GJ0dsKnAO_tHkpLJzAixLF-Ea6XxEBo8KBEpv6fQ73NyDDlPNS2_67VDKIeDREe7jPNL9KPax8Tbas7p4UEACgk4a5ngdn16q1mpQZEZtYz80X7g0uv6nmy6PG3Tx_gECU0GgnjxBAzb-yhDnMYDjRZrctbYK2yVT9FUTjBy8LeryrUJqu773etwziJUUQmAj2IGugxzg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:25:57.598 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:26:04.100 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:26:04.449 +03:00 [DBG] mvc found in database: true
2018-07-31 14:26:04.453 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:26:04.456 +03:00 [DBG] No PKCE used.
2018-07-31 14:26:04.467 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:26:04.498 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:26:04.528 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:26:04.569 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:26:04.583 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:26:04.620 +03:00 [DBG] mvc found in database: true
2018-07-31 14:26:25.020 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:26:25.948 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:26:25.964 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:28:39.082 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.NullReferenceException: Object reference not set to an instance of an object.
   at IdentityServer.Quickstart.Account.AccountController.<FindUserFromExternalProviderAsync>d__18.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 440
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 167
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:34:18.685 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 14:34:18.849 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 14:34:18.862 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 14:34:18.868 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 14:34:18.878 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 14:34:19.269 +03:00 [DBG] Starting token cleanup
2018-07-31 14:34:29.971 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:34:30.015 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:34:30.018 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:34:30.026 +03:00 [DBG] Start discovery request
2018-07-31 14:34:32.715 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:34:33.040 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 14:34:33.046 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 14:34:33.048 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 14:34:33.053 +03:00 [DBG] Start key discovery request
2018-07-31 14:34:33.149 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:34:33.160 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:34:33.162 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:34:33.169 +03:00 [DBG] Start authorize request
2018-07-31 14:34:33.188 +03:00 [DBG] No user present in authorize request
2018-07-31 14:34:33.195 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:34:33.711 +03:00 [DBG] mvc found in database: true
2018-07-31 14:34:33.720 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:34:33.723 +03:00 [DBG] No PKCE used.
2018-07-31 14:34:33.791 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:34:33.912 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:34:33.935 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:34:33.950 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:34:33.963 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:34:33.981 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJaDOXIDBZDBuAoBMia5u3mRXuWZpsPY4SfVSPwJfq-keqh-rqwpGjwRKWb28zMYTybAFCt1mVHPlBVSMjGRrWEN2uAr3wqwiGl9xz22u4a16K2rZvcX28HtQC7gFW2mbfmYskkAY1WcEouDErGJRbe4mFWeN9m4djsj0yZLdlWKQCDJendfkYlZweIa2yuZiut_hNgIBeDJSrncEMnR0X1AzNpIyipINWEPATe5kWimtOBOETLIXulx6fGUrT8X7PYaLHQNNY-5j47V62wURFrnSLxyIAJJUWyiCuvTp0LRSnkkvukPkEbwoqpaViT0X0",
  "Nonce": "636686336731275703.NTk5NTI3ZGMtYTM3Ny00MmFlLWJjYzYtMzliNjExNTNjYWVlYjE3OGFmMTUtNDZmYy00MDRkLWJlMmEtOGQyNWRkNjI0NTlh",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686336731275703.NTk5NTI3ZGMtYTM3Ny00MmFlLWJjYzYtMzliNjExNTNjYWVlYjE3OGFmMTUtNDZmYy00MDRkLWJlMmEtOGQyNWRkNjI0NTlh",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJaDOXIDBZDBuAoBMia5u3mRXuWZpsPY4SfVSPwJfq-keqh-rqwpGjwRKWb28zMYTybAFCt1mVHPlBVSMjGRrWEN2uAr3wqwiGl9xz22u4a16K2rZvcX28HtQC7gFW2mbfmYskkAY1WcEouDErGJRbe4mFWeN9m4djsj0yZLdlWKQCDJendfkYlZweIa2yuZiut_hNgIBeDJSrncEMnR0X1AzNpIyipINWEPATe5kWimtOBOETLIXulx6fGUrT8X7PYaLHQNNY-5j47V62wURFrnSLxyIAJJUWyiCuvTp0LRSnkkvukPkEbwoqpaViT0X0",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:34:34.000 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:34:38.442 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:34:38.476 +03:00 [DBG] mvc found in database: true
2018-07-31 14:34:38.482 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:34:38.484 +03:00 [DBG] No PKCE used.
2018-07-31 14:34:38.491 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:34:38.505 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:34:38.515 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:34:38.530 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:34:38.534 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:34:38.570 +03:00 [DBG] mvc found in database: true
2018-07-31 14:34:45.106 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:35:00.315 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:35:00.566 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:36:41.167 +03:00 [WRN] User ef9a0659-6b56-4ca5-91cb-24a463c9a3f7 validation failed: InvalidEmail.
2018-07-31 14:36:48.773 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: Email '' is invalid.
   at IdentityServer.Quickstart.Account.AccountController.<AutoProvisionUserAsync>d__19.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 506
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 174
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:37:07.014 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:37:07.025 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:37:07.039 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:37:07.044 +03:00 [DBG] Start authorize request
2018-07-31 14:37:07.051 +03:00 [DBG] No user present in authorize request
2018-07-31 14:37:07.062 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:37:07.158 +03:00 [DBG] mvc found in database: true
2018-07-31 14:37:07.167 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:37:07.172 +03:00 [DBG] No PKCE used.
2018-07-31 14:37:07.189 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:07.274 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:07.284 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:07.305 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:07.312 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:37:07.321 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJW9mImW_gZ0yex2chQMF63dAK1S2SZJm_jSu5-Yzezs2nOTr9BmKCAcgGPLnfydwfPxSp4vbApRp9hXZq4MJx5i3txcpEPYYIX1kd2QRZEJ7ml3HRYSLya3YydGuNPcpXsXlYPAeusZXFUMblb9_KBa5n5BqAQszhl4JlraRLFlvIXg-RdltYd4nMLux2i0cWVNIsstVkmLa_vgvQD_ptj16bWcMOWSDa4MskawL27fAOuldy2HSxHcnsxA0Zu-m1P-3CwOCf9Ql5u2D0ZrOsUsC6aeLJHICx9AEWavlvDPCu_B-YxXKP3AZwn9WzMX6I",
  "Nonce": "636686338269724655.ZWFkN2EwNjgtMjMzNy00OWRhLTliNjgtNGUxNDk5ZmQ0ZjkzNzBlYTVkOWItNDI0ZS00ZTY2LWEyYmItYTliNmQyNDc4ZTFk",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686338269724655.ZWFkN2EwNjgtMjMzNy00OWRhLTliNjgtNGUxNDk5ZmQ0ZjkzNzBlYTVkOWItNDI0ZS00ZTY2LWEyYmItYTliNmQyNDc4ZTFk",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJW9mImW_gZ0yex2chQMF63dAK1S2SZJm_jSu5-Yzezs2nOTr9BmKCAcgGPLnfydwfPxSp4vbApRp9hXZq4MJx5i3txcpEPYYIX1kd2QRZEJ7ml3HRYSLya3YydGuNPcpXsXlYPAeusZXFUMblb9_KBa5n5BqAQszhl4JlraRLFlvIXg-RdltYd4nMLux2i0cWVNIsstVkmLa_vgvQD_ptj16bWcMOWSDa4MskawL27fAOuldy2HSxHcnsxA0Zu-m1P-3CwOCf9Ql5u2D0ZrOsUsC6aeLJHICx9AEWavlvDPCu_B-YxXKP3AZwn9WzMX6I",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:37:07.331 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:37:07.347 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:37:07.380 +03:00 [DBG] mvc found in database: true
2018-07-31 14:37:07.383 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:37:07.385 +03:00 [DBG] No PKCE used.
2018-07-31 14:37:07.396 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:07.415 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:07.425 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:07.446 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:07.451 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:37:07.482 +03:00 [DBG] mvc found in database: true
2018-07-31 14:37:08.175 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:37:08.214 +03:00 [DBG] mvc found in database: true
2018-07-31 14:37:08.216 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:37:08.219 +03:00 [DBG] No PKCE used.
2018-07-31 14:37:08.229 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:08.245 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:08.255 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:37:08.274 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:37:08.280 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:37:08.312 +03:00 [DBG] mvc found in database: true
2018-07-31 14:37:09.886 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:37:10.764 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:37:10.806 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:39:00.713 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 14:39:00.776 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 14:39:00.780 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 14:39:00.792 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 14:39:00.801 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 14:39:01.236 +03:00 [DBG] Starting token cleanup
2018-07-31 14:39:45.841 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:39:45.890 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:39:45.892 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:39:45.898 +03:00 [DBG] Start discovery request
2018-07-31 14:39:48.479 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:39:48.806 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 14:39:48.809 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 14:39:48.811 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 14:39:48.818 +03:00 [DBG] Start key discovery request
2018-07-31 14:39:48.944 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:39:48.958 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:39:48.960 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:39:48.973 +03:00 [DBG] Start authorize request
2018-07-31 14:39:48.998 +03:00 [DBG] No user present in authorize request
2018-07-31 14:39:49.012 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:39:49.536 +03:00 [DBG] mvc found in database: true
2018-07-31 14:39:49.547 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:39:49.552 +03:00 [DBG] No PKCE used.
2018-07-31 14:39:49.615 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:39:49.748 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:39:49.777 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:39:49.794 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:39:49.808 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:39:49.827 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLUTtvJMT-cZUhHPdLlW1Ja7V4ZtFrzZkaUJEiuJz0ZiOQ1ZdWy7v3s5nmo5JPy7ZOaDjYa7-XNM3zpcUF91d4DCWmdp738ZuZ2tLHbcKOAz97a_Qy3QxQjt6YJG6Csjz0_HAY_Tt2bD8BEPmyqJ88LAM-RVedNWbI3Cr298HWHhMafSyBqhcMw7eWVB5mhzdErmuXDlGiTpOAHClvUn9wi6OmsnDr5dUYE9tHVkY1eaVsnCCy4awmMYMhpql6IXu1FqDrWqNninzJzQeV_QvTrr7d3iBpdDKdT8cuDqoU79LIQXiD_3xN1N888WrI2ERA",
  "Nonce": "636686339888971385.ODdjMmYwNjctYjhhZi00ZWUxLWJlNDUtZDkxMWExODYwMzZhZGQyYTZjZGEtYTYwNC00YzJlLWI0ZDUtMTVjYmEzYmUzOWZh",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686339888971385.ODdjMmYwNjctYjhhZi00ZWUxLWJlNDUtZDkxMWExODYwMzZhZGQyYTZjZGEtYTYwNC00YzJlLWI0ZDUtMTVjYmEzYmUzOWZh",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLUTtvJMT-cZUhHPdLlW1Ja7V4ZtFrzZkaUJEiuJz0ZiOQ1ZdWy7v3s5nmo5JPy7ZOaDjYa7-XNM3zpcUF91d4DCWmdp738ZuZ2tLHbcKOAz97a_Qy3QxQjt6YJG6Csjz0_HAY_Tt2bD8BEPmyqJ88LAM-RVedNWbI3Cr298HWHhMafSyBqhcMw7eWVB5mhzdErmuXDlGiTpOAHClvUn9wi6OmsnDr5dUYE9tHVkY1eaVsnCCy4awmMYMhpql6IXu1FqDrWqNninzJzQeV_QvTrr7d3iBpdDKdT8cuDqoU79LIQXiD_3xN1N888WrI2ERA",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:39:49.846 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:39:49.966 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:39:50.005 +03:00 [DBG] mvc found in database: true
2018-07-31 14:39:50.009 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:39:50.011 +03:00 [DBG] No PKCE used.
2018-07-31 14:39:50.020 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:39:50.036 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:39:50.045 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:39:50.061 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:39:50.064 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:39:50.095 +03:00 [DBG] mvc found in database: true
2018-07-31 14:39:53.859 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:39:55.029 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:39:55.257 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:40:07.598 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.InvalidOperationException: Unable to track an entity of type 'PreviousPassword' because primary key property 'PasswordHash' is null.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintAction(EntityEntryGraphNode node, Boolean force)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraph[TState](EntityEntryGraphNode node, TState state, Func`3 handleNode)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NavigationFixer.NavigationCollectionChanged(InternalEntityEntry entry, INavigation navigation, IEnumerable`1 added, IEnumerable`1 removed)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.NavigationCollectionChanged(InternalEntityEntry entry, INavigation navigation, IEnumerable`1 added, IEnumerable`1 removed)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectNavigationChange(InternalEntityEntry entry, INavigation navigation)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.DetectChanges(IStateManager stateManager)
   at Microsoft.EntityFrameworkCore.DbContext.<SaveChangesAsync>d__52.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.<UpdateAsync>d__23.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at UserManagement.IdentityManagement.Identity.ApplicationUserStore.<AddToPreviousPasswordsAsync>d__5.MoveNext() in D:\AuthPoc\UserManagement.IdentityManagement\Identity\ApplicationUserStore.cs:line 66
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at UserManagement.IdentityManagement.Identity.ApplicationUserStore.<CreateAsync>d__2.MoveNext() in D:\AuthPoc\UserManagement.IdentityManagement\Identity\ApplicationUserStore.cs:line 22
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Identity.UserManager`1.<CreateAsync>d__74.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at IdentityServer.Quickstart.Account.AccountController.<AutoProvisionUserAsync>d__19.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 504
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 174
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:41:56.234 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 14:41:56.311 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 14:41:56.341 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 14:41:56.379 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 14:41:56.479 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 14:41:56.941 +03:00 [DBG] Starting token cleanup
2018-07-31 14:42:32.875 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:42:32.914 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:42:32.917 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:42:32.922 +03:00 [DBG] Start discovery request
2018-07-31 14:42:35.478 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:42:35.818 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 14:42:35.821 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 14:42:35.823 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 14:42:35.829 +03:00 [DBG] Start key discovery request
2018-07-31 14:42:35.926 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:42:35.938 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:42:35.941 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:42:35.951 +03:00 [DBG] Start authorize request
2018-07-31 14:42:35.975 +03:00 [DBG] No user present in authorize request
2018-07-31 14:42:35.983 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:42:36.515 +03:00 [DBG] mvc found in database: true
2018-07-31 14:42:36.526 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:42:36.532 +03:00 [DBG] No PKCE used.
2018-07-31 14:42:36.592 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:36.718 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:36.745 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:36.761 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:36.775 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:42:36.778 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:42:36.783 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:42:36.786 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:42:36.790 +03:00 [DBG] Start authorize request
2018-07-31 14:42:36.792 +03:00 [DBG] No user present in authorize request
2018-07-31 14:42:36.797 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:42:36.830 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKSlPlk_euocJNc8rEamCzg_ER5q1RZacLqhpV5CdSuFm8UMxZoY4o-amiS1aM9Ol2fzWTprtX495VyEr-r_Oy0x02RkQjqjiJ6B8st2KfMnN_HG2VRP_L4QuZeuqxzPHyGLsub3jlgCBGLNlD4pUEt6JqPxY8TKPQ5UdZ_VM_s0n24b1x3YN_NT_T4Z18NpYoo7hZLHNx6dLUmNm7DgSARi0q6fdx9_j1IayDtNr6PF_gopGDFfPFB0r94nmz7uLJM1f90Lyk8hVq_NpoShEhgFNqFTjGFwN1PxPNdV2Z7xD0gGAyIDaR4AQLUBm_8vy4",
  "Nonce": "636686341559060716.M2ZmNzRkYTgtMWI2ZC00N2U1LTlkY2MtMDVhZTRlYjViOGNmNWU1OGJiNWUtNjJjOS00ZTJlLWE5NTUtYTJhYzA1ZGYyMjc4",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686341559060716.M2ZmNzRkYTgtMWI2ZC00N2U1LTlkY2MtMDVhZTRlYjViOGNmNWU1OGJiNWUtNjJjOS00ZTJlLWE5NTUtYTJhYzA1ZGYyMjc4",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKSlPlk_euocJNc8rEamCzg_ER5q1RZacLqhpV5CdSuFm8UMxZoY4o-amiS1aM9Ol2fzWTprtX495VyEr-r_Oy0x02RkQjqjiJ6B8st2KfMnN_HG2VRP_L4QuZeuqxzPHyGLsub3jlgCBGLNlD4pUEt6JqPxY8TKPQ5UdZ_VM_s0n24b1x3YN_NT_T4Z18NpYoo7hZLHNx6dLUmNm7DgSARi0q6fdx9_j1IayDtNr6PF_gopGDFfPFB0r94nmz7uLJM1f90Lyk8hVq_NpoShEhgFNqFTjGFwN1PxPNdV2Z7xD0gGAyIDaR4AQLUBm_8vy4",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:42:36.849 +03:00 [DBG] mvc found in database: true
2018-07-31 14:42:36.852 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:42:36.855 +03:00 [DBG] No PKCE used.
2018-07-31 14:42:36.863 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:36.863 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:42:36.891 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:36.904 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:36.919 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:36.923 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:42:36.925 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKSlPlk_euocJNc8rEamCzg_ER5q1RZacLqhpV5CdSuFm8UMxZoY4o-amiS1aM9Ol2fzWTprtX495VyEr-r_Oy0x02RkQjqjiJ6B8st2KfMnN_HG2VRP_L4QuZeuqxzPHyGLsub3jlgCBGLNlD4pUEt6JqPxY8TKPQ5UdZ_VM_s0n24b1x3YN_NT_T4Z18NpYoo7hZLHNx6dLUmNm7DgSARi0q6fdx9_j1IayDtNr6PF_gopGDFfPFB0r94nmz7uLJM1f90Lyk8hVq_NpoShEhgFNqFTjGFwN1PxPNdV2Z7xD0gGAyIDaR4AQLUBm_8vy4",
  "Nonce": "636686341559060716.M2ZmNzRkYTgtMWI2ZC00N2U1LTlkY2MtMDVhZTRlYjViOGNmNWU1OGJiNWUtNjJjOS00ZTJlLWE5NTUtYTJhYzA1ZGYyMjc4",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686341559060716.M2ZmNzRkYTgtMWI2ZC00N2U1LTlkY2MtMDVhZTRlYjViOGNmNWU1OGJiNWUtNjJjOS00ZTJlLWE5NTUtYTJhYzA1ZGYyMjc4",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKSlPlk_euocJNc8rEamCzg_ER5q1RZacLqhpV5CdSuFm8UMxZoY4o-amiS1aM9Ol2fzWTprtX495VyEr-r_Oy0x02RkQjqjiJ6B8st2KfMnN_HG2VRP_L4QuZeuqxzPHyGLsub3jlgCBGLNlD4pUEt6JqPxY8TKPQ5UdZ_VM_s0n24b1x3YN_NT_T4Z18NpYoo7hZLHNx6dLUmNm7DgSARi0q6fdx9_j1IayDtNr6PF_gopGDFfPFB0r94nmz7uLJM1f90Lyk8hVq_NpoShEhgFNqFTjGFwN1PxPNdV2Z7xD0gGAyIDaR4AQLUBm_8vy4",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:42:36.937 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:42:37.026 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:42:37.058 +03:00 [DBG] mvc found in database: true
2018-07-31 14:42:37.060 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:42:37.063 +03:00 [DBG] No PKCE used.
2018-07-31 14:42:37.072 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:37.089 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:37.097 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:42:37.111 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:42:37.116 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:42:37.144 +03:00 [DBG] mvc found in database: true
2018-07-31 14:42:39.485 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:42:40.308 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:42:40.523 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:42:54.392 +03:00 [WRN] User db291d4e-b013-4d74-9b0a-3c96a0736fdc validation failed: DuplicateEmail.
2018-07-31 14:42:54.501 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: Email 'krasnov93@live.com' is already taken.
   at IdentityServer.Quickstart.Account.AccountController.<AutoProvisionUserAsync>d__19.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 507
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 174
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 14:43:54.184 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 14:43:54.260 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 14:43:54.264 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 14:43:54.267 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 14:43:54.276 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 14:43:54.649 +03:00 [DBG] Starting token cleanup
2018-07-31 14:44:02.067 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 14:44:02.105 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 14:44:02.108 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 14:44:02.113 +03:00 [DBG] Start discovery request
2018-07-31 14:44:04.701 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 14:44:05.011 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 14:44:05.014 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 14:44:05.016 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 14:44:05.023 +03:00 [DBG] Start key discovery request
2018-07-31 14:44:05.126 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 14:44:05.135 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 14:44:05.139 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 14:44:05.148 +03:00 [DBG] Start authorize request
2018-07-31 14:44:05.169 +03:00 [DBG] No user present in authorize request
2018-07-31 14:44:05.178 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:44:05.685 +03:00 [DBG] mvc found in database: true
2018-07-31 14:44:05.696 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:44:05.701 +03:00 [DBG] No PKCE used.
2018-07-31 14:44:05.763 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:44:05.897 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:44:05.929 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:44:05.945 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:44:05.959 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:44:05.979 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
  "Nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:44:05.998 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 14:44:06.087 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:44:06.121 +03:00 [DBG] mvc found in database: true
2018-07-31 14:44:06.123 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:44:06.129 +03:00 [DBG] No PKCE used.
2018-07-31 14:44:06.139 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:44:06.156 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:44:06.166 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:44:06.181 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:44:06.184 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:44:06.213 +03:00 [DBG] mvc found in database: true
2018-07-31 14:44:46.265 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 14:44:47.143 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:44:47.336 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 14:46:36.123 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "oidc",
  "ProviderUserId": "wY81KoaEF5dT-0W2F69Y50ceEp4ckY8tQgXG8Mu4MKU",
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "DisplayName": "Andrei Krasnou",
  "Endpoint": "UI",
  "ActivityId": "0HLFMRBIFG7JS:00000005",
  "TimeStamp": "2018-07-31T11:46:36Z",
  "ProcessId": 42076,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 14:46:37.404 +03:00 [DBG] Augmenting SignInContext
2018-07-31 14:46:37.411 +03:00 [DBG] Adding amr claim with value: external
2018-07-31 14:46:37.420 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 14:46:56.168 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-07-31 14:47:02.469 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 14:47:02.476 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 14:47:02.481 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 14:47:02.491 +03:00 [DBG] Start authorize callback request
2018-07-31 14:47:02.499 +03:00 [DBG] User in authorize request: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 14:47:02.504 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:47:02.561 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:02.564 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:47:02.567 +03:00 [DBG] No PKCE used.
2018-07-31 14:47:02.581 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:02.667 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:02.676 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:02.698 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:02.702 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:47:02.705 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
  "Nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
  "SessionId": "1e2e93f376bad3da07960b0d96346107",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:47:02.767 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 14:47:02.770 +03:00 [INF] Showing consent: User has not yet consented
2018-07-31 14:47:02.803 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:47:02.830 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:02.832 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:47:02.834 +03:00 [DBG] No PKCE used.
2018-07-31 14:47:02.843 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:02.861 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:02.870 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:02.885 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:02.889 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:47:02.915 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:02.926 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:02.999 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:05.154 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 14:47:05.210 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:47:05.245 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:05.248 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:47:05.250 +03:00 [DBG] No PKCE used.
2018-07-31 14:47:05.258 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:05.273 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:05.281 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:05.296 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:05.300 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:47:05.328 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 14:47:05.332 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 14:47:05.335 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 14:47:05.338 +03:00 [DBG] Start authorize callback request
2018-07-31 14:47:05.360 +03:00 [DBG] User in authorize request: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 14:47:05.365 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 14:47:05.396 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:05.401 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 14:47:05.404 +03:00 [DBG] No PKCE used.
2018-07-31 14:47:05.414 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:05.434 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:05.443 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:05.457 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:05.461 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 14:47:05.463 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
  "Nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
  "SessionId": "1e2e93f376bad3da07960b0d96346107",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 14:47:05.482 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 14:47:05.492 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-31 14:47:05.497 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-31 14:47:05.503 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 14:47:05.549 +03:00 [DBG] HGBcpkTniknEaktwmgO7YJ0YgUihnP2tsjPPrfB9pnc= not found in database
2018-07-31 14:47:05.602 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-31 14:47:05.638 +03:00 [DBG] b6ZtXIZB+VKLv2lAjRA3nctgufwTih2Yqrvc/rEfnnY= not found in database
2018-07-31 14:47:05.653 +03:00 [DBG] Creating Implicit Flow response.
2018-07-31 14:47:05.667 +03:00 [DBG] Getting claims for identity token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273 and client: mvc
2018-07-31 14:47:05.673 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 14:47:05.727 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****mtaA"
    },
    {
      "TokenType": "code",
      "TokenValue": "****e862"
    }
  ],
  "ActivityId": "0HLFMRBIFG7JS:0000000A",
  "TimeStamp": "2018-07-31T11:47:05Z",
  "ProcessId": 42076,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 14:47:05.740 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzI-wJF1bw0L9ntM1U456K8OUnxS5Lx1QEj_lZ6Cx2Z83TIHAradDLIuXdJS3EpKMu0ntZXeqNUw_vZXw_I93oDF9lRlz_4qZggU4m1yAz-9Vfa-pzhAPevnYv63VlJXnKZs0hrfFgqnCYiAA0sO3sYQyTIAxxJNlduA_LdzZ81Yph-w85nUH5CNaNajBfLbec6_LV-MNRBE0JdmfvXgLQWnLRDVq6BJvCuQp18nRrbGlEZ1kjMByhy9gVPGgGBhPqG97N7DeJe_cdmg5bUNKxHfXaG6uLVjpSmWiX_VtDwUgy5wriE4hZq_f6DGQCTEI2w",
  "Scope": "openid profile api1 offline_access"
}
2018-07-31 14:47:05.765 +03:00 [DBG] Augmenting SignInContext
2018-07-31 14:47:05.768 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 14:47:05.931 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-31 14:47:05.941 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-31 14:47:05.945 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-31 14:47:05.957 +03:00 [DBG] Start token request.
2018-07-31 14:47:05.967 +03:00 [DBG] Start client validation
2018-07-31 14:47:05.976 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-31 14:47:05.983 +03:00 [DBG] Start parsing for secret in post body
2018-07-31 14:47:05.985 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-31 14:47:05.987 +03:00 [DBG] Secret id found: mvc
2018-07-31 14:47:06.018 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:06.034 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-31 14:47:06.036 +03:00 [DBG] Client validation success
2018-07-31 14:47:06.045 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFMRBIFG7JT:00000001",
  "TimeStamp": "2018-07-31T11:47:06Z",
  "ProcessId": 42076,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 14:47:06.055 +03:00 [DBG] Start token request validation
2018-07-31 14:47:06.072 +03:00 [DBG] Start validation of authorization code token request
2018-07-31 14:47:06.101 +03:00 [DBG] b6ZtXIZB+VKLv2lAjRA3nctgufwTih2Yqrvc/rEfnnY= found in database: true
2018-07-31 14:47:06.136 +03:00 [DBG] removing b6ZtXIZB+VKLv2lAjRA3nctgufwTih2Yqrvc/rEfnnY= persisted grant from database
2018-07-31 14:47:06.165 +03:00 [DBG] Validation of authorization code token request success
2018-07-31 14:47:06.176 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "89e3f07b8f2d68eb4f6efffc5fe1f4e6611c3d0fd68ffb48fdc266d79386e862",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "89e3f07b8f2d68eb4f6efffc5fe1f4e6611c3d0fd68ffb48fdc266d79386e862",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-31 14:47:06.215 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:06.222 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:06.238 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:06.253 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-31 14:47:06.256 +03:00 [DBG] Getting claims for access token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 14:47:06.294 +03:00 [DBG] Creating refresh token
2018-07-31 14:47:06.297 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-31 14:47:06.322 +03:00 [DBG] WpgXVQEY9XaBGcmAq6N84Y5jATmpbW3aXXz9sGnRjMI= not found in database
2018-07-31 14:47:06.352 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:06.359 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:06.375 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 14:47:06.379 +03:00 [DBG] Getting claims for identity token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273 and client: mvc
2018-07-31 14:47:06.382 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 14:47:06.388 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****0J8A"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****bbbc"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****9IlA"
    }
  ],
  "ActivityId": "0HLFMRBIFG7JT:00000001",
  "TimeStamp": "2018-07-31T11:47:06Z",
  "ProcessId": 42076,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 14:47:06.394 +03:00 [DBG] Token request success.
2018-07-31 14:47:06.414 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-31 14:47:06.420 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-31 14:47:06.423 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-31 14:47:06.433 +03:00 [DBG] Start userinfo request
2018-07-31 14:47:06.440 +03:00 [DBG] Bearer token found in header
2018-07-31 14:47:06.488 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:06.517 +03:00 [DBG] mvc found in database: true
2018-07-31 14:47:06.530 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-31 14:47:06.538 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533037626,
    "exp": 1533041226,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "88ba8019-3f4d-48cc-a388-82ee2f840273",
    "auth_time": 1533037597,
    "idp": "oidc",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "external"
  }
}
2018-07-31 14:47:06.556 +03:00 [DBG] Creating userinfo response
2018-07-31 14:47:06.564 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 14:47:06.572 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 14:47:06.583 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:06.587 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-31 14:47:06.590 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 14:47:06.598 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 14:47:06.616 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-07-31 14:47:06.620 +03:00 [DBG] End userinfo request
2018-07-31 15:03:56.836 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 15:03:56.892 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 15:03:56.895 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 15:03:56.899 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 15:03:56.902 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 15:03:57.394 +03:00 [DBG] Starting token cleanup
2018-07-31 15:06:31.673 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 15:06:31.757 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 15:06:31.761 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 15:06:31.764 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 15:06:31.778 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 15:06:32.104 +03:00 [DBG] Starting token cleanup
2018-07-31 15:06:54.213 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 15:06:54.249 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 15:06:54.252 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 15:06:54.258 +03:00 [DBG] Start discovery request
2018-07-31 15:06:57.023 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 15:06:57.340 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 15:06:57.345 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 15:06:57.348 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 15:06:57.354 +03:00 [DBG] Start key discovery request
2018-07-31 15:06:57.497 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-07-31 15:06:57.504 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-07-31 15:06:57.509 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-07-31 15:06:57.532 +03:00 [DBG] Processing signout request for 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 15:06:57.544 +03:00 [DBG] Start end session request validation
2018-07-31 15:06:57.554 +03:00 [DBG] Start identity token validation
2018-07-31 15:06:58.152 +03:00 [DBG] mvc found in database: true
2018-07-31 15:06:58.157 +03:00 [DBG] Client found: mvc / MVC Client
2018-07-31 15:06:58.615 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-31 15:06:58.628 +03:00 [DBG] Token validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1533037626,
    "exp": 1533037926,
    "iss": "http://localhost:5000",
    "aud": "mvc",
    "nonce": "636686342451041647.ZDJjM2Y2OTYtZTEyNC00MWQ4LWEwMDEtYWVhODc1MDY1NDc3YTExYzZlNDAtMWY2Yi00Y2I2LWE3ZGUtM2MxMDk1MGI4ZGYz",
    "iat": 1533037626,
    "at_hash": "-RGQg2suDkKju9NU54VAnQ",
    "sid": "1e2e93f376bad3da07960b0d96346107",
    "sub": "88ba8019-3f4d-48cc-a388-82ee2f840273",
    "auth_time": 1533037597,
    "idp": "oidc",
    "amr": "external"
  }
}
2018-07-31 15:06:58.650 +03:00 [INF] End session request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "PostLogOutUri": "http://localhost:5002/signout-callback-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKaY02M7rbntdn3Ox3M_GhiWmcuNsYb3CkR5Jqbd5n2mwks_AHNBa1F7du6gKdnsM4W5cavLuT5irRbUghuruMVaLh8D7fe9t5TsOc1fIx0RboeInU5LHBMGCVx6D4ixCSVQsW_XBpo5V0GdL3OphpJ",
  "Raw": {
    "post_logout_redirect_uri": "http://localhost:5002/signout-callback-oidc",
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImY2NzZhNjNmM2QxZmRmYTNmMzgyZGNmZDNkYjNkZjc3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MzMwMzc2MjYsImV4cCI6MTUzMzAzNzkyNiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoibXZjIiwibm9uY2UiOiI2MzY2ODYzNDI0NTEwNDE2NDcuWkRKak0yWTJPVFl0WlRFeU5DMDBNV1E0TFdFd01ERXRZV1ZoT0RjMU1EWTFORGMzWVRFeFl6WmxOREF0TVdZMllpMDBZMkkyTFdFM1pHVXRNMk14TURrMU1HSTRaR1l6IiwiaWF0IjoxNTMzMDM3NjI2LCJhdF9oYXNoIjoiLVJHUWcyc3VEa0tqdTlOVTU0VkFuUSIsInNpZCI6IjFlMmU5M2YzNzZiYWQzZGEwNzk2MGIwZDk2MzQ2MTA3Iiwic3ViIjoiODhiYTgwMTktM2Y0ZC00OGNjLWEzODgtODJlZTJmODQwMjczIiwiYXV0aF90aW1lIjoxNTMzMDM3NTk3LCJpZHAiOiJvaWRjIiwiYW1yIjpbImV4dGVybmFsIl19.j-0R7_xBCPa4rKMKWk-k3kcDqDuw91ujXgapB8O2CE9WMWqLCb8qGUa7CIoJRKGUzMOuZAQOfQX4c5J8gFOfLhD6oCoaYqdgSUR0IfpEzMW2DeK_vIK7nqRyGl6-q0ZPxxkgnM0vSEzPygfr5l2XgYZT8D8IAb8rNMAu1JSR_eBFPxanevDOdhtIpCC00oJus3tgwHHwcI53B_u7IoxyBhuyK-ofz967cp-Iye0xU5Hl5spGqHX3hj9RVHtz8YJVSb8-macrbaGFAHVI_gqrSFHlr2tEo7q5Q7ehncGjgX5hr8qTJeQwXVNyeRh3GGqwxjlD1v82H9Ow8d4_Bu0J8A",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKaY02M7rbntdn3Ox3M_GhiWmcuNsYb3CkR5Jqbd5n2mwks_AHNBa1F7du6gKdnsM4W5cavLuT5irRbUghuruMVaLh8D7fe9t5TsOc1fIx0RboeInU5LHBMGCVx6D4ixCSVQsW_XBpo5V0GdL3OphpJ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 15:06:58.660 +03:00 [DBG] Success validating end session request from mvc
2018-07-31 15:06:58.871 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-07-31 15:06:58.878 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-07-31 15:06:58.881 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-07-31 15:06:58.936 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "DisplayName": "Andrei Krasnou",
  "ActivityId": "0HLFMRO70LRNA:00000002",
  "TimeStamp": "2018-07-31T12:06:58Z",
  "ProcessId": 32000,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 15:06:59.498 +03:00 [INF] AuthenticationScheme: oidc signed out.
2018-07-31 15:07:06.239 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-07-31 15:07:06.251 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-07-31 15:07:06.274 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-07-31 15:07:06.298 +03:00 [DBG] Processing signout callback request
2018-07-31 15:07:06.377 +03:00 [DBG] mvc found in database: true
2018-07-31 15:07:06.380 +03:00 [DBG] No client front-channel logout URLs
2018-07-31 15:07:06.383 +03:00 [DBG] No client back-channel logout URLs
2018-07-31 15:07:06.386 +03:00 [INF] Successful signout callback.
2018-07-31 15:07:06.390 +03:00 [DBG] No client front-channel iframe urls
2018-07-31 15:07:06.399 +03:00 [DBG] No client back-channel iframe urls
2018-07-31 15:07:22.558 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 15:07:22.568 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 15:07:22.572 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 15:07:22.579 +03:00 [DBG] Start authorize request
2018-07-31 15:07:22.588 +03:00 [DBG] No user present in authorize request
2018-07-31 15:07:22.596 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 15:07:22.631 +03:00 [DBG] mvc found in database: true
2018-07-31 15:07:22.639 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 15:07:22.643 +03:00 [DBG] No PKCE used.
2018-07-31 15:07:22.709 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:07:22.870 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:07:22.900 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:07:22.924 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:07:22.947 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 15:07:22.989 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJ1KkA7mE0GU43OICr052f1nm38MWOVyk5yjkNiNXgMPein0n-9iorYxLu1l4updhfIvuc8whd7qPMQuNWu3-gk4rSPwAAzhOn2Vo_cTn8nm52j2cGASta0_3LXlXoalG8nWnl4dsKcUjYPDaHKfT0GEUTlpgaJDlceqAZ-iIQx9Jm-xZU7AokQWZuqDsBqFU1o0MezFMujWYkw8RewIB8GqGn7PESfNv-KesO1A44XQwtuGiLsNWc_9IEoW_5dkRUIpukz5ubvh_UhvS7BX9FFkq0kkf0OKQrfOGnNHHBrb0GLtG5TVE4B5E8Th8hWuxw",
  "Nonce": "636686356425403435.N2YwNTQ0ZmEtMWEyZC00MmJkLTk3YzktYmIxOTA5ODA4N2QxYTBlYjMzMWYtNDhkMy00ZDBlLWJlMjgtN2FjZWIxZDBhOGY5",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686356425403435.N2YwNTQ0ZmEtMWEyZC00MmJkLTk3YzktYmIxOTA5ODA4N2QxYTBlYjMzMWYtNDhkMy00ZDBlLWJlMjgtN2FjZWIxZDBhOGY5",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJ1KkA7mE0GU43OICr052f1nm38MWOVyk5yjkNiNXgMPein0n-9iorYxLu1l4updhfIvuc8whd7qPMQuNWu3-gk4rSPwAAzhOn2Vo_cTn8nm52j2cGASta0_3LXlXoalG8nWnl4dsKcUjYPDaHKfT0GEUTlpgaJDlceqAZ-iIQx9Jm-xZU7AokQWZuqDsBqFU1o0MezFMujWYkw8RewIB8GqGn7PESfNv-KesO1A44XQwtuGiLsNWc_9IEoW_5dkRUIpukz5ubvh_UhvS7BX9FFkq0kkf0OKQrfOGnNHHBrb0GLtG5TVE4B5E8Th8hWuxw",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 15:07:23.022 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 15:07:23.070 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 15:07:23.108 +03:00 [DBG] mvc found in database: true
2018-07-31 15:07:23.110 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 15:07:23.113 +03:00 [DBG] No PKCE used.
2018-07-31 15:07:23.121 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:07:23.137 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:07:23.145 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:07:23.168 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:07:23.172 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 15:07:23.206 +03:00 [DBG] mvc found in database: true
2018-07-31 15:07:26.757 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-07-31 15:11:12.155 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 15:11:12.202 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 15:11:12.206 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 15:11:12.222 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 15:11:12.232 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 15:11:12.529 +03:00 [DBG] Starting token cleanup
2018-07-31 15:11:21.120 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 15:11:21.159 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 15:11:21.162 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 15:11:21.168 +03:00 [DBG] Start discovery request
2018-07-31 15:11:23.857 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 15:11:24.218 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 15:11:24.224 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 15:11:24.226 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 15:11:24.235 +03:00 [DBG] Start key discovery request
2018-07-31 15:11:24.343 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 15:11:24.355 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 15:11:24.359 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 15:11:24.365 +03:00 [DBG] Start authorize request
2018-07-31 15:11:24.387 +03:00 [DBG] No user present in authorize request
2018-07-31 15:11:24.394 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 15:11:24.917 +03:00 [DBG] mvc found in database: true
2018-07-31 15:11:24.926 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 15:11:24.930 +03:00 [DBG] No PKCE used.
2018-07-31 15:11:24.989 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:11:25.118 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:11:25.147 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:11:25.168 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:11:25.184 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 15:11:25.205 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJaq1buJtz8VdyRmcFwf6WSfskyJHsDj9w4YZ3lKIhcWvOKNiIAjlP9wPIQRigNLoj2E9W9GjoIO4tAcxOCvZOgKFXFBZMy9gwWBqvzZ8T7ciCOjeT35mvN2FjtkKGvfl6prUjucRl8HRQEprFHhYcVkwav5MZc9gzekwXG0NtceVDqkYdwh5LcCO7QgRmGmfdRI3BEc2pCr6d7ukmBJwnHVqJMNSBJ9cKS6CVBqudD23SYyjv3XWPlaf3xA02b9fGddutTnsPgCpNANdY-RWEPz3yo2rrOOoJMlrrpavrk1MXCmB3NAMLJN6KnNrgCG8I",
  "Nonce": "636686358843148616.OThkNzk1ZGYtOTI0ZC00MjJkLWI3MzMtY2RmZjZkOGYwMDZjZGZmMmQxNDYtZmZiYS00ODJmLWJjMzEtNzNhYzU2MWRhMWRi",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686358843148616.OThkNzk1ZGYtOTI0ZC00MjJkLWI3MzMtY2RmZjZkOGYwMDZjZGZmMmQxNDYtZmZiYS00ODJmLWJjMzEtNzNhYzU2MWRhMWRi",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJaq1buJtz8VdyRmcFwf6WSfskyJHsDj9w4YZ3lKIhcWvOKNiIAjlP9wPIQRigNLoj2E9W9GjoIO4tAcxOCvZOgKFXFBZMy9gwWBqvzZ8T7ciCOjeT35mvN2FjtkKGvfl6prUjucRl8HRQEprFHhYcVkwav5MZc9gzekwXG0NtceVDqkYdwh5LcCO7QgRmGmfdRI3BEc2pCr6d7ukmBJwnHVqJMNSBJ9cKS6CVBqudD23SYyjv3XWPlaf3xA02b9fGddutTnsPgCpNANdY-RWEPz3yo2rrOOoJMlrrpavrk1MXCmB3NAMLJN6KnNrgCG8I",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 15:11:25.225 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 15:11:25.341 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 15:11:25.372 +03:00 [DBG] mvc found in database: true
2018-07-31 15:11:25.374 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 15:11:25.377 +03:00 [DBG] No PKCE used.
2018-07-31 15:11:25.385 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:11:25.400 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:11:25.409 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:11:25.424 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:11:25.428 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 15:11:25.456 +03:00 [DBG] mvc found in database: true
2018-07-31 15:11:27.568 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-07-31 15:11:31.904 +03:00 [INF] Error from RemoteAuthentication: An error occurred when retrieving user information (Forbidden). Please check if the authentication information is correct and the corresponding Google+ API is enabled..
2018-07-31 15:11:31.913 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: An error was encountered while handling the remote login. ---> System.Net.Http.HttpRequestException: An error occurred when retrieving user information (Forbidden). Please check if the authentication information is correct and the corresponding Google+ API is enabled.
   at Microsoft.AspNetCore.Authentication.Google.GoogleHandler.<CreateTicketAsync>d__1.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Authentication.OAuth.OAuthHandler`1.<HandleRemoteAuthenticateAsync>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.<HandleRequestAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.<HandleRequestAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.FederatedSignOut.AuthenticationRequestHandlerWrapper.<HandleRequestAsync>d__6.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\FederatedSignOut\AuthenticationRequestHandlerWrapper.cs:line 38
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 15:13:47.066 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 15:13:47.125 +03:00 [DBG] mvc found in database: true
2018-07-31 15:13:47.129 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 15:13:47.132 +03:00 [DBG] No PKCE used.
2018-07-31 15:13:47.145 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:13:47.232 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:13:47.243 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 15:13:47.271 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 15:13:47.287 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 15:13:47.324 +03:00 [DBG] mvc found in database: true
2018-07-31 15:13:48.550 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-07-31 15:13:55.064 +03:00 [INF] Error from RemoteAuthentication: An error occurred when retrieving user information (Forbidden). Please check if the authentication information is correct and the corresponding Google+ API is enabled..
2018-07-31 15:13:55.071 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: An error was encountered while handling the remote login. ---> System.Net.Http.HttpRequestException: An error occurred when retrieving user information (Forbidden). Please check if the authentication information is correct and the corresponding Google+ API is enabled.
   at Microsoft.AspNetCore.Authentication.Google.GoogleHandler.<CreateTicketAsync>d__1.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Authentication.OAuth.OAuthHandler`1.<HandleRemoteAuthenticateAsync>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.<HandleRequestAsync>d__12.MoveNext()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.<HandleRequestAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.FederatedSignOut.AuthenticationRequestHandlerWrapper.<HandleRequestAsync>d__6.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\FederatedSignOut\AuthenticationRequestHandlerWrapper.cs:line 38
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-07-31 18:21:39.923 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-31 18:21:39.980 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-31 18:21:39.985 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-31 18:21:39.990 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-31 18:21:39.997 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-31 18:21:40.276 +03:00 [DBG] Starting token cleanup
2018-07-31 18:26:04.577 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-07-31 18:26:04.615 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-07-31 18:26:04.617 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-07-31 18:26:04.623 +03:00 [DBG] Start discovery request
2018-07-31 18:26:07.210 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-07-31 18:26:07.517 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-07-31 18:26:07.522 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-07-31 18:26:07.524 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-07-31 18:26:07.530 +03:00 [DBG] Start key discovery request
2018-07-31 18:26:07.651 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 18:26:07.663 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 18:26:07.666 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 18:26:07.673 +03:00 [DBG] Start authorize request
2018-07-31 18:26:07.694 +03:00 [DBG] No user present in authorize request
2018-07-31 18:26:07.702 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:08.218 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:08.229 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:08.237 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:08.299 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:08.443 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:08.469 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:08.488 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:08.504 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:08.526 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
  "Nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:26:08.551 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 18:26:08.651 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:08.681 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:08.684 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:08.687 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:08.694 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:08.711 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:08.720 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:08.740 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:08.744 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:08.782 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:18.611 +03:00 [INF] AuthenticationScheme: oidc was challenged.
2018-07-31 18:26:27.120 +03:00 [DBG] CORS request made for path: /signin-oidc from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 18:26:27.352 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-07-31 18:26:27.951 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "oidc",
  "ProviderUserId": "wY81KoaEF5dT-0W2F69Y50ceEp4ckY8tQgXG8Mu4MKU",
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "DisplayName": "Andrei Krasnou",
  "Endpoint": "UI",
  "ActivityId": "0HLFMV58AGSQ3:00000005",
  "TimeStamp": "2018-07-31T15:26:27Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:26:27.973 +03:00 [DBG] Augmenting SignInContext
2018-07-31 18:26:27.978 +03:00 [DBG] Adding amr claim with value: external
2018-07-31 18:26:27.985 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 18:26:28.008 +03:00 [INF] AuthenticationScheme: idsrv.external signed out.
2018-07-31 18:26:28.032 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 18:26:28.037 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 18:26:28.041 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 18:26:28.050 +03:00 [DBG] Start authorize callback request
2018-07-31 18:26:28.058 +03:00 [DBG] User in authorize request: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 18:26:28.061 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:28.087 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:28.091 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:28.093 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:28.100 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:28.115 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:28.124 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:28.137 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:28.142 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:28.145 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
  "Nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
  "SessionId": "7091f06c8a56d732dd2a94f21ef19b00",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:26:28.244 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 18:26:28.246 +03:00 [INF] Showing consent: User has not yet consented
2018-07-31 18:26:28.284 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:28.310 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:28.312 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:28.315 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:28.322 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:28.336 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:28.344 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:28.359 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:28.363 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:28.396 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:28.408 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:28.485 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:32.092 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 18:26:32.155 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:32.196 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:32.198 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:32.201 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:32.215 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:32.234 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:32.245 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:32.267 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:32.275 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:32.310 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 18:26:32.315 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 18:26:32.317 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 18:26:32.321 +03:00 [DBG] Start authorize callback request
2018-07-31 18:26:32.351 +03:00 [DBG] User in authorize request: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 18:26:32.358 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:26:32.393 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:32.397 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:26:32.400 +03:00 [DBG] No PKCE used.
2018-07-31 18:26:32.413 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:32.432 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:32.446 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:32.468 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:32.472 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:26:32.476 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
  "Nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
  "SessionId": "7091f06c8a56d732dd2a94f21ef19b00",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686475676220571.MDAyYmEzYzAtZDlhNC00YjlkLTkxOWItY2MyNjMxM2I1NTYzYjljYzI2MDEtM2RiMS00YTA3LWI3ZGUtZDFjZTEzNjVjYjZj",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:26:32.503 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 18:26:32.517 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-31 18:26:32.526 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-31 18:26:32.534 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 18:26:32.604 +03:00 [DBG] HGBcpkTniknEaktwmgO7YJ0YgUihnP2tsjPPrfB9pnc= found in database
2018-07-31 18:26:32.816 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-31 18:26:32.852 +03:00 [DBG] nNkCJSRhstW1qkawrkPCT8kjOrzdiz9SFKVeGp7Bb6E= not found in database
2018-07-31 18:26:32.905 +03:00 [DBG] Creating Implicit Flow response.
2018-07-31 18:26:32.919 +03:00 [DBG] Getting claims for identity token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273 and client: mvc
2018-07-31 18:26:32.926 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 18:26:32.980 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****PCPg"
    },
    {
      "TokenType": "code",
      "TokenValue": "****ee5b"
    }
  ],
  "ActivityId": "0HLFMV58AGSQ3:00000009",
  "TimeStamp": "2018-07-31T15:26:32Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:26:32.993 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "88ba8019-3f4d-48cc-a388-82ee2f840273",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK-5qvIg_xza7wsHik-yL1H8ZrCVKerD40PQ_3x5v3c8SjvduUt9s9krZLsNDOWR_7p1UMnf686ptuFkMKGLsd2pgoVIRsLu6N4amANllLizUHR0kf1dJieOMjawriKBxps-E8EAQzh5GjRcvSShmGInVWKrIANGXhq_C90WQz5yJ80q4ZcNYGna3gKIuWO9Qw_aMSBeySM2CswWwWMztyrGayi9rnwnm5FYMqKfI3nInyAwZlE-9Z8itlFhHjUogJsRUDYsuyd2acR83JSavSlef3QYmTb87ieeB43szN7vGUXMom5oz7OCvQkCBARSPg",
  "Scope": "openid profile api1 offline_access"
}
2018-07-31 18:26:33.024 +03:00 [DBG] Augmenting SignInContext
2018-07-31 18:26:33.027 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 18:26:33.165 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-31 18:26:33.177 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-31 18:26:33.181 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-31 18:26:33.191 +03:00 [DBG] Start token request.
2018-07-31 18:26:33.201 +03:00 [DBG] Start client validation
2018-07-31 18:26:33.210 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-31 18:26:33.216 +03:00 [DBG] Start parsing for secret in post body
2018-07-31 18:26:33.219 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-31 18:26:33.221 +03:00 [DBG] Secret id found: mvc
2018-07-31 18:26:33.259 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:33.271 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-31 18:26:33.275 +03:00 [DBG] Client validation success
2018-07-31 18:26:33.284 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFMV58AGSQ2:00000003",
  "TimeStamp": "2018-07-31T15:26:33Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:26:33.294 +03:00 [DBG] Start token request validation
2018-07-31 18:26:33.308 +03:00 [DBG] Start validation of authorization code token request
2018-07-31 18:26:33.336 +03:00 [DBG] nNkCJSRhstW1qkawrkPCT8kjOrzdiz9SFKVeGp7Bb6E= found in database: true
2018-07-31 18:26:33.381 +03:00 [DBG] removing nNkCJSRhstW1qkawrkPCT8kjOrzdiz9SFKVeGp7Bb6E= persisted grant from database
2018-07-31 18:26:33.416 +03:00 [DBG] Validation of authorization code token request success
2018-07-31 18:26:33.433 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "7d0871257236ac375538d977b1f3b83b1035da1d4ca3e8b9c36dac860dbdee5b",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "7d0871257236ac375538d977b1f3b83b1035da1d4ca3e8b9c36dac860dbdee5b",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-31 18:26:33.481 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:33.489 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:33.510 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:33.526 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-31 18:26:33.529 +03:00 [DBG] Getting claims for access token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273
2018-07-31 18:26:33.587 +03:00 [DBG] Creating refresh token
2018-07-31 18:26:33.590 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-31 18:26:33.615 +03:00 [DBG] 4G8DwYragGlZN35+zpM0FULCc8nqFd1n07dKX2Tkd94= not found in database
2018-07-31 18:26:33.650 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:33.661 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:33.681 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:26:33.686 +03:00 [DBG] Getting claims for identity token for subject: 88ba8019-3f4d-48cc-a388-82ee2f840273 and client: mvc
2018-07-31 18:26:33.688 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 18:26:33.696 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Xt-w"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****dc97"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****up-Q"
    }
  ],
  "ActivityId": "0HLFMV58AGSQ2:00000003",
  "TimeStamp": "2018-07-31T15:26:33Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:26:33.702 +03:00 [DBG] Token request success.
2018-07-31 18:26:33.725 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-31 18:26:33.731 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-31 18:26:33.733 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-31 18:26:33.744 +03:00 [DBG] Start userinfo request
2018-07-31 18:26:33.751 +03:00 [DBG] Bearer token found in header
2018-07-31 18:26:33.802 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:33.832 +03:00 [DBG] mvc found in database: true
2018-07-31 18:26:33.845 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-31 18:26:33.855 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533050793,
    "exp": 1533054393,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "88ba8019-3f4d-48cc-a388-82ee2f840273",
    "auth_time": 1533050787,
    "idp": "oidc",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "external"
  }
}
2018-07-31 18:26:33.881 +03:00 [DBG] Creating userinfo response
2018-07-31 18:26:33.888 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:26:33.895 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:26:33.906 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:33.911 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-31 18:26:33.915 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:26:33.924 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:26:33.962 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-07-31 18:26:33.967 +03:00 [DBG] End userinfo request
2018-07-31 18:31:05.209 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-31 18:31:05.215 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-31 18:31:05.225 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-31 18:31:05.229 +03:00 [DBG] Start authorize request
2018-07-31 18:31:05.231 +03:00 [DBG] No user present in authorize request
2018-07-31 18:31:05.234 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:05.292 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:05.295 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:05.297 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:05.311 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:05.386 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:05.394 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:05.409 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:05.412 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:05.415 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
  "Nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:31:05.423 +03:00 [INF] Showing login: User is not authenticated
2018-07-31 18:31:05.440 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:05.473 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:05.475 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:05.478 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:05.485 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:05.501 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:05.512 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:05.531 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:05.534 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:05.593 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:11.191 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 18:31:13.752 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLFMV58AGSQ4:00000003",
  "TimeStamp": "2018-07-31T15:31:13Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:31:13.761 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:13.790 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:13.793 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:13.795 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:13.803 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:13.818 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:13.829 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:13.849 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:13.853 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:13.879 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:29.693 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 18:31:50.296 +03:00 [DBG] Augmenting SignInContext
2018-07-31 18:31:50.298 +03:00 [DBG] Adding idp claim with value: local
2018-07-31 18:31:50.304 +03:00 [DBG] Adding amr claim with value: pwd
2018-07-31 18:31:50.306 +03:00 [DBG] Adding auth_time claim with value: 1533051110
2018-07-31 18:31:50.312 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 18:31:50.321 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "andrei_krasnou@epam.com",
  "SubjectId": "126c9a17-7508-4a71-9912-66c82e20d0c7",
  "DisplayName": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "ActivityId": "0HLFMV58AGSQ4:00000004",
  "TimeStamp": "2018-07-31T15:31:50Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:31:50.346 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 18:31:50.354 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 18:31:50.357 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 18:31:50.361 +03:00 [DBG] Start authorize callback request
2018-07-31 18:31:50.363 +03:00 [DBG] User in authorize request: 126c9a17-7508-4a71-9912-66c82e20d0c7
2018-07-31 18:31:50.366 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:50.423 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:50.426 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:50.428 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:50.440 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:50.511 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:50.522 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:50.538 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:50.541 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:50.545 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "126c9a17-7508-4a71-9912-66c82e20d0c7",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
  "Nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
  "SessionId": "864cf0183866a7e0e2b13fef70ce62d1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:31:50.578 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 18:31:50.580 +03:00 [INF] Showing consent: User has not yet consented
2018-07-31 18:31:50.597 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:50.632 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:50.634 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:50.636 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:50.643 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:50.658 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:50.664 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:50.679 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:50.681 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:50.703 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:50.714 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:50.786 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:56.355 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-07-31 18:31:56.374 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:56.411 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:56.413 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:56.415 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:56.424 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:56.438 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:56.446 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:56.460 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:56.461 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:56.476 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-31 18:31:56.480 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-31 18:31:56.482 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-31 18:31:56.484 +03:00 [DBG] Start authorize callback request
2018-07-31 18:31:56.488 +03:00 [DBG] User in authorize request: 126c9a17-7508-4a71-9912-66c82e20d0c7
2018-07-31 18:31:56.491 +03:00 [DBG] Start authorize request protocol validation
2018-07-31 18:31:56.522 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:56.524 +03:00 [DBG] Checking for PKCE parameters
2018-07-31 18:31:56.526 +03:00 [DBG] No PKCE used.
2018-07-31 18:31:56.533 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:56.554 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:56.562 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:56.577 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:56.580 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-31 18:31:56.582 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "126c9a17-7508-4a71-9912-66c82e20d0c7",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
  "Nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
  "SessionId": "864cf0183866a7e0e2b13fef70ce62d1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636686478651835035.NzYzYTNhYzctNzQxZS00NTg3LWJhOWYtZDlkNjBhNzE3YTFlNTg1MDJlYjItZTI1NS00MzlkLWI2NDEtZjI0OTY1MmFhNDg2",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-07-31 18:31:56.598 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-07-31 18:31:56.601 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-07-31 18:31:56.604 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-07-31 18:31:56.607 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 126c9a17-7508-4a71-9912-66c82e20d0c7
2018-07-31 18:31:56.619 +03:00 [DBG] d5wpkntG+bW4BLPMyKNjDvpkPp+hFLF1MzwduV0NhYc= not found in database
2018-07-31 18:31:56.629 +03:00 [DBG] Creating Hybrid Flow response.
2018-07-31 18:31:56.645 +03:00 [DBG] nVguuRuRnsHNBLQ1lCqVO/KXKBamZo9vZp4WKLjNouo= not found in database
2018-07-31 18:31:56.651 +03:00 [DBG] Creating Implicit Flow response.
2018-07-31 18:31:56.655 +03:00 [DBG] Getting claims for identity token for subject: 126c9a17-7508-4a71-9912-66c82e20d0c7 and client: mvc
2018-07-31 18:31:56.658 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 18:31:56.663 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "126c9a17-7508-4a71-9912-66c82e20d0c7",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****cfow"
    },
    {
      "TokenType": "code",
      "TokenValue": "****3221"
    }
  ],
  "ActivityId": "0HLFMV58AGSQ4:00000008",
  "TimeStamp": "2018-07-31T15:31:56Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:31:56.666 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "126c9a17-7508-4a71-9912-66c82e20d0c7",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKWppnSbihCGmQASIPaCij5WR3CDKr6aelm_2soe99xGdoUPtSsJWVvsJbUJ-Y8vg0NcZglsQzpXRmIB9Ed5cjNrr6-jC3b6uAXvduL4slZ7rA3JcXFDd-0jj82YeblL8d6lGD7mWZWG6GhvTRPNUVN_iXsABrP6LgAzorGetZTb3U6bfW8D1SYnJM4qfwo9SEK4i8iW6ZntSA6PPruTpP7IUM8-okXMvml80gBeIx65mZ8KP37UzYap9ejXTj03dmbxu40iBNn_tWUF1OeuvjEoJ9haLO-TNFETRQLB6-UXxaTAoElfWtE-z2aBtAgaAQ",
  "Scope": "openid profile api1 offline_access"
}
2018-07-31 18:31:56.672 +03:00 [DBG] Augmenting SignInContext
2018-07-31 18:31:56.674 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-31 18:31:56.779 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-07-31 18:31:56.783 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-07-31 18:31:56.795 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-07-31 18:31:56.799 +03:00 [DBG] Start token request.
2018-07-31 18:31:56.807 +03:00 [DBG] Start client validation
2018-07-31 18:31:56.810 +03:00 [DBG] Start parsing Basic Authentication secret
2018-07-31 18:31:56.812 +03:00 [DBG] Start parsing for secret in post body
2018-07-31 18:31:56.814 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-07-31 18:31:56.822 +03:00 [DBG] Secret id found: mvc
2018-07-31 18:31:56.878 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:56.884 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-07-31 18:31:56.891 +03:00 [DBG] Client validation success
2018-07-31 18:31:56.894 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFMV58AGSQ8:00000001",
  "TimeStamp": "2018-07-31T15:31:56Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:31:56.898 +03:00 [DBG] Start token request validation
2018-07-31 18:31:56.904 +03:00 [DBG] Start validation of authorization code token request
2018-07-31 18:31:56.916 +03:00 [DBG] nVguuRuRnsHNBLQ1lCqVO/KXKBamZo9vZp4WKLjNouo= found in database: true
2018-07-31 18:31:56.941 +03:00 [DBG] removing nVguuRuRnsHNBLQ1lCqVO/KXKBamZo9vZp4WKLjNouo= persisted grant from database
2018-07-31 18:31:56.994 +03:00 [DBG] Validation of authorization code token request success
2018-07-31 18:31:57.000 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "ba09380e3a222011c72f8eb96316fe16411a9304e2857ce6b97d4333b3a13221",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "ba09380e3a222011c72f8eb96316fe16411a9304e2857ce6b97d4333b3a13221",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-07-31 18:31:57.032 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:57.041 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:57.056 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:57.059 +03:00 [DBG] Getting claims for access token for client: mvc
2018-07-31 18:31:57.061 +03:00 [DBG] Getting claims for access token for subject: 126c9a17-7508-4a71-9912-66c82e20d0c7
2018-07-31 18:31:57.078 +03:00 [DBG] Creating refresh token
2018-07-31 18:31:57.081 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-07-31 18:31:57.096 +03:00 [DBG] HkTnfxCvdqUMS6yvr/xPRhMTXlYclZ1aRIrcmxP5IDY= not found in database
2018-07-31 18:31:57.122 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:57.129 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:57.142 +03:00 [DBG] Found ["api1"] API scopes in database
2018-07-31 18:31:57.145 +03:00 [DBG] Getting claims for identity token for subject: 126c9a17-7508-4a71-9912-66c82e20d0c7 and client: mvc
2018-07-31 18:31:57.147 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-31 18:31:57.151 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****7ccA"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****8812"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****ODIQ"
    }
  ],
  "ActivityId": "0HLFMV58AGSQ8:00000001",
  "TimeStamp": "2018-07-31T15:31:57Z",
  "ProcessId": 544,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-07-31 18:31:57.154 +03:00 [DBG] Token request success.
2018-07-31 18:31:57.164 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-31 18:31:57.169 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-31 18:31:57.171 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-31 18:31:57.174 +03:00 [DBG] Start userinfo request
2018-07-31 18:31:57.177 +03:00 [DBG] Bearer token found in header
2018-07-31 18:31:57.216 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:57.242 +03:00 [DBG] mvc found in database: true
2018-07-31 18:31:57.255 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-31 18:31:57.258 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533051117,
    "exp": 1533054717,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "126c9a17-7508-4a71-9912-66c82e20d0c7",
    "auth_time": 1533051110,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-07-31 18:31:57.266 +03:00 [DBG] Creating userinfo response
2018-07-31 18:31:57.268 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:31:57.271 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:31:57.278 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:57.280 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-07-31 18:31:57.282 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-07-31 18:31:57.290 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-31 18:31:57.304 +03:00 [INF] Profile service returned to the following claim types: sub preferred_username name
2018-07-31 18:31:57.307 +03:00 [DBG] End userinfo request
2018-07-31 19:21:40.339 +03:00 [INF] Clearing 0 tokens
2018-07-31 20:21:40.296 +03:00 [INF] Clearing 0 tokens
2018-07-31 21:21:40.380 +03:00 [INF] Clearing 0 tokens
2018-07-31 22:21:40.379 +03:00 [INF] Clearing 0 tokens
2018-07-31 23:21:40.380 +03:00 [INF] Clearing 0 tokens
2018-08-01 00:21:40.434 +03:00 [INF] Clearing 0 tokens
2018-08-01 01:21:40.456 +03:00 [INF] Clearing 0 tokens
2018-08-01 02:21:40.424 +03:00 [INF] Clearing 0 tokens
2018-08-01 03:21:40.431 +03:00 [INF] Clearing 0 tokens
2018-08-01 04:21:40.430 +03:00 [INF] Clearing 0 tokens
2018-08-01 05:21:40.449 +03:00 [INF] Clearing 0 tokens
2018-08-01 06:21:40.483 +03:00 [INF] Clearing 0 tokens
2018-08-01 07:21:40.503 +03:00 [INF] Clearing 0 tokens
2018-08-01 08:21:40.488 +03:00 [INF] Clearing 0 tokens
2018-08-01 09:21:40.503 +03:00 [INF] Clearing 0 tokens
2018-08-01 10:21:40.492 +03:00 [INF] Clearing 0 tokens
2018-08-01 11:14:00.195 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:14:00.244 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:14:00.247 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:14:00.250 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:14:00.252 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:14:00.495 +03:00 [DBG] Starting token cleanup
2018-08-01 11:14:12.256 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:14:12.295 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:14:12.298 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:14:12.303 +03:00 [DBG] Start discovery request
2018-08-01 11:14:15.028 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:14:15.537 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:14:15.544 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:14:15.546 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:14:15.552 +03:00 [DBG] Start key discovery request
2018-08-01 11:14:15.664 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:14:15.691 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:14:15.705 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:14:15.721 +03:00 [DBG] Start authorize request
2018-08-01 11:14:15.758 +03:00 [DBG] No user present in authorize request
2018-08-01 11:14:15.774 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:14:16.573 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:16.583 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:14:16.590 +03:00 [DBG] No PKCE used.
2018-08-01 11:14:16.659 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:16.794 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:16.821 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:16.837 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:16.850 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:14:16.870 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLIirL4XQawk6ZnRoOG_Zci0tMlFGzNaEZU5UnwrAbfC7ojlA6pQwMWSEWRskiJwbdZthFUiyiKhTyGzkWmIHciFGkhKKXRJ0YwgmUKomVOKpm-n0Nl3j0DDWyMMMT-ZaTOYGfyYYr8DkKGmjyXxgFSMHAv0nb8-rJktAruzhH3Gk2610soo1lc2EWcl-765ye9L4dRSNBuio4cnzkJxXJuj9alw5J_AUqGsRUZe3XgoSu22MR6dx0lNYBbocdjHBrSGSfdlvJChpGxOQ0J0RxwdtOB5rEIdZ1EuPne1SCAGRGCaz7BXH-A2FVBI9APiH8",
  "Nonce": "636687080556321970.MjRmZGNkNjYtMjViMi00NjFlLWE1NWQtMmE0NTJjYzExMzdhZGEzZmM2YzAtODUyNC00Yjc3LTg3OWItNmExMTFmYmM0OTk4",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687080556321970.MjRmZGNkNjYtMjViMi00NjFlLWE1NWQtMmE0NTJjYzExMzdhZGEzZmM2YzAtODUyNC00Yjc3LTg3OWItNmExMTFmYmM0OTk4",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLIirL4XQawk6ZnRoOG_Zci0tMlFGzNaEZU5UnwrAbfC7ojlA6pQwMWSEWRskiJwbdZthFUiyiKhTyGzkWmIHciFGkhKKXRJ0YwgmUKomVOKpm-n0Nl3j0DDWyMMMT-ZaTOYGfyYYr8DkKGmjyXxgFSMHAv0nb8-rJktAruzhH3Gk2610soo1lc2EWcl-765ye9L4dRSNBuio4cnzkJxXJuj9alw5J_AUqGsRUZe3XgoSu22MR6dx0lNYBbocdjHBrSGSfdlvJChpGxOQ0J0RxwdtOB5rEIdZ1EuPne1SCAGRGCaz7BXH-A2FVBI9APiH8",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:14:16.888 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:14:17.015 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:14:17.088 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:17.093 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:14:17.096 +03:00 [DBG] No PKCE used.
2018-08-01 11:14:17.115 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:17.130 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:14:17.138 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:14:17.146 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:14:17.152 +03:00 [DBG] Start authorize request
2018-08-01 11:14:17.156 +03:00 [DBG] No user present in authorize request
2018-08-01 11:14:17.221 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:14:17.312 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:17.334 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:17.369 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:17.373 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:14:17.376 +03:00 [DBG] No PKCE used.
2018-08-01 11:14:17.391 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:17.491 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:17.491 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:17.498 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:14:17.509 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:17.602 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:17.636 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:17.658 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:14:17.669 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLMt61mhcZx9K0k6rTNGjzRyv341rToAFPQk0nZby1w2cMITvPsYRJ216y9UZYO4avQxBDmE-616ETdjtSyXSNeSs3QVsbxGpx16uT9V6h55utqHmeWDlgJIwyTm3jibsIqX1WtgAYxQjICXYXcxewOAJndKH5KxWf8yDxptB5vazc8bnCUD_iyWOMKe5kP-puwvMIiKSraLpHHm7vQnuZgtzSjWEBvcuOaDpSR11FzYMzm9HxYp3GQg7HqI-PPMjsHZSicb0_N2wI7s0tVTTUR0ouuOEGNUR_Ve7_mKSR4ANeZt7nJFLMHsMGtPb2W80U",
  "Nonce": "636687080571081037.ZmM2MjQ2ODQtZDY5NC00ZDQxLThjMmUtMTBlNzBmN2NhNmNmYjkwOTgxNTEtMzljZC00Y2I5LWJjMGYtZjJkZWE2MTgzNjEw",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687080571081037.ZmM2MjQ2ODQtZDY5NC00ZDQxLThjMmUtMTBlNzBmN2NhNmNmYjkwOTgxNTEtMzljZC00Y2I5LWJjMGYtZjJkZWE2MTgzNjEw",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzLMt61mhcZx9K0k6rTNGjzRyv341rToAFPQk0nZby1w2cMITvPsYRJ216y9UZYO4avQxBDmE-616ETdjtSyXSNeSs3QVsbxGpx16uT9V6h55utqHmeWDlgJIwyTm3jibsIqX1WtgAYxQjICXYXcxewOAJndKH5KxWf8yDxptB5vazc8bnCUD_iyWOMKe5kP-puwvMIiKSraLpHHm7vQnuZgtzSjWEBvcuOaDpSR11FzYMzm9HxYp3GQg7HqI-PPMjsHZSicb0_N2wI7s0tVTTUR0ouuOEGNUR_Ve7_mKSR4ANeZt7nJFLMHsMGtPb2W80U",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:14:17.681 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:14:17.699 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:14:17.792 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:17.796 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:14:17.799 +03:00 [DBG] No PKCE used.
2018-08-01 11:14:17.819 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:17.930 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:17.947 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:14:18.035 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:14:18.040 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:14:18.115 +03:00 [DBG] mvc found in database: true
2018-08-01 11:14:20.109 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-08-01 11:17:06.704 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:17:06.764 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:17:06.767 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:17:06.771 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:17:06.778 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:17:07.048 +03:00 [DBG] Starting token cleanup
2018-08-01 11:17:20.316 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:17:20.352 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:17:20.354 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:17:20.360 +03:00 [DBG] Start discovery request
2018-08-01 11:17:22.893 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:17:23.196 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:17:23.204 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:17:23.206 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:17:23.212 +03:00 [DBG] Start key discovery request
2018-08-01 11:17:23.317 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:17:23.326 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:17:23.328 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:17:23.337 +03:00 [DBG] Start authorize request
2018-08-01 11:17:23.359 +03:00 [DBG] No user present in authorize request
2018-08-01 11:17:23.368 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:17:23.890 +03:00 [DBG] mvc found in database: true
2018-08-01 11:17:23.901 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:17:23.907 +03:00 [DBG] No PKCE used.
2018-08-01 11:17:23.967 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:17:24.096 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:17:24.123 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:17:24.141 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:17:24.156 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:17:24.177 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIeR-b6FZLFmnVe2c-n1PBkonKgQJNsfCNJWOndnTFSk2yOcqvnwQVCyhiHf3EZnV0bSndTONpsA11mRNm9gUAvDRN_GP9M9X2J5qnguaU2L4zgc8BRAkHNYzq5gvi9yR48oL5FucuItXCMTz0ASgqeQt-8hUqwBxiKou9AyklM8KH-kfFoUOP3KLozb_f2k7OXfAHDDyXnNcm-AjjxhPCjmkHCnNfib9CbgqO0yB5mwmxCiahdqqa1lGTr4XnZ6xdScDKcItKpWav7kMwj3ZW-pxjs3HFxtPJ_y3TdJIRZDU6qxc51rMzVUNr6kv9v3NQ",
  "Nonce": "636687082432979388.YTQ2MjQ0ZTctOWZjNi00M2Y4LWEwYTEtNjgzM2ZiMTJjYjUwMzc4NDU4MDctNGQ2MC00YzdjLTk4YzctYmI2MDM3OTRhZjRj",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687082432979388.YTQ2MjQ0ZTctOWZjNi00M2Y4LWEwYTEtNjgzM2ZiMTJjYjUwMzc4NDU4MDctNGQ2MC00YzdjLTk4YzctYmI2MDM3OTRhZjRj",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIeR-b6FZLFmnVe2c-n1PBkonKgQJNsfCNJWOndnTFSk2yOcqvnwQVCyhiHf3EZnV0bSndTONpsA11mRNm9gUAvDRN_GP9M9X2J5qnguaU2L4zgc8BRAkHNYzq5gvi9yR48oL5FucuItXCMTz0ASgqeQt-8hUqwBxiKou9AyklM8KH-kfFoUOP3KLozb_f2k7OXfAHDDyXnNcm-AjjxhPCjmkHCnNfib9CbgqO0yB5mwmxCiahdqqa1lGTr4XnZ6xdScDKcItKpWav7kMwj3ZW-pxjs3HFxtPJ_y3TdJIRZDU6qxc51rMzVUNr6kv9v3NQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:17:24.198 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:17:24.294 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:17:24.324 +03:00 [DBG] mvc found in database: true
2018-08-01 11:17:24.326 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:17:24.328 +03:00 [DBG] No PKCE used.
2018-08-01 11:17:24.338 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:17:24.353 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:17:24.361 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:17:24.376 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:17:24.380 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:17:24.409 +03:00 [DBG] mvc found in database: true
2018-08-01 11:17:26.623 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-08-01 11:17:37.246 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-08-01 11:17:37.443 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: External authentication error
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 168
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-08-01 11:18:35.977 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:18:35.988 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:18:35.992 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:18:35.995 +03:00 [DBG] Start authorize request
2018-08-01 11:18:35.997 +03:00 [DBG] No user present in authorize request
2018-08-01 11:18:36.000 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:18:36.095 +03:00 [DBG] mvc found in database: true
2018-08-01 11:18:36.098 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:18:36.100 +03:00 [DBG] No PKCE used.
2018-08-01 11:18:36.118 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:36.207 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:36.224 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:36.337 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:36.344 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:18:36.355 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJl0IUnwhVZ-3bMdb1uM8TLA2RIoVsxRhFlmL66aLjp44OJsXJ4Zspr4dCqKmN72j45Los_W5ZFgp5a0GKCmUWKpePozrd93R5doDr2alneCfjN2-9aSHQ_LTQ0Nr0XlN0a8SMijFBBXeX6i9eHiVTn5XWMD2cxp_lHPSj5Urtmo4EvHMBMf5X_s4BxLLKkfWo8sfzufCMYPX2NP4pQ4jOa-bDiRtYu7uxdMnPHMqjdTIKPMxa35ORFUStcGoArybedd4p8ZcqMFRPufhkCN0UN9CdTKnihiXHlD460DdYcCJBbKLxXu6zgraiEQLqIIHQ",
  "Nonce": "636687083159576078.MmY2MTVhZGQtZDRjNS00OWM2LWFhNzktNDIwODBjNjQwMjZlNzhmMTE4ZjktNGZlMS00NjI5LTg0MmEtNWViNmE5ZTgxN2E1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687083159576078.MmY2MTVhZGQtZDRjNS00OWM2LWFhNzktNDIwODBjNjQwMjZlNzhmMTE4ZjktNGZlMS00NjI5LTg0MmEtNWViNmE5ZTgxN2E1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJl0IUnwhVZ-3bMdb1uM8TLA2RIoVsxRhFlmL66aLjp44OJsXJ4Zspr4dCqKmN72j45Los_W5ZFgp5a0GKCmUWKpePozrd93R5doDr2alneCfjN2-9aSHQ_LTQ0Nr0XlN0a8SMijFBBXeX6i9eHiVTn5XWMD2cxp_lHPSj5Urtmo4EvHMBMf5X_s4BxLLKkfWo8sfzufCMYPX2NP4pQ4jOa-bDiRtYu7uxdMnPHMqjdTIKPMxa35ORFUStcGoArybedd4p8ZcqMFRPufhkCN0UN9CdTKnihiXHlD460DdYcCJBbKLxXu6zgraiEQLqIIHQ",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:18:36.367 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:18:36.380 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:18:36.430 +03:00 [DBG] mvc found in database: true
2018-08-01 11:18:36.433 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:18:36.437 +03:00 [DBG] No PKCE used.
2018-08-01 11:18:36.448 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:36.571 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:36.583 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:36.657 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:36.661 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:18:36.708 +03:00 [DBG] mvc found in database: true
2018-08-01 11:18:36.734 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:18:36.846 +03:00 [DBG] mvc found in database: true
2018-08-01 11:18:36.850 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:18:36.856 +03:00 [DBG] No PKCE used.
2018-08-01 11:18:36.879 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:36.960 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:36.974 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:18:37.053 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:18:37.058 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:18:37.115 +03:00 [DBG] mvc found in database: true
2018-08-01 11:18:38.216 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-08-01 11:18:44.597 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-08-01 11:18:44.698 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: External authentication error
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 168
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-08-01 11:18:57.836 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.Exception: External authentication error
   at IdentityServer.Quickstart.Account.AccountController.<ExternalLoginCallback>d__10.MoveNext() in D:\AuthPoc\IdentityServer\Quickstart\Account\AccountController.cs:line 168
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeActionMethodAsync>d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeNextActionFilterAsync>d__10.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<InvokeInnerFilterAsync>d__14.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeNextResourceFilter>d__22.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeFilterPipelineAsync>d__17.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.<InvokeAsync>d__15.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Builder.RouterMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-08-01 11:19:44.654 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:19:44.749 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:19:44.754 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:19:44.762 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:19:44.771 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:19:45.146 +03:00 [DBG] Starting token cleanup
2018-08-01 11:19:51.999 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:19:52.036 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:19:52.038 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:19:52.045 +03:00 [DBG] Start discovery request
2018-08-01 11:19:54.592 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:19:54.901 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:19:54.904 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:19:54.906 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:19:54.912 +03:00 [DBG] Start key discovery request
2018-08-01 11:19:55.010 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:19:55.019 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:19:55.022 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:19:55.030 +03:00 [DBG] Start authorize request
2018-08-01 11:19:55.051 +03:00 [DBG] No user present in authorize request
2018-08-01 11:19:55.060 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:19:55.593 +03:00 [DBG] mvc found in database: true
2018-08-01 11:19:55.602 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:19:55.606 +03:00 [DBG] No PKCE used.
2018-08-01 11:19:55.666 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:19:55.795 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:19:55.824 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:19:55.840 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:19:55.856 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:19:55.879 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
  "Nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:19:55.899 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:19:55.990 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:19:56.020 +03:00 [DBG] mvc found in database: true
2018-08-01 11:19:56.022 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:19:56.024 +03:00 [DBG] No PKCE used.
2018-08-01 11:19:56.032 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:19:56.048 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:19:56.055 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:19:56.071 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:19:56.076 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:19:56.105 +03:00 [DBG] mvc found in database: true
2018-08-01 11:19:58.415 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-08-01 11:20:04.464 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-08-01 11:20:32.284 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "105806803545823947289",
  "SubjectId": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
  "DisplayName": "Andrei Krasnou",
  "Endpoint": "UI",
  "ActivityId": "0HLFNGU53O163:00000006",
  "TimeStamp": "2018-08-01T08:20:32Z",
  "ProcessId": 43680,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:20:32.304 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:20:32.311 +03:00 [DBG] Adding amr claim with value: external
2018-08-01 11:20:32.323 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:20:32.343 +03:00 [INF] AuthenticationScheme: idsrv.external signed out.
2018-08-01 11:20:32.372 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:20:32.377 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:20:32.380 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:20:32.389 +03:00 [DBG] Start authorize callback request
2018-08-01 11:20:32.396 +03:00 [DBG] User in authorize request: c1156885-94ed-4f7b-9b10-ac37fe5a8a92
2018-08-01 11:20:32.399 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:20:32.442 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:32.445 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:20:32.447 +03:00 [DBG] No PKCE used.
2018-08-01 11:20:32.458 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:32.547 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:32.559 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:32.578 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:32.582 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:20:32.585 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
  "Nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
  "SessionId": "bfa617648b1dc46694ba2f80209a1860",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:20:32.653 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:20:32.672 +03:00 [INF] Showing consent: User has not yet consented
2018-08-01 11:20:32.719 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:20:32.753 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:32.756 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:20:32.760 +03:00 [DBG] No PKCE used.
2018-08-01 11:20:32.768 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:32.784 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:32.797 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:32.814 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:32.817 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:20:32.845 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:32.858 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:32.938 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:34.987 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:20:35.068 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:20:35.103 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:35.107 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:20:35.110 +03:00 [DBG] No PKCE used.
2018-08-01 11:20:35.119 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:35.138 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:35.147 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:35.165 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:35.171 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:20:35.213 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:20:35.218 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:20:35.225 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:20:35.242 +03:00 [DBG] Start authorize callback request
2018-08-01 11:20:35.278 +03:00 [DBG] User in authorize request: c1156885-94ed-4f7b-9b10-ac37fe5a8a92
2018-08-01 11:20:35.291 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:20:35.338 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:35.341 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:20:35.344 +03:00 [DBG] No PKCE used.
2018-08-01 11:20:35.353 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:35.369 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:35.379 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:35.396 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:35.399 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:20:35.402 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
  "Nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
  "SessionId": "bfa617648b1dc46694ba2f80209a1860",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687083949896710.YTVjODAwMTUtYjQ0MC00ODQ3LWJkYWItM2JmM2FhMzdiMGEzZDA1MmQzOWItNTdhYi00MTFjLTk0NTAtMTA1Mzk2MDU3NzM1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:20:35.419 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:20:35.429 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:20:35.435 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:20:35.443 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c1156885-94ed-4f7b-9b10-ac37fe5a8a92
2018-08-01 11:20:35.493 +03:00 [DBG] 9VcYbJA3JBR7xidQ1urInxKC/a7M3rO/fdQkxC85Ra8= not found in database
2018-08-01 11:20:35.565 +03:00 [DBG] Creating Hybrid Flow response.
2018-08-01 11:20:35.600 +03:00 [DBG] GBNr/1q41DE9ryMuumJ54m4+/isppyKBcEGker85efw= not found in database
2018-08-01 11:20:35.613 +03:00 [DBG] Creating Implicit Flow response.
2018-08-01 11:20:35.627 +03:00 [DBG] Getting claims for identity token for subject: c1156885-94ed-4f7b-9b10-ac37fe5a8a92 and client: mvc
2018-08-01 11:20:35.633 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:20:35.706 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****sMyQ"
    },
    {
      "TokenType": "code",
      "TokenValue": "****990b"
    }
  ],
  "ActivityId": "0HLFNGU53O163:0000000B",
  "TimeStamp": "2018-08-01T08:20:35Z",
  "ProcessId": 43680,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:20:35.722 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzKnM7fA_qvJ5kQG4vZxlbnkz8u_nzwl-jfXhBd8seMJ-4At3TeUGV-36THGIS8BnSG8iv0OKJOd9C0_8rSZUYjn1ZxVePPJtHWKQCfOTrL5FQgjZKoa38bYKj8eLg7oeSqqgw6aI6eW2gViKoyH7xIaQKnBuwjzvOyXpbVIZvomgLeDypkD89JNsYWYSOu5InfFP4RedeKavdGPIPR7GYUHvf-NFbvx5mFfD5WFAwJhZwHsoYQCg-L4u0D8uMxU1Z6yrQ5BR6OBrRXzhf5aiTuRBKfrS4xczovxZj3LoEIvIxqmycqC1hDOKoQrjMBN6R8",
  "Scope": "openid profile api1 offline_access"
}
2018-08-01 11:20:35.747 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:20:35.750 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:20:35.880 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-08-01 11:20:35.889 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-08-01 11:20:35.892 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-08-01 11:20:35.906 +03:00 [DBG] Start token request.
2018-08-01 11:20:35.919 +03:00 [DBG] Start client validation
2018-08-01 11:20:35.928 +03:00 [DBG] Start parsing Basic Authentication secret
2018-08-01 11:20:35.935 +03:00 [DBG] Start parsing for secret in post body
2018-08-01 11:20:35.939 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-08-01 11:20:35.942 +03:00 [DBG] Secret id found: mvc
2018-08-01 11:20:35.969 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:35.983 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-08-01 11:20:35.984 +03:00 [DBG] Client validation success
2018-08-01 11:20:35.992 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFNGU53O162:00000003",
  "TimeStamp": "2018-08-01T08:20:35Z",
  "ProcessId": 43680,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:20:36.002 +03:00 [DBG] Start token request validation
2018-08-01 11:20:36.016 +03:00 [DBG] Start validation of authorization code token request
2018-08-01 11:20:36.040 +03:00 [DBG] GBNr/1q41DE9ryMuumJ54m4+/isppyKBcEGker85efw= found in database: true
2018-08-01 11:20:36.077 +03:00 [DBG] removing GBNr/1q41DE9ryMuumJ54m4+/isppyKBcEGker85efw= persisted grant from database
2018-08-01 11:20:36.107 +03:00 [DBG] Validation of authorization code token request success
2018-08-01 11:20:36.122 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "f1c5f243ebb77d39976211db778d11abe9c11c5722862825a944f28035a7990b",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "f1c5f243ebb77d39976211db778d11abe9c11c5722862825a944f28035a7990b",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-08-01 11:20:36.169 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:36.179 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:36.200 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:36.218 +03:00 [DBG] Getting claims for access token for client: mvc
2018-08-01 11:20:36.225 +03:00 [DBG] Getting claims for access token for subject: c1156885-94ed-4f7b-9b10-ac37fe5a8a92
2018-08-01 11:20:36.262 +03:00 [DBG] Creating refresh token
2018-08-01 11:20:36.264 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-08-01 11:20:36.288 +03:00 [DBG] oLK6fVQPUlZbcerrktUq8LvLpWSKsTSvz8SvHh21/fY= not found in database
2018-08-01 11:20:36.318 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:36.326 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:36.343 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:20:36.348 +03:00 [DBG] Getting claims for identity token for subject: c1156885-94ed-4f7b-9b10-ac37fe5a8a92 and client: mvc
2018-08-01 11:20:36.350 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:20:36.357 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****jSlw"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****6212"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****g2cA"
    }
  ],
  "ActivityId": "0HLFNGU53O162:00000003",
  "TimeStamp": "2018-08-01T08:20:36Z",
  "ProcessId": 43680,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:20:36.363 +03:00 [DBG] Token request success.
2018-08-01 11:20:36.385 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-08-01 11:20:36.391 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-08-01 11:20:36.393 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-08-01 11:20:36.403 +03:00 [DBG] Start userinfo request
2018-08-01 11:20:36.410 +03:00 [DBG] Bearer token found in header
2018-08-01 11:20:36.492 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:36.524 +03:00 [DBG] mvc found in database: true
2018-08-01 11:20:36.537 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-08-01 11:20:36.546 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533111636,
    "exp": 1533115236,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "c1156885-94ed-4f7b-9b10-ac37fe5a8a92",
    "auth_time": 1533111632,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "external"
  }
}
2018-08-01 11:20:36.581 +03:00 [DBG] Creating userinfo response
2018-08-01 11:20:36.590 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:20:36.596 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:20:36.608 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:36.612 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-08-01 11:20:36.615 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:20:36.624 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:20:36.641 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-08-01 11:20:36.645 +03:00 [DBG] End userinfo request
2018-08-01 11:28:32.705 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:28:32.786 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:28:32.790 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:28:32.797 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:28:32.801 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:28:33.111 +03:00 [DBG] Starting token cleanup
2018-08-01 11:29:29.962 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:29:30.071 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:29:30.078 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:29:30.089 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:29:30.108 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:29:30.489 +03:00 [DBG] Starting token cleanup
2018-08-01 11:29:38.174 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:29:38.229 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:29:38.232 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:29:38.243 +03:00 [DBG] Start discovery request
2018-08-01 11:29:41.093 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:29:41.433 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:29:41.437 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:29:41.439 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:29:41.446 +03:00 [DBG] Start key discovery request
2018-08-01 11:29:41.550 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:29:41.564 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:29:41.568 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:29:41.576 +03:00 [DBG] Start authorize request
2018-08-01 11:29:41.600 +03:00 [DBG] No user present in authorize request
2018-08-01 11:29:41.608 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:29:42.139 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:42.151 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:29:42.156 +03:00 [DBG] No PKCE used.
2018-08-01 11:29:42.235 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:42.410 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:42.436 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:42.451 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:42.464 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:29:42.482 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
  "Nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:29:42.503 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:29:42.605 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:29:42.639 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:42.642 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:29:42.647 +03:00 [DBG] No PKCE used.
2018-08-01 11:29:42.656 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:42.674 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:42.687 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:42.712 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:42.718 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:29:42.775 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:44.969 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-08-01 11:29:52.178 +03:00 [INF] AuthenticationScheme: idsrv.external signed in.
2018-08-01 11:29:58.983 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "105806803545823947289",
  "SubjectId": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
  "DisplayName": "Andrei Krasnou",
  "Endpoint": "UI",
  "ActivityId": "0HLFNH3JH703U:00000004",
  "TimeStamp": "2018-08-01T08:29:58Z",
  "ProcessId": 8180,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:29:59.000 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:29:59.007 +03:00 [DBG] Adding amr claim with value: external
2018-08-01 11:29:59.016 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:29:59.039 +03:00 [INF] AuthenticationScheme: idsrv.external signed out.
2018-08-01 11:29:59.064 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:29:59.071 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:29:59.073 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:29:59.082 +03:00 [DBG] Start authorize callback request
2018-08-01 11:29:59.092 +03:00 [DBG] User in authorize request: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f
2018-08-01 11:29:59.095 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:29:59.128 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:59.130 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:29:59.132 +03:00 [DBG] No PKCE used.
2018-08-01 11:29:59.141 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:59.161 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:59.173 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:59.190 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:59.193 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:29:59.195 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
  "Nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
  "SessionId": "0771a115784bf72f0ccf61a8aa8b9cf6",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:29:59.260 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:29:59.269 +03:00 [INF] Showing consent: User has not yet consented
2018-08-01 11:29:59.313 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:29:59.346 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:59.349 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:29:59.352 +03:00 [DBG] No PKCE used.
2018-08-01 11:29:59.361 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:59.381 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:59.394 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:59.412 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:29:59.418 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:29:59.448 +03:00 [DBG] mvc found in database: true
2018-08-01 11:29:59.460 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:29:59.544 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:01.773 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:30:01.847 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:30:01.885 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:01.888 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:30:01.891 +03:00 [DBG] No PKCE used.
2018-08-01 11:30:01.899 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:01.916 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:01.927 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:01.945 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:01.948 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:30:01.987 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:30:01.991 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:30:01.994 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:30:01.998 +03:00 [DBG] Start authorize callback request
2018-08-01 11:30:02.032 +03:00 [DBG] User in authorize request: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f
2018-08-01 11:30:02.042 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:30:02.081 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:02.086 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:30:02.089 +03:00 [DBG] No PKCE used.
2018-08-01 11:30:02.100 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:02.120 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:02.129 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:02.148 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:02.151 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:30:02.156 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
  "Nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
  "SessionId": "0771a115784bf72f0ccf61a8aa8b9cf6",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687089815267523.OGM1YjM0NjMtMWViOC00OGM1LWI2NTEtNGU0ZDc2MjljODViMDUzNzBmNTUtZGM0Ny00ZWU0LThhMjQtOGUwNDY5YWMyZDc3",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:30:02.178 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:30:02.189 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:30:02.194 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:30:02.200 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f
2018-08-01 11:30:02.248 +03:00 [DBG] 2stBR4FwyCdYs3+dV0O8huo4jpMj+LSe/Ck+pxD1VXc= not found in database
2018-08-01 11:30:02.305 +03:00 [DBG] Creating Hybrid Flow response.
2018-08-01 11:30:02.341 +03:00 [DBG] rqbTdh6RlEMkFsw94DxEEx+8TWJ2a0JHNMstm+chpz0= not found in database
2018-08-01 11:30:02.356 +03:00 [DBG] Creating Implicit Flow response.
2018-08-01 11:30:02.372 +03:00 [DBG] Getting claims for identity token for subject: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f and client: mvc
2018-08-01 11:30:02.378 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:30:02.451 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****OnEg"
    },
    {
      "TokenType": "code",
      "TokenValue": "****7642"
    }
  ],
  "ActivityId": "0HLFNH3JH703U:00000009",
  "TimeStamp": "2018-08-01T08:30:02Z",
  "ProcessId": 8180,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:30:02.461 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzL_WMhbiW9gA_x8f73pT0HviqfEVxMAHdjn5SxjXGM5XN3-H27X8EIE4mxB5YWhaIDdKzvz939PmNaK2D3ewywRotiGRrMy-DjSaKd2eDqW0soZfcfgwKIW1Gg9kJWCHXGBgcvzcBe1dNf0oVDtdbFFwr25Z9G215LlaHd4R6Q5Tv_WG8XdxZYQjzmGliDbRChksxIeI8vr1oiaAF8T53NirUDsrZaUj8-mYSWQZIwd0KQLGh52U91vcMndjOLFW1iMVQ8EFAaiCprXCpCKul04V64EhMo-KOgkJbw2kIEA0VTnFNCebtoPke_ZNpik6Wg",
  "Scope": "openid profile api1 offline_access"
}
2018-08-01 11:30:02.489 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:30:02.492 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:30:02.623 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-08-01 11:30:02.632 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-08-01 11:30:02.637 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-08-01 11:30:02.649 +03:00 [DBG] Start token request.
2018-08-01 11:30:02.662 +03:00 [DBG] Start client validation
2018-08-01 11:30:02.672 +03:00 [DBG] Start parsing Basic Authentication secret
2018-08-01 11:30:02.679 +03:00 [DBG] Start parsing for secret in post body
2018-08-01 11:30:02.682 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-08-01 11:30:02.684 +03:00 [DBG] Secret id found: mvc
2018-08-01 11:30:02.715 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:02.731 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-08-01 11:30:02.737 +03:00 [DBG] Client validation success
2018-08-01 11:30:02.746 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFNH3JH703R:00000003",
  "TimeStamp": "2018-08-01T08:30:02Z",
  "ProcessId": 8180,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:30:02.764 +03:00 [DBG] Start token request validation
2018-08-01 11:30:02.781 +03:00 [DBG] Start validation of authorization code token request
2018-08-01 11:30:02.811 +03:00 [DBG] rqbTdh6RlEMkFsw94DxEEx+8TWJ2a0JHNMstm+chpz0= found in database: true
2018-08-01 11:30:02.851 +03:00 [DBG] removing rqbTdh6RlEMkFsw94DxEEx+8TWJ2a0JHNMstm+chpz0= persisted grant from database
2018-08-01 11:30:02.881 +03:00 [DBG] Validation of authorization code token request success
2018-08-01 11:30:02.893 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "a69af31d6bd197970cc9422a6e8073a1efccb502b2434e460c55df30572f7642",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "a69af31d6bd197970cc9422a6e8073a1efccb502b2434e460c55df30572f7642",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-08-01 11:30:02.942 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:02.951 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:02.978 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:02.996 +03:00 [DBG] Getting claims for access token for client: mvc
2018-08-01 11:30:02.999 +03:00 [DBG] Getting claims for access token for subject: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f
2018-08-01 11:30:03.040 +03:00 [DBG] Creating refresh token
2018-08-01 11:30:03.043 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-08-01 11:30:03.065 +03:00 [DBG] bvOqeR2K7wDJ4SqiIvmXOmrWT+5MTp4a783BWItkEMY= not found in database
2018-08-01 11:30:03.096 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:03.104 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:03.118 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:03.123 +03:00 [DBG] Getting claims for identity token for subject: 4cc6eb24-976b-4fd7-8e90-91982f2fb11f and client: mvc
2018-08-01 11:30:03.125 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:30:03.132 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Ckdg"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****a314"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****0BSA"
    }
  ],
  "ActivityId": "0HLFNH3JH703R:00000003",
  "TimeStamp": "2018-08-01T08:30:03Z",
  "ProcessId": 8180,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:30:03.138 +03:00 [DBG] Token request success.
2018-08-01 11:30:03.164 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-08-01 11:30:03.170 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-08-01 11:30:03.173 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-08-01 11:30:03.182 +03:00 [DBG] Start userinfo request
2018-08-01 11:30:03.190 +03:00 [DBG] Bearer token found in header
2018-08-01 11:30:03.275 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:03.304 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:03.316 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-08-01 11:30:03.327 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533112203,
    "exp": 1533115803,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "4cc6eb24-976b-4fd7-8e90-91982f2fb11f",
    "auth_time": 1533112198,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "external"
  }
}
2018-08-01 11:30:03.346 +03:00 [DBG] Creating userinfo response
2018-08-01 11:30:03.355 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:30:03.365 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:30:03.379 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:03.387 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-08-01 11:30:03.393 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:30:03.405 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:03.424 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-08-01 11:30:03.429 +03:00 [DBG] End userinfo request
2018-08-01 11:30:50.721 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:30:50.727 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:30:50.730 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:30:50.740 +03:00 [DBG] Start authorize request
2018-08-01 11:30:50.743 +03:00 [DBG] No user present in authorize request
2018-08-01 11:30:50.748 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:30:50.824 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:50.826 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:30:50.828 +03:00 [DBG] No PKCE used.
2018-08-01 11:30:50.839 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:50.912 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:50.921 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:50.935 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:50.939 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:30:50.943 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJVvw6_rhOA_KBDtSlIUQxh5ARNKlRYe3XfOUMSUa7jquoM-bQ55unFfq_7lXvE2FEuNzwkxWDP2x8T1yH8ecPzZAh3ePxkxwTuYWoPTGjy5WGEe_Nu3qv1zWRszm9K9HCWoS2cSKOWDNyRAOZu22Jxl3MRvVbkVoZgEHdC9Ov45pBoooso0-0t4VilIbPxzc2JgZ7o8Ru1OgLVWiPGxbMnsmvNXNlWoKY8yM9ck4-c08TTfFy0MCT8PmSQEh72o0fGj29HfvvR66b85olp6wX2TUaWzFIVwTUnC5a93BqSzXEB4TF4Bs2sdCQ2oCWRD3U",
  "Nonce": "636687090507012544.YTk4ZGVlYmItYTllYS00YmNiLWE2YTktZGYyODcxNWMwYjFkNGM3YjU2ZDctNjVhYi00NWI5LThiMGQtODM5OTM0ZjJhMjgy",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687090507012544.YTk4ZGVlYmItYTllYS00YmNiLWE2YTktZGYyODcxNWMwYjFkNGM3YjU2ZDctNjVhYi00NWI5LThiMGQtODM5OTM0ZjJhMjgy",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzJVvw6_rhOA_KBDtSlIUQxh5ARNKlRYe3XfOUMSUa7jquoM-bQ55unFfq_7lXvE2FEuNzwkxWDP2x8T1yH8ecPzZAh3ePxkxwTuYWoPTGjy5WGEe_Nu3qv1zWRszm9K9HCWoS2cSKOWDNyRAOZu22Jxl3MRvVbkVoZgEHdC9Ov45pBoooso0-0t4VilIbPxzc2JgZ7o8Ru1OgLVWiPGxbMnsmvNXNlWoKY8yM9ck4-c08TTfFy0MCT8PmSQEh72o0fGj29HfvvR66b85olp6wX2TUaWzFIVwTUnC5a93BqSzXEB4TF4Bs2sdCQ2oCWRD3U",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:30:50.954 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:30:50.973 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:30:51.008 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:51.011 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:30:51.013 +03:00 [DBG] No PKCE used.
2018-08-01 11:30:51.023 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:51.040 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:51.049 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:30:51.064 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:30:51.069 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:30:51.093 +03:00 [DBG] mvc found in database: true
2018-08-01 11:30:56.119 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:32:23.131 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:32:23.248 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:32:23.333 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:32:23.356 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:32:23.403 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:32:23.734 +03:00 [DBG] Starting token cleanup
2018-08-01 11:32:58.177 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:32:58.234 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:32:58.247 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:32:58.260 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:32:58.263 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:32:58.676 +03:00 [DBG] Starting token cleanup
2018-08-01 11:33:14.954 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:33:14.990 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:33:14.993 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:33:14.998 +03:00 [DBG] Start discovery request
2018-08-01 11:33:17.567 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:33:17.888 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:33:17.892 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:33:17.894 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:33:17.899 +03:00 [DBG] Start key discovery request
2018-08-01 11:33:18.030 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:33:18.050 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:33:18.052 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:33:18.061 +03:00 [DBG] Start authorize request
2018-08-01 11:33:18.080 +03:00 [DBG] No user present in authorize request
2018-08-01 11:33:18.088 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:33:18.616 +03:00 [DBG] mvc found in database: true
2018-08-01 11:33:18.626 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:33:18.630 +03:00 [DBG] No PKCE used.
2018-08-01 11:33:18.690 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:33:18.816 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:33:18.843 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:33:18.864 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:33:18.877 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:33:18.896 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK9rE3OJ0vTf-3qr0YIzGW2nq8_4MoEVsoMbmdfhj4pAOvt9iJ0mPErCiCJOVGePf-eW1LjyjyuvYGJ1pM9NYcGb9FM2YrcfQZLFhn4Zrtl9dGABdTsZXa-4WTg38MFnm5LqGpLw0kwsW0c2kK1k3xz6HLb9KNVhpuLujU1h70tY_bYDwDrCBdToucDu5uMn0r3Pg-WoC9aUampDRN_myie8KHqCJowZsA-ciQuLFuUaY1mlC_xb1vOkLtTvCmspLs6TD2aC3vvGsKQ3eUBuPeRSoL9Jvu9SOPoQluImPOTnv6v2JDsYYcjE5tuWCAMJqI",
  "Nonce": "636687091979774927.MDk1NTg1Y2MtNGNhZi00ZmE2LTg3MjgtNTY4ZTM0YmYxNDAzN2JkODczMTQtMzA4NS00ZjBhLWJhMjYtMWU0MzdkZDhkM2Vi",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687091979774927.MDk1NTg1Y2MtNGNhZi00ZmE2LTg3MjgtNTY4ZTM0YmYxNDAzN2JkODczMTQtMzA4NS00ZjBhLWJhMjYtMWU0MzdkZDhkM2Vi",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzK9rE3OJ0vTf-3qr0YIzGW2nq8_4MoEVsoMbmdfhj4pAOvt9iJ0mPErCiCJOVGePf-eW1LjyjyuvYGJ1pM9NYcGb9FM2YrcfQZLFhn4Zrtl9dGABdTsZXa-4WTg38MFnm5LqGpLw0kwsW0c2kK1k3xz6HLb9KNVhpuLujU1h70tY_bYDwDrCBdToucDu5uMn0r3Pg-WoC9aUampDRN_myie8KHqCJowZsA-ciQuLFuUaY1mlC_xb1vOkLtTvCmspLs6TD2aC3vvGsKQ3eUBuPeRSoL9Jvu9SOPoQluImPOTnv6v2JDsYYcjE5tuWCAMJqI",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:33:18.914 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:33:19.006 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:33:19.039 +03:00 [DBG] mvc found in database: true
2018-08-01 11:33:19.048 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:33:19.051 +03:00 [DBG] No PKCE used.
2018-08-01 11:33:19.064 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:33:19.082 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:33:19.091 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:33:19.106 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:33:19.111 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:33:19.139 +03:00 [DBG] mvc found in database: true
2018-08-01 11:33:30.239 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:34:58.452 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-08-01 11:34:58.501 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-08-01 11:34:58.514 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-08-01 11:34:58.527 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-08-01 11:34:58.529 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-08-01 11:34:58.995 +03:00 [DBG] Starting token cleanup
2018-08-01 11:35:10.772 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-08-01 11:35:10.812 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-08-01 11:35:10.814 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-08-01 11:35:10.822 +03:00 [DBG] Start discovery request
2018-08-01 11:35:13.365 +03:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-08-01 11:35:13.679 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-08-01 11:35:13.683 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-08-01 11:35:13.685 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-08-01 11:35:13.691 +03:00 [DBG] Start key discovery request
2018-08-01 11:35:13.816 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-08-01 11:35:13.839 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-08-01 11:35:13.849 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-08-01 11:35:13.869 +03:00 [DBG] Start authorize request
2018-08-01 11:35:13.893 +03:00 [DBG] No user present in authorize request
2018-08-01 11:35:13.904 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:14.435 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:14.446 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:14.449 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:14.516 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:14.645 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:14.672 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:14.695 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:14.711 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:14.729 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
  "Nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:35:14.747 +03:00 [INF] Showing login: User is not authenticated
2018-08-01 11:35:14.849 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:14.878 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:14.881 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:14.883 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:14.893 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:14.910 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:14.920 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:14.933 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:14.936 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:14.963 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:20.785 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:35:24.749 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:35:24.755 +03:00 [DBG] Adding idp claim with value: local
2018-08-01 11:35:24.758 +03:00 [DBG] Adding amr claim with value: pwd
2018-08-01 11:35:24.762 +03:00 [DBG] Adding auth_time claim with value: 1533112524
2018-08-01 11:35:24.821 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:35:24.882 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "andrei_krasnou@epam.com",
  "SubjectId": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
  "DisplayName": "andrei_krasnou@epam.com",
  "Endpoint": "UI",
  "ActivityId": "0HLFNH6LBO2OI:00000004",
  "TimeStamp": "2018-08-01T08:35:24Z",
  "ProcessId": 19960,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:35:24.935 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:35:24.940 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:35:24.943 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:35:24.956 +03:00 [DBG] Start authorize callback request
2018-08-01 11:35:24.965 +03:00 [DBG] User in authorize request: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db
2018-08-01 11:35:24.969 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:25.029 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:25.033 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:25.035 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:25.042 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:25.058 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:25.068 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:25.082 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:25.086 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:25.088 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
  "Nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
  "SessionId": "2c0e6d7e3c42f8969a9b0ef23df6b7af",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:35:25.209 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:35:25.211 +03:00 [INF] Showing consent: User has not yet consented
2018-08-01 11:35:25.256 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:25.291 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:25.293 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:25.297 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:25.305 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:25.320 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:25.328 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:25.342 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:25.347 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:25.371 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:25.381 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:25.462 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:27.111 +03:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-08-01 11:35:27.160 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:27.192 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:27.194 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:27.199 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:27.207 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:27.222 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:27.233 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:27.253 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:27.258 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:27.304 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-08-01 11:35:27.310 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-08-01 11:35:27.317 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-08-01 11:35:27.324 +03:00 [DBG] Start authorize callback request
2018-08-01 11:35:27.371 +03:00 [DBG] User in authorize request: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db
2018-08-01 11:35:27.378 +03:00 [DBG] Start authorize request protocol validation
2018-08-01 11:35:27.408 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:27.410 +03:00 [DBG] Checking for PKCE parameters
2018-08-01 11:35:27.415 +03:00 [DBG] No PKCE used.
2018-08-01 11:35:27.423 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:27.437 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:27.445 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:27.459 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:27.464 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-08-01 11:35:27.467 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "AllowedRedirectUris": [
    "http://localhost:5002/signin-oidc"
  ],
  "SubjectId": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
  "Nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
  "SessionId": "2c0e6d7e3c42f8969a9b0ef23df6b7af",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "http://localhost:5002/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636687093137659786.Njk4MzMxMzYtMTgzMy00MDM1LWEyOGYtMWFjZGIzMGJhYmE3YmYxNzc5OWQtNjdkYy00MmVkLWExNDgtZTU0OTA3ZmUzYmE1",
    "state": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
    "x-client-SKU": "ID_NET",
    "x-client-ver": "2.1.4.0"
  }
}
2018-08-01 11:35:27.487 +03:00 [DBG] Scopes contains offline_access, consent is required
2018-08-01 11:35:27.495 +03:00 [INF] User consented to scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:35:27.500 +03:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2018-08-01 11:35:27.507 +03:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db
2018-08-01 11:35:27.555 +03:00 [DBG] mYsBg2N8sYJgPXnSNafZKoRGQ3QCcvIZSX4ss0jHwDk= not found in database
2018-08-01 11:35:27.763 +03:00 [DBG] Creating Hybrid Flow response.
2018-08-01 11:35:27.798 +03:00 [DBG] 3vy/rm5xmxyjrUHYDrXZhNFGXVh6aqPYoIvOLIfq7Uw= not found in database
2018-08-01 11:35:27.809 +03:00 [DBG] Creating Implicit Flow response.
2018-08-01 11:35:27.824 +03:00 [DBG] Getting claims for identity token for subject: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db and client: mvc
2018-08-01 11:35:27.830 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:35:27.904 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****ebxg"
    },
    {
      "TokenType": "code",
      "TokenValue": "****f629"
    }
  ],
  "ActivityId": "0HLFNH6LBO2OI:00000008",
  "TimeStamp": "2018-08-01T08:35:27Z",
  "ProcessId": 19960,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:35:27.917 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
  "ClientId": "mvc",
  "RedirectUri": "http://localhost:5002/signin-oidc",
  "State": "CfDJ8KuqC1l7QeZCrHnUtlrKrzIR4_ewd1ZADN4eRO8DRyvNCUW55CBnihkBfb4fCLsRfNtSVs3WEvO-4qZmpfzIftQtp30cN357wL0m9W3Ql2cJn5oauEbYBAMpOUlYKDUzRSRSgUZX522egZpsNvafHDW2mbYyjwc39nyR1c4Qi1f7xvn65ojLao6v8DbRgInN2ygVUjOCRX3Gd7Vt6HUQVY3eTMgSMG6aQk_3p0lOqZB5pYM7SEjkVaRnqbH1YomTjgiO5kC_1cWDdaXb4ZM-h6cuSGT_KuOMeI9dltSiDJKsJX3AnX8-lQa3gAtVaSzS9M87XQRzMlV7KQ3ekML75m4",
  "Scope": "openid profile api1 offline_access"
}
2018-08-01 11:35:27.941 +03:00 [DBG] Augmenting SignInContext
2018-08-01 11:35:27.944 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-08-01 11:35:28.110 +03:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-08-01 11:35:28.120 +03:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-08-01 11:35:28.122 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-08-01 11:35:28.134 +03:00 [DBG] Start token request.
2018-08-01 11:35:28.144 +03:00 [DBG] Start client validation
2018-08-01 11:35:28.153 +03:00 [DBG] Start parsing Basic Authentication secret
2018-08-01 11:35:28.159 +03:00 [DBG] Start parsing for secret in post body
2018-08-01 11:35:28.162 +03:00 [DBG] Parser found secret: PostBodySecretParser
2018-08-01 11:35:28.165 +03:00 [DBG] Secret id found: mvc
2018-08-01 11:35:28.194 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:28.209 +03:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-08-01 11:35:28.211 +03:00 [DBG] Client validation success
2018-08-01 11:35:28.221 +03:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLFNH6LBO2OK:00000003",
  "TimeStamp": "2018-08-01T08:35:28Z",
  "ProcessId": 19960,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:35:28.231 +03:00 [DBG] Start token request validation
2018-08-01 11:35:28.245 +03:00 [DBG] Start validation of authorization code token request
2018-08-01 11:35:28.272 +03:00 [DBG] 3vy/rm5xmxyjrUHYDrXZhNFGXVh6aqPYoIvOLIfq7Uw= found in database: true
2018-08-01 11:35:28.307 +03:00 [DBG] removing 3vy/rm5xmxyjrUHYDrXZhNFGXVh6aqPYoIvOLIfq7Uw= persisted grant from database
2018-08-01 11:35:28.342 +03:00 [DBG] Validation of authorization code token request success
2018-08-01 11:35:28.354 +03:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "6b4b428bad655e8ea76fa43f51176899b985e85e27613869c1b004f30b37f629",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "6b4b428bad655e8ea76fa43f51176899b985e85e27613869c1b004f30b37f629",
    "grant_type": "authorization_code",
    "redirect_uri": "http://localhost:5002/signin-oidc"
  }
}
2018-08-01 11:35:28.391 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:28.399 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:28.414 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:28.429 +03:00 [DBG] Getting claims for access token for client: mvc
2018-08-01 11:35:28.433 +03:00 [DBG] Getting claims for access token for subject: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db
2018-08-01 11:35:28.462 +03:00 [DBG] Creating refresh token
2018-08-01 11:35:28.465 +03:00 [DBG] Setting an absolute lifetime: 2592000
2018-08-01 11:35:28.487 +03:00 [DBG] e5Zpa36HV17i4V0yNvZf2iPNFf28bTO4bRnljGGFYfc= not found in database
2018-08-01 11:35:28.516 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:28.524 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:28.537 +03:00 [DBG] Found ["api1"] API scopes in database
2018-08-01 11:35:28.542 +03:00 [DBG] Getting claims for identity token for subject: 4d9a8c59-c3fc-47bb-96cb-e7832c3096db and client: mvc
2018-08-01 11:35:28.544 +03:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-08-01 11:35:28.551 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****7ktA"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****0b7c"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****WUog"
    }
  ],
  "ActivityId": "0HLFNH6LBO2OK:00000003",
  "TimeStamp": "2018-08-01T08:35:28Z",
  "ProcessId": 19960,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-08-01 11:35:28.557 +03:00 [DBG] Token request success.
2018-08-01 11:35:28.579 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-08-01 11:35:28.585 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-08-01 11:35:28.588 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-08-01 11:35:28.599 +03:00 [DBG] Start userinfo request
2018-08-01 11:35:28.605 +03:00 [DBG] Bearer token found in header
2018-08-01 11:35:28.694 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:28.720 +03:00 [DBG] mvc found in database: true
2018-08-01 11:35:28.733 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-08-01 11:35:28.741 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1533112528,
    "exp": 1533116128,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "4d9a8c59-c3fc-47bb-96cb-e7832c3096db",
    "auth_time": 1533112524,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-08-01 11:35:28.757 +03:00 [DBG] Creating userinfo response
2018-08-01 11:35:28.765 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:35:28.770 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:35:28.781 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:28.785 +03:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-08-01 11:35:28.787 +03:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-08-01 11:35:28.797 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-08-01 11:35:28.813 +03:00 [INF] Profile service returned to the following claim types: sub preferred_username name
2018-08-01 11:35:28.818 +03:00 [DBG] End userinfo request
